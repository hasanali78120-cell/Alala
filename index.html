<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“’ Ø¯Û•ÙØªÛ•Ø±ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù† - ÙˆÛ•Ø´Ø§Ù†ÛŒ Ø¦Û†ÙÙ„Ø§ÛŒÙ†</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        info: '#3B82F6',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #10B981;
            --accent: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --background: #F9FAFB;
            --text: #1F2937;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
        }

        @keyframes liquid-sky-1 {
            0% { transform: translateX(-5%) translateY(10%) rotate(0deg); }
            50% { transform: translateX(5%) translateY(-10%) rotate(180deg); }
            100% { transform: translateX(-5%) translateY(10%) rotate(360deg); }
        }

        @keyframes liquid-sky-2 {
            0% { transform: translateX(5%) translateY(-10%) rotate(0deg); }
            50% { transform: translateX(-5%) translateY(10%) rotate(180deg); }
            100% { transform: translateX(5%) translateY(-10%) rotate(360deg); }
        }

        .app-header {
            position: relative;
            overflow: hidden;
            background-color: #311b92;
            color: white;
            padding: 0.75rem 1rem;
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 5px 25px rgba(44, 44, 88, 0.4);
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }
        .app-header::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            top: -100px;
            right: -100px;
            background: linear-gradient(135deg, #6D28D9, #4F46E5);
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.8;
            animation: liquid-sky-1 15s linear infinite;
        }
        .app-header::after {
            content: '';
            position: absolute;
            width: 250px;
            height: 250px;
            bottom: -80px;
            left: -80px;
            background: linear-gradient(135deg, #A78BFA, #C084FC);
            border-radius: 50%;
            filter: blur(50px);
            opacity: 0.9;
            animation: liquid-sky-2 12s linear infinite;
        }
        .app-header > div { z-index: 1; }
        .header-btn {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }
        .header-btn:hover { background: rgba(255, 255, 255, 0.2); }
        .animated-title {
            color: white;
            white-space: nowrap;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
        }

        .stat-card {
            position: relative;
            color: white;
            border-radius: 16px;
            padding: 1.5rem;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 120px;
        }
        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .stat-card::after {
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            font-size: 5rem;
            opacity: 0.15;
            color: white;
            transition: transform 0.4s ease;
            right: -15px;
            transform: rotate(-15deg);
        }
        .stat-card:hover::after { transform: rotate(-5deg) scale(1.1); }
        .stat-card-label { font-size: 0.9rem; font-weight: 700; text-shadow: 0 1px 3px rgba(0,0,0,0.4); letter-spacing: 0.025em; }
        .stat-card-number {
            font-size: 1.875rem;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.25);
            text-align: right;
        }
        .stat-card-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card-primary::after { content: "\f0c0"; }
        .stat-card-accent { background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%); }
        .stat-card-accent::after { content: "\f571"; }
        .stat-card-secondary { background: linear-gradient(135deg, #28b485 0%, #7dd56f 100%); }
        .stat-card-secondary::after { content: "\f53d"; }
        .stat-card-danger { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
        .stat-card-danger::after { content: "\f555"; }

        .filter-pills-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }
        .filter-pill-btn {
            position: relative;
            padding: 0.75rem 0.5rem;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            background-color: #ffffff;
            color: #4b5563;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.25s ease-in-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
        }
        .filter-pill-btn:hover {
            border-color: #d1d5db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        .filter-pill-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 5px 12px rgba(79, 70, 229, 0.3);
            transform: translateY(-2px);
        }
        .filter-badge {
            background-color: var(--danger);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            padding: 0 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -5px;
            right: 0px;
            border: 2px solid white;
        }
        .filter-pill-btn.active .filter-badge {
            background-color: white;
            color: var(--primary);
            border-color: var(--primary);
        }
        
        .receipt-card {
            background-color: #fff; border-radius: 16px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.07);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; display: flex;
            flex-direction: column; border: 1px solid #e5e7eb; cursor: pointer;
        }
        .receipt-card:hover {
            transform: translateY(-8px) scale(1.02); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1); border-color: var(--primary);
        }
        .card-top {
            padding: 1rem 1.25rem; color: white; display: flex; 
            flex-direction: column; 
            align-items: flex-start; 
            justify-content: center; 
            position: relative; overflow: hidden; gap: 0.5rem;
            min-height: 85px; 
        }
        .card-top::after {
            content: '\f53d'; font-family: "Font Awesome 6 Free"; font-weight: 900;
            position: absolute; font-size: 4rem; opacity: 0.1; color: white;
            top: 50%; transform: translateY(-50%) rotate(-15deg); transition: transform 0.4s ease;
            right: -15px;
        }
        .receipt-card:hover .card-top::after { transform: translateY(-50%) rotate(-5deg) scale(1.1); }
        .card-top .name { font-weight: 700; font-size: 1.2rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); z-index: 1; }
        .card-top .status-badge {
            background-color: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem;
            border-radius: 999px; font-size: 0.75rem;
            white-space: nowrap;
             font-weight: 600; z-index: 1;
        }
        .card-top.status-paid { background: linear-gradient(135deg, var(--secondary) 0%, #2DD4BF 100%); }
        .card-top.status-overdue { background: linear-gradient(135deg, var(--danger) 0%, #FF6B6B 100%); }
        .card-top.status-pending { background: linear-gradient(135deg, var(--accent) 0%, #FFC107 100%); }
        .card-bottom { padding: 1.25rem; display: flex; flex-direction: column; gap: 1rem; }
        .amount-main { text-align: center; }
        .amount-main .label { font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem; }
        .amount-main .amount { font-size: 2rem; font-weight: 800; line-height: 1.1; }
        .amount-main .amount.is-paid { color: var(--secondary); }
        .amount-main .amount.is-unpaid { color: var(--danger); }
        .progress-container { background-color: #e5e7eb; border-radius: 999px; height: 8px; overflow: hidden; width: 100%; }
        .progress-bar { height: 100%; background-color: var(--secondary); border-radius: 999px; transition: width 0.5s ease; }
        .card-details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.875rem; text-align: center; }
        .card-details-grid > div { background-color: #f9fafb; padding: 0.5rem; border-radius: 8px; }
        .card-details-grid .label { color: #6b7280; font-size: 0.75rem; display: block; }
        .card-details-grid .value { font-weight: 600; color: var(--text); font-size: 0.8rem; } 
        .card-actions { border-top: 1px solid #f3f4f6; padding-top: 1rem; display: flex; justify-content: space-between; align-items: center; gap: 0.5rem; }
        .card-actions .contact-buttons, .card-actions .action-buttons { display: flex; gap: 0.5rem; align-items: center; }
        .card-actions .action-btn {
            display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem;
            border-radius: 8px; font-weight: 600; transition: all 0.2s; border: none; cursor: pointer;
        }
        .card-actions .action-btn.primary { background-color: var(--primary); color: white; }
        .card-actions .action-btn.primary:hover { background-color: #4338CA; }
        .card-actions .action-btn.btn-info { background-color: var(--info); color: white; }
        .card-actions .action-btn.btn-info:hover { background-color: #2563EB; }
        .card-actions .icon-btn {
            width: 38px; height: 38px; display: inline-flex; align-items: center; justify-content: center;
            border-radius: 50%; font-size: 0.9rem; background-color: #f3f4f6; color: #4b5563;
            transition: all 0.2s; border: none; cursor: pointer; flex-shrink: 0;
        }
        .card-actions .icon-btn:hover { background-color: #e5e7eb; color: var(--primary); }
        
        .settings-card { background: white; border-radius: 1rem; padding: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.07); }
        .settings-action-item {
            display: flex; align-items: center; padding: 0.75rem; border-radius: 0.75rem;
            transition: background-color 0.2s ease-in-out; cursor: pointer; text-decoration: none;
        }
        .settings-action-item:hover { background-color: #f3f4f6; }
        .settings-action-icon {
            width: 40px; height: 40px; flex-shrink: 0; display: flex; align-items: center;
            justify-content: center; border-radius: 50%; font-size: 1.1rem; margin-left: 1rem;
        }
        .settings-action-text h4 { font-weight: 600; color: #1f2937; }
        .settings-action-text p { font-size: 0.875rem; color: #6b7280; }
        .settings-action-chevron { color: #9ca3af; margin-right: auto; }
        .lang-btn.active {
            background-color: white; color: var(--primary); font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .nav-btn {
            position: relative; flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: #6B7280; transition: color 0.2s ease-in-out;
            padding-top: 0.5rem; padding-bottom: 0.25rem;
        }
        .nav-btn:hover { color: var(--primary); }
        .nav-indicator {
            position: absolute; top: -1px; left: 50%; transform: translateX(-50%);
            width: 0; height: 3px; background-color: var(--primary);
            border-radius: 0 0 3px 3px; transition: width 0.3s ease;
        }
        .nav-btn.active { color: var(--primary); background-color: transparent; }
        .nav-btn.active .nav-indicator { width: 35%; }
        .nav-btn.active span { font-weight: 600; }
        .nav-btn i { margin-bottom: 4px; }
        .nav-btn > span:last-child { font-size: 0.75rem; }
       
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background-color: #333; color: white; padding: 12px 20px; border-radius: 8px;
            z-index: 2001; opacity: 0; transition: all 0.3s ease; pointer-events: none;
        }
        .toast.danger { background-color: var(--danger); }
        .toast.success { background-color: var(--secondary); }
        .toast.info { background-color: var(--info); }
        .toast.show { opacity: 1; bottom: 90px; }

        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
            padding: 0.75rem 1rem; border-radius: 0.5rem; font-weight: 600; text-align: center;
            transition: all 0.2s ease; cursor: pointer;
        }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover { background-color: #4338CA; }
        .btn-success { background-color: var(--secondary); color: white; }
        .btn-success:hover { background-color: #059669; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover { background-color: #DC2626; }
        .btn-gray { background-color: #6B7280; color: white; }
        .btn-gray:hover { background-color: #4B5563; }
        
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center;
            align-items: center; z-index: 1000; opacity: 0; visibility: hidden;
            transition: all 0.3s ease;
        }
        .modal.show { opacity: 1; visibility: visible; }
        .modal-content {
        overscroll-behavior: contain;
            background-color: white; padding: 1.5rem; border-radius: 12px; width: 90%;
            max-width: 450px; max-height: 85vh; overflow-y: auto; overflow-x: hidden;
            transform: scale(0.95); transition: all 0.3s ease;
        }
        .modal.show .modal-content { transform: scale(1); }

        #centralAddBtn {
            position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 60px; border-radius: 50%; background-color: var(--primary);
            color: white; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4); z-index: 10; cursor: pointer;
            transition: all 0.3s ease; border: 3px solid white;
        }
        #centralAddBtn:hover { transform: translateX(-50%) scale(1.1); background-color: #4338CA; }
        #centralAddBtn i { font-size: 1.75rem; }
        
        .form-input {
            transition: all 0.2s ease; border: 1px solid #d1d5db; border-radius: 0.5rem;
            padding: 0.75rem; width: 100%;
        }
        .form-input:focus {
            outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        .empty-state {
            text-align: center; padding: 2rem; color: #6b7280; background-color: #fff;
            border-radius: 12px; border: 2px dashed #e5e7eb;
        }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; display: block; color: #9ca3af; }
        
        .history-timeline { padding: 0 1.5rem; border-right: 2px solid #e5e7eb; }
        .history-item { position: relative; padding-bottom: 1rem; padding-right: 0.5rem; }
        .history-item:last-child { padding-bottom: 0; }
        .history-item::before {
            content: ''; position: absolute; top: 4px; width: 12px; height: 12px;
            border-radius: 50%; background-color: white; border: 2px solid var(--primary);
            right: -7px;
        }
        .history-item.payment::before { border-color: var(--secondary); }
        .history-item.loan::before { border-color: var(--accent); }

        #loader {
            display: flex; position: fixed; inset: 0; background-color: rgba(255, 255, 255, 0.8);
            z-index: 2000; justify-content: center; align-items: center; opacity: 1;
            visibility: visible; transition: opacity 0.2s ease, visibility 0.2s ease;
        }
        #loader.hidden { opacity: 0; visibility: hidden; }
        .loader-spinner {
            border: 8px solid #f3f3f3; border-top: 8px solid var(--primary);
            border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .welcome-section {
            background: linear-gradient(135deg, var(--primary) 0%, #7C3AED 100%);
            color: white; padding: 1.5rem; border-radius: 16px; margin-bottom: 1.5rem;
            text-align: center;
        }
        
        @keyframes ring {
            0% { transform: rotate(0); } 10% { transform: rotate(15deg); } 20% { transform: rotate(-13deg); }
            30% { transform: rotate(17deg); } 40% { transform: rotate(-16deg); } 50% { transform: rotate(15deg); }
            60% { transform: rotate(-13deg); } 70% { transform: rotate(17deg); } 80% { transform: rotate(-16deg); }
            90% { transform: rotate(15deg); } 100% { transform: rotate(0); }
        }
        .bell-ringing {
            animation: ring 1.5s ease-in-out infinite;
            transform-origin: top center;
        }
        
        .smart-notifications-wrapper {
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 1rem;
        }
        #smartNotifications {
            display: flex;
            gap: 0.75rem;
            padding: 2px;
        }
        .smart-alert-card {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
            background-color: #fff;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-right: 5px solid;
            cursor: pointer;
            width: 280px; 
            flex-shrink: 0; 
        }
        .smart-alert-card .header { display: flex; align-items: center; gap: 0.75rem; width: 100%; }
        .smart-alert-card .icon-area {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .smart-alert-card .content-area { flex-grow: 1; }
        .smart-alert-card .content-area h4 { font-weight: 700; font-size: 1rem; color: var(--text); }
        .smart-alert-card .content-area p { font-size: 0.875rem; color: #4b5563; }
        .smart-alert-card.alert-danger { border-color: var(--danger); }
        .smart-alert-card.alert-danger .icon-area { background-color: #FEE2E2; color: var(--danger); }
        .smart-alert-card.alert-warning { border-color: var(--accent); }
        .smart-alert-card.alert-warning .icon-area { background-color: #FEF3C7; color: var(--accent); }
        .smart-alert-card .action-area {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #f3f4f6;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-start;
            width: 100%;
        }
        .smart-alert-action-btn {
            width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center;
            border-radius: 50%; font-size: 1rem; background-color: #f3f4f6; color: #4b5563;
            transition: all 0.2s; border: none; cursor: pointer; text-decoration: none;
        }
        .smart-alert-action-btn:hover { background-color: #e5e7eb; }
        .smart-alert-action-btn.whatsapp:hover { color: #25D366; }
        .smart-alert-action-btn.telegram:hover { color: #0088CC; }
        .smart-alert-action-btn.call:hover { color: var(--info); }


        .analytics-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 1rem;
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 4px;
        }
        .analytics-tab-btn {
            flex: 1;
            padding: 0.6rem 0.5rem;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #4b5563;
            font-weight: 600;
            transition: all 0.3s ease;
            border-radius: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        .analytics-tab-btn:hover {
            background-color: #f3f4f6;
        }
        .analytics-tab-btn.active {
            color: var(--primary);
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .analytics-card {
            background: white; border-radius: 1rem; padding: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.07);
        }
        
        .currency-switcher {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 4px;
            background-color: #e5e7eb;
            border-radius: 8px;
        }
        .currency-btn {
            flex: 1;
            padding: 0.5rem;
            border: none;
            background-color: transparent;
            color: #4b5563;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .currency-btn.active {
            background-color: #fff;
            color: var(--primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .hidden {
            display: none !important;
        }
        .toggle-switch {
            width: 50px;
            height: 28px;
            background-color: #e5e7eb;
            border-radius: 999px;
            padding: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .toggle-switch-handle {
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s ease-in-out;
        }
        .toggle-switch.active {
            background-color: var(--primary);
        }
        .toggle-switch.active .toggle-switch-handle {
            transform: translateX(22px);
        }

        .installment-item {
            display: flex; align-items: center; gap: 1rem; padding: 0.75rem; border-radius: 0.75rem;
            border: 1px solid #e5e7eb; transition: all 0.2s;
        }
        .installment-item.status-paid { background-color: #f0fdf4; border-color: #bbf7d0; }
        .installment-item.status-overdue { background-color: #fef2f2; border-color: #fecaca; }
        .installment-item.status-pending { background-color: #fff; }

        .installment-icon {
            font-size: 1.2rem; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
            border-radius: 50%; flex-shrink: 0;
        }
        .installment-item.status-paid .installment-icon { color: var(--secondary); background-color: #d1fae5; }
        .installment-item.status-overdue .installment-icon { color: var(--danger); background-color: #fee2e2; }
        .installment-item.status-pending .installment-icon { color: var(--primary); background-color: #e0e7ff; }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: #f9fafb;
            border-radius: 8px;
            border: 1px solid #f3f4f6;
        }
        .category-item-delete-btn {
            background: transparent;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            transition: color 0.2s ease;
            font-size: 1rem;
        }
        .category-item-delete-btn:hover {
            color: var(--danger);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
        }
        .achievement-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .achievement-badge .icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #d1d5db;
        }
        .achievement-badge .title {
            font-weight: 600;
            font-size: 0.8rem;
            color: #9ca3af;
        }
        .achievement-badge.unlocked {
            border-color: var(--accent);
            background-color: #fffbeb;
        }
        .achievement-badge.unlocked .icon {
            color: var(--accent);
            animation: bounceIn 0.5s;
        }
        .achievement-badge.unlocked .title {
            color: var(--text);
        }

        .report-modal-content .highlight {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }
        
        #aiSummaryCard ul {
            list-style-type: none;
            padding: 0;
        }
        #aiSummaryCard li {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }
        #aiSummaryCard li:not(:last-child){
            border-bottom: 1px solid #f3f4f6;
        }
        #aiSummaryCard .icon {
            flex-shrink: 0;
            padding-top: 3px;
        }
        #aiSummaryCard .text-success { color: #10B981; }
        #aiSummaryCard .text-danger { color: #EF4444; }
        body.modal-open {
    overflow: hidden;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen pb-20">
    <div id="loader">
        <div class="loader-spinner"></div>
    </div>

    <div id="toast" class="toast"></div>

    <div id="confirmModal" class="modal">
        <div class="modal-content text-center">
            <h2 id="confirmTitle" class="text-xl font-bold mb-4"></h2>
            <p id="confirmMessage" class="text-gray-600 mb-6"></p>
            <div class="flex justify-center gap-4">
                <button id="confirmCancelBtn" class="btn btn-gray w-28"></button>
                <button id="confirmOkBtn" class="btn btn-danger w-28"></button>
            </div>
        </div>
    </div>
    <div id="promptConfirmModal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <h2 id="promptConfirmTitle" class="text-xl font-bold mb-4"></h2>
Â  Â  Â  Â  Â  Â  <p id="promptConfirmMessage" class="text-gray-600 mb-4"></p>
Â  Â  Â  Â  Â  Â  <input type="text" id="promptConfirmInput" class="form-input mb-4" placeholder="">
Â  Â  Â  Â  Â  Â  <div class="flex justify-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="promptConfirmCancelBtn" class="btn btn-gray w-28"></button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="promptConfirmOkBtn" class="btn btn-danger w-28"></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
    
    <div id="achievementModal" class="modal">
        <div class="modal-content text-center p-8 bg-gradient-to-br from-yellow-50 to-orange-100">
            <div id="achievementIcon" class="text-6xl text-accent mb-4"></div>
            <h2 id="achievementTitle" class="text-2xl font-bold text-gray-800 mb-2"></h2>
            <p id="achievementDesc" class="text-gray-600 mb-6"></p>
            <button class="btn btn-primary w-full" data-modal-close="achievementModal" data-translate-key="greatBtn"></button>
        </div>
    </div>

    <div id="weeklyReportModal" class="modal">
        <div class="modal-content report-modal-content text-center">
            <i class="fas fa-chart-line text-4xl text-primary mb-4"></i>
            <h2 class="text-2xl font-bold mb-4" data-translate-key="weeklyReportTitle"></h2>
            <p class="text-gray-600 mb-6" data-translate-key="weeklyReportDesc"></p>
            <div class="space-y-4 text-center bg-gray-50 p-4 rounded-lg">
                <div>
                    <p class="text-sm text-gray-500" data-translate-key="weeklyReportCollected"></p>
                    <p id="reportCollected" class="highlight"></p>
                </div>
                <div>
                    <p class="text-sm text-gray-500" data-translate-key="weeklyReportNewLoans"></p>
                    <p id="reportNewLoans" class="highlight"></p>
                </div>
                <div>
                    <p class="text-sm text-gray-500" data-translate-key="weeklyReportTopPayer"></p>
                    <p id="reportTopPayer" class="text-lg font-semibold text-secondary"></p>
                </div>
            </div>
            <button class="btn btn-primary w-full mt-6" data-modal-close="weeklyReportModal" data-translate-key="greatBtn"></button>
        </div>
    </div>
    
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <h2 id="paymentTitle" class="text-xl font-bold mb-4" data-translate-key="paymentModalTitle"></h2>
            <form id="paymentForm">
                <input type="hidden" id="paymentReceiptId">
                <input type="hidden" id="originalDebtCurrency">
                <input type="hidden" id="paymentInstallmentIndex">

                <div class="mb-4">
                    <label class="block text-gray-700 mb-1" data-translate-key="paymentCurrency"></label>
                    <div id="paymentCurrencyToggle" class="flex gap-2 p-1 bg-gray-100 rounded-lg">
                        </div>
                </div>

                <div class="mb-4">
                    <label for="paidAmountInput" class="block text-gray-700 mb-1"></label>
                    <input type="number" id="paidAmountInput" min="1" class="form-input" required>
                </div>

                <div id="conversionInfo" class="hidden text-sm text-center bg-gray-100 p-3 rounded-lg mb-4"></div>

                <div class="mb-4">
                    <label for="paymentNoteInput" class="block text-gray-700 mb-1" data-translate-key="formNoteOptional"></label>
                    <input type="text" id="paymentNoteInput" class="form-input" data-translate-placeholder="paymentNotePlaceholder">
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" class="btn btn-gray" data-modal-close="paymentModal" data-translate-key="cancelBtn"></button>
                    <button type="submit" class="btn btn-success" data-translate-key="saveBtn"></button>
                </div>
            </form>
        </div>
    </div>
    <div id="addLoanModal" class="modal">
        <div class="modal-content">
            <h2 id="addLoanTitle" class="text-xl font-bold mb-4" data-translate-key="addLoanModalTitle"></h2>
            <form id="addLoanForm">
                <input type="hidden" id="addLoanReceiptId">
                <div class="mb-4">
                    <label for="newLoanAmountInput" class="block text-gray-700 mb-1" data-translate-key="formNewLoanAmountIQD"></label>
                    <input type="number" id="newLoanAmountInput" min="1" class="form-input" required>
                </div>
                <div class="mb-4">
                    <label for="newLoanNoteInput" class="block text-gray-700 mb-1" data-translate-key="formNoteOptional"></label>
                    <textarea id="newLoanNoteInput" class="form-input" rows="3" data-translate-placeholder="newLoanNotePlaceholder"></textarea>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" class="btn btn-gray" data-modal-close="addLoanModal" data-translate-key="cancelBtn"></button>
                    <button type="submit" class="btn btn-primary" data-translate-key="addBtn"></button>
                </div>
            </form>
        </div>
    </div>

    <div id="receiptDetailsModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-center" id="modalTitle"></h2>
            <div id="modalContent" class="space-y-4"></div>
            
            <div id="debtorAiAnalysis" class="hidden p-3 mt-4 rounded-lg border text-sm"></div>
            <div id="modalContactActions"></div>
            <div id="modalActionsContainer" class="mt-6 border-t pt-4 flex flex-col gap-2">
                <button type="button" class="btn btn-gray w-full" data-modal-close="receiptDetailsModal">
                    <i class="fas fa-times"></i><span data-translate-key="closeBtn"></span>
                </button>
            </div>
        </div>
    </div>

    <header class="app-header">
        <div></div>
        <div class="flex justify-center items-center">
            <h1 id="headerTitle" class="animated-title text-xl font-bold" style="white-space: nowrap;"></h1>
        </div>
        <div class="flex justify-end items-center gap-2">
            <button id="notificationBellBtn" class="header-btn text-xl relative" data-translate-aria-label="notifications">
                <i class="fas fa-bell"></i>
                <span id="notificationBadge" class="absolute top-0 right-0 h-5 w-5 bg-danger text-white text-xs font-bold rounded-full flex items-center justify-center hidden"></span>
            </button>
        </div>
    </header>

    <main class="p-4">
        
        <section id="homePage" class="hidden fade-in">
            <div class="welcome-section">
                <h2 class="text-2xl font-bold mb-2" id="welcomeTitle"></h2>
                <p class="opacity-90" id="welcomeBody"></p>
            </div>
             <div class="smart-notifications-wrapper">
                <div id="smartNotifications"></div>
            </div>

            <div id="aiSummaryCard" class="hidden settings-card p-4 space-y-2 mb-6"></div>
            <div id="statsMainContainer" class="space-y-6">
                <div id="iqdStatsContainer">
                    <h3 class="text-xl font-bold mb-3 text-center text-gray-700" data-translate-key="currencyIQDTitle"></h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="stat-card stat-card-accent">
                            <p class="stat-card-label" data-translate-key="totalDebts"></p>
                            <p id="statsTotalInitialIQD" class="stat-card-number">0</p>
                        </div>
                        <div class="stat-card stat-card-secondary">
                            <p class="stat-card-label" data-translate-key="totalPaid"></p>
                            <p id="statsTotalPaidIQD" class="stat-card-number">0</p>
                        </div>
                        <div class="stat-card stat-card-danger col-span-2 md:col-span-1">
                            <p class="stat-card-label" data-translate-key="totalUnpaid"></p>
                            <p id="statsAmountIQD" class="stat-card-number">0</p>
                        </div>
                    </div>
                </div>
                <div id="usdStatsContainer">
                    <h3 class="text-xl font-bold mb-3 text-center text-gray-700" data-translate-key="currencyUSDTitle"></h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="stat-card stat-card-accent" style="background: linear-gradient(135deg, #0072ff 0%, #00c6ff 100%);">
                            <p class="stat-card-label" data-translate-key="totalDebts"></p>
                            <p id="statsTotalInitialUSD" class="stat-card-number">0</p>
                        </div>
                        <div class="stat-card stat-card-secondary" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                            <p class="stat-card-label" data-translate-key="totalPaid"></p>
                            <p id="statsTotalPaidUSD" class="stat-card-number">0</p>
                        </div>
                        <div class="stat-card stat-card-danger col-span-2 md:col-span-1" style="background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%);">
                            <p class="stat-card-label" data-translate-key="totalUnpaid"></p>
                            <p id="statsAmountUSD" class="stat-card-number">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card stat-card-primary max-w-sm mx-auto mt-6">
                    <p class="stat-card-label" data-translate-key="debtorsCount"></p>
                    <p id="statsCount" class="stat-card-number">0</p>
                </div>
            </div>
        </section>

        <section id="addPage" class="hidden fade-in">
            <h1 id="formTitle" class="text-2xl font-bold text-center mb-6"></h1>
            <form id="receiptForm" class="max-w-lg mx-auto space-y-4 bg-white p-6 rounded-2xl shadow" novalidate>
                <input type="hidden" id="editId">
                <div>
                    <label for="name" class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-user text-gray-400"></i><span data-translate-key="formName"></span></label>
                    <input type="text" id="name" class="form-input" required data-translate-placeholder="debtorNamePlaceholder">
                </div>
                <div>
                    <label for="phone" class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-phone text-gray-400"></i><span data-translate-key="formPhone"></span></label>
                    <input type="tel" id="phone" class="form-input" placeholder="07501234567" pattern="^07[0-9]{9}$">
                </div>
                
                <div id="loanAdvisorBox" class="hidden p-3 mt-2 rounded-lg border text-sm transition-all duration-300">
                    <div class="flex items-center gap-2 mb-2">
                        <i id="advisorIcon" class="text-xl"></i>
                        <h4 id="advisorTitle" class="font-bold"></h4>
                    </div>
                    <ul id="advisorDetails" class="space-y-1 pr-4 list-disc list-inside">
                    </ul>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-coins text-gray-400"></i><span data-translate-key="formCurrency"></span></label>
                    <div class="flex gap-2 p-1 bg-gray-100 rounded-lg">
                        <button type="button" data-currency="IQD" class="lang-btn flex-1 py-2 rounded-md active">Ø¯ÛŒÙ†Ø§Ø± (IQD)</button>
                        <button type="button" data-currency="USD" class="lang-btn flex-1 py-2 rounded-md">Ø¯Û†Ù„Ø§Ø± (USD)</button>
                    </div>
                    <input type="hidden" id="currency" value="IQD">
                </div>
                <div>
                    <label for="amount" class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-money-bill-wave text-gray-400"></i><span data-translate-key="formInitialAmountIQD"></span></label>
                    <input type="number" id="amount" min="1" class="form-input" required data-translate-placeholder="debtAmountPlaceholder">
                </div>
                <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="downPayment" class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-hand-holding-usd text-gray-400"></i><span data-translate-key="formDownPayment"></span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="downPayment" min="0" class="form-input" data-translate-placeholder="downPaymentPlaceholder">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
                <div>
                    <label for="date" class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-calendar-alt text-gray-400"></i><span data-translate-key="formDate"></span></label>
                    <input type="date" id="date" class="form-input" required>
                </div>
                
                <div class="border-t pt-4 space-y-4">
                    <div class="flex justify-between items-center">
                        <label class="font-bold text-gray-700 flex items-center gap-2"><i class="fas fa-calendar-week text-gray-400"></i><span data-translate-key="formInstallments"></span></label>
                        <div id="isInstallmentToggle" class="toggle-switch">
                            <div class="toggle-switch-handle"></div>
                        </div>
                    </div>
                    <div id="installmentFields" class="hidden space-y-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="installmentAmount" class="block text-gray-700 mb-1" data-translate-key="formInstallmentAmount"></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="installmentAmount" min="1" class="form-input" data-translate-placeholder="installmentAmountPlaceholder">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="installmentFrequency" class="block text-gray-700 mb-1" data-translate-key="formInstallmentFrequency"></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="installmentFrequency" class="form-input">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="monthly" data-translate-key="monthly"></option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="weekly" data-translate-key="weekly"></option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="firstInstallmentDate" class="block text-gray-700 mb-1" data-translate-key="formFirstInstallmentDate"></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="firstInstallmentDate" class="form-input" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="installmentPreview" class="text-sm text-center bg-gray-100 p-3 rounded-lg"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
                </div>

                <div id="dueDateContainer">
                    <label for="dueDateInput" class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-clock text-gray-400"></i><span data-translate-key="formDueDate"></span></label>
                    <input type="date" id="dueDateInput" class="form-input" required>
                </div>

                <div>
                    <label for="category" class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-tags text-gray-400"></i><span data-translate-key="formDebtType"></span></label>
                    <select id="category" class="form-input" required></select>
                </div>
                <div>
                    <label for="note" class="block text-gray-700 mb-1 flex items-center gap-2"><i class="fas fa-pencil-alt text-gray-400"></i><span data-translate-key="formNote"></span></label>
                    <textarea id="note" class="form-input" rows="3" data-translate-placeholder="ØªÛØ¨ÛŒÙ†ÛŒ Ø¦Ø§Ø±Û•Ø²ÙˆÙ…Û•Ù†Ø¯Ø§Ù†Û•"></textarea>
                </div>
                <div class="flex gap-2 pt-4">
                    <button type="submit" class="btn btn-success flex-1 py-3"><i class="fas fa-save"></i><span data-translate-key="saveBtn"></span></button>
                    <button id="cancelAddBtn" type="button" class="btn btn-gray flex-1 py-3"><i class="fas fa-times"></i><span data-translate-key="cancelBtn"></span></button>
                </div>
            </form>
        </section>
        
        <section id="viewPage" class="hidden fade-in">
            <div class="max-w-lg mx-auto">
                <div class="relative mb-4">
                    <input type="text" id="searchInput" data-translate-placeholder="searchPlaceholder" class="w-full border border-gray-200 rounded-xl px-4 py-3 pr-12 shadow-sm form-input" />
                    <i class="fas fa-search absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                <div id="filterContainer" class="mb-4"></div>
                <div id="receiptsList" class="space-y-4"></div>
            </div>
        </section>

        <section id="analyticsPage" class="hidden fade-in">
            <h1 class="text-2xl font-bold text-center mb-6" data-translate-key="analyticsTitle"></h1>
            <div id="analyticsContainer" class="max-w-lg mx-auto space-y-6"></div>
        </section>

        <section id="settingsPage" class="hidden fade-in">
            <h1 class="text-2xl font-bold text-center mb-6" data-translate-key="settingsTitle"></h1>
            <div class="max-w-lg mx-auto space-y-6">
                <div class="settings-card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-2" data-translate-key="langSettings"></h2>
                    <div class="flex gap-2 p-1 bg-gray-100 rounded-lg">
                        <button id="langKuBtn" class="lang-btn flex-1 p-2 rounded-md">Ú©ÙˆØ±Ø¯ÛŒ</button>
                        <button id="langArBtn" class="lang-btn flex-1 p-2 rounded-md">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                    </div>
                </div>
                <div class="settings-card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-2" data-translate-key="defaultCurrency"></h2>
                    <div class="flex gap-2 p-1 bg-gray-100 rounded-lg">
                        <button id="defaultIqdBtn" data-currency="IQD" class="lang-btn flex-1 p-2 rounded-md">Ø¯ÛŒÙ†Ø§Ø± (IQD)</button>
                        <button id="defaultUsdBtn" data-currency="USD" class="lang-btn flex-1 p-2 rounded-md">Ø¯Û†Ù„Ø§Ø± (USD)</button>
                    </div>
                </div>
                <div class="settings-card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-2" data-translate-key="businessNameSettings"></h2>
                    <div class="space-y-3 px-2">
                        <input type="text" id="businessNameInput" class="form-input" data-translate-placeholder="businessNamePlaceholder">
                        <button id="saveBusinessNameBtn" class="btn btn-primary w-full"><i class="fas fa-save mr-2"></i><span data-translate-key="saveBtn"></span></button>
                    </div>
                </div>
                
                <div class="settings-card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-2" data-translate-key="exchangeRateSettingsTitle"></h2>
                    <div class="space-y-3 px-2">
                        <label for="exchangeRateSettingInput" class="block text-gray-700 mb-1" data-translate-key="exchangeRateLabel"></label>
                        <input type="number" id="exchangeRateSettingInput" class="form-input" data-translate-placeholder="exchangeRatePlaceholder">
                        <button id="saveExchangeRateBtn" class="btn btn-primary w-full"><i class="fas fa-save mr-2"></i><span data-translate-key="saveBtn"></span></button>
                    </div>
                </div>
                <div class="settings-card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-2" data-translate-key="categoryManagementTitle"></h2>
                    <div class="space-y-3 px-2">
                        <div class="flex gap-2">
                            <input type="text" id="newCategoryInput" class="form-input flex-grow" data-translate-placeholder="newCategoryPlaceholder">
                            <button id="addCategoryBtn" class="btn btn-primary" style="padding: 0.75rem;"><i class="fas fa-plus"></i></button>
                        </div>
                        <div id="categoryListContainer" class="mt-4 space-y-2"></div>
                    </div>
                </div>
                
                <div class="settings-card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-2" data-translate-key="achievementsTitle"></h2>
                    <div id="achievementsContainer" class="achievement-grid px-2">
                    </div>
                </div>

                <div class="settings-card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-2" data-translate-key="dataManagement"></h2>
                    <div class="space-y-2">
                        <div id="clearAllBtn" class="settings-action-item">
                            <div class="settings-action-icon bg-red-100 text-red-600"><i class="fas fa-trash-alt"></i></div>
                            <div class="settings-action-text">
                                <h4 class="text-red-700" data-translate-key="deleteAllData"></h4>
                                <p class="text-red-500" data-translate-key="deleteAllDataDesc"></p>
                            </div>
                            <i class="fas fa-chevron-left settings-action-chevron text-red-400"></i>
                        </div>
                    </div>
                </div>
                <div class="settings-card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-2" data-translate-key="contactAndHelp"></h2>
                    <div class="space-y-2">
                        <a href="https://wa.me/9647766943398" target="_blank" class="settings-action-item">
                            <div class="settings-action-icon" style="background-color: #E0FDEF; color: #10B981;"><i class="fab fa-whatsapp"></i></div>
                            <div class="settings-action-text">
                                <h4 data-translate-key="contactViaWhatsapp"></h4>
                                <p data-translate-key="contactViaWhatsappDesc"></p>
                            </div>
                            <i class="fas fa-chevron-left settings-action-chevron"></i>
                        </a>
                        <a href="https://t.me/sarkar7216" target="_blank" class="settings-action-item">
                            <div class="settings-action-icon" style="background-color: #E0F2FE; color: #0088CC;"><i class="fab fa-telegram"></i></div>
                            <div class="settings-action-text">
                                <h4 data-translate-key="contactViaTelegram"></h4>
                                <p data-translate-key="contactViaTelegramDesc"></p>
                            </div>
                            <i class="fas fa-chevron-left settings-action-chevron"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.08)] flex justify-around items-center border-t h-[65px]">
        <button data-page="homePage" class="nav-btn active">
            <span class="nav-indicator"></span>
            <i class="fas fa-home text-xl"></i>
            <span class="text-xs" data-translate-key="navHome"></span>
        </button>
        <button data-page="viewPage" class="nav-btn">
            <span class="nav-indicator"></span>
            <i class="fas fa-sack-dollar text-xl"></i>
            <span class="text-xs" data-translate-key="navDebts"></span>
        </button>
        <div class="w-20 relative h-full flex justify-center">
            <button id="centralAddBtn" data-translate-title="addReceiptTitle" data-translate-aria-label="addReceiptTitle">
                <i class="fas fa-plus"></i>
            </button>
        </div>
        <button data-page="analyticsPage" class="nav-btn">
            <span class="nav-indicator"></span>
            <i class="fas fa-chart-pie text-xl"></i>
            <span class="text-xs" data-translate-key="navAnalytics"></span>
        </button>
        <button data-page="settingsPage" class="nav-btn">
            <span class="nav-indicator"></span>
            <i class="fas fa-cog text-xl"></i>
            <span class="text-xs" data-translate-key="navSettings"></span>
        </button>
    </nav>

<script>
    const translations = {
        ar: {
            pageTitle: 'ğŸ“’ Ø¯ÙØªØ± Ø§Ù„Ø¯ÙŠÙˆÙ† - Ù†Ø³Ø®Ø© Ø£ÙˆÙÙ„Ø§ÙŠÙ†', appTitle: 'Ø¯ÙØªØ± Ø§Ù„Ø¯ÙŠÙˆÙ†',
            navHome: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', navDebts: 'Ø§Ù„Ø¯ÙŠÙˆÙ†', navAnalytics: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª', navSettings: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
            addReceiptTitle: 'Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯', notifications: 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',
            greatBtn: 'Ø±Ø§Ø¦Ø¹!',
            welcomeStatusOverdueTitle: "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±ØŒ Ø§Ù†ØªØ¨Ù‡!",
            welcomeStatusOverdueBody: "Ù„Ø¯ÙŠÙƒ {count} Ù…Ù† Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© Ø¨Ù…Ø¬Ù…ÙˆØ¹ {amount}.",
            welcomeStatusDueSoonTitle: "Ù†Ù‡Ø§Ø±Ùƒ Ø³Ø¹ÙŠØ¯ØŒ ÙƒÙ† Ù†Ø´ÙŠØ·Ø§Ù‹ Ø§Ù„ÙŠÙˆÙ…!",
            welcomeStatusDueSoonBody: "Ù‡Ù†Ø§Ùƒ {count} Ø¯ÙŠÙ† Ø¨Ù…Ø¬Ù…ÙˆØ¹ {amount} ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø³Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.",
            welcomeDueTodayBody: "{count} Ø¯ÙŠÙ† Ø¨Ù…Ø¬Ù…ÙˆØ¹ {amount} ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø³Ø¯Ø§Ø¯ **Ø§Ù„ÙŠÙˆÙ…**ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.",
Â  Â  Â  Â  Â  Â  welcomeDueTomorrowBody: "{count} Ø¯ÙŠÙ† Ø¨Ù…Ø¬Ù…ÙˆØ¹ {amount} ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø³Ø¯Ø§Ø¯ **ØºØ¯Ø§Ù‹**ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.",
Â  Â  Â  Â  Â  Â  welcomeDueInXDaysBody: "{count} Ø¯ÙŠÙ† Ø¨Ù…Ø¬Ù…ÙˆØ¹ {amount} ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø®Ù„Ø§Ù„ **{days} Ø£ÙŠØ§Ù…**ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.",
            welcomeStatusOkTitle: "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±ØŒ ÙƒÙ„ Ø´ÙŠØ¡ ØªØ­Øª Ø§Ù„Ø³ÙŠØ·Ø±Ø©!",
            welcomeStatusOkBody: "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø¯ÙŠÙˆÙ† Ù…ØªØ£Ø®Ø±Ø© Ø£Ùˆ Ø¹Ø§Ø¬Ù„Ø©. Ø¹Ù…Ù„Ø§Ù‹ Ø±Ø§Ø¦Ø¹Ø§Ù‹!",
            msgGreeting: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø³ÙŠØ¯/Ø© {name}ØŒ", msgBodyTitle: "Ù‡Ø°Ù‡ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø®Ø§Øµ Ø¨ÙƒÙ…:",
            msgTotalLoan: "ğŸ”¸ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:", msgPaid: "ğŸ”¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:", msgRemaining: "ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:",
            msgType: "ğŸ·ï¸ Ø§Ù„Ù†ÙˆØ¹:", msgStartDate: "ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:", msgDueDate: "ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:", msgPhone: "ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:", msgNote: "ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:",
            msgHistoryTitle: "ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:", msgHistoryInitialLoan: "Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„ÙŠ", msgHistoryAddedLoan: "Ø¯ÙŠÙ† Ù…Ø¶Ø§Ù", msgHistoryPayment: "Ø¯ÙØ¹Ø©",
            msgThanks: "Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§.",
            msgThanksWithBusiness: "Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§.\n*{businessName}*",
            msgPaidFully: "ØªÙ… Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ†ÙƒÙ… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„. Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§.",
            confirmSure: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
            welcomeFirstTimeTitle: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¯ÙØªØ± Ø§Ù„Ø¯ÙŠÙˆÙ†! ğŸ“’",
Â  Â  Â  Â  Â  Â  welcomeFirstTimeBody: "Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„ØªÙ†Ø¸ÙŠÙ… Ø¯ÙŠÙˆÙ†ÙƒØŸ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± (+) Ø§Ù„ÙƒØ¨ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„ Ø¯ÙŠÙ† Ù„Ùƒ.",
            welcomeGreetingMorning: 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±', welcomeGreetingAfternoon: 'Ù†Ù‡Ø§Ø±Ùƒ Ø³Ø¹ÙŠØ¯', welcomeGreetingEvening: 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±',
            debtorsCount: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†ÙŠÙ†', totalDebts: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†', totalPaid: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ„Ù…', totalUnpaid: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ',
            currencyIQDTitle: 'Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ (IQD)', currencyUSDTitle: 'Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)',
            emptyStateNoItems: 'Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£ÙŠ Ø¯ÙŠÙˆÙ†.', emptyStateAddItem: 'Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯', emptyStateNoResults: 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬.',
            searchPlaceholder: 'ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ',
            cardStatusPaid: 'Ù…Ø¯ÙÙˆØ¹', cardStatusOverdue: 'Ù…ØªØ£Ø®Ø±', cardStatusPending: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
            cardTotalLoan: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙ†:', cardPaidAmount: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:', cardRemainingAmount: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:',
            cardPayBtn: 'Ø¯ÙØ¹', cardAddLoanBtn: 'Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯', cardDetailsBtn: 'ØªÙØ§ØµÙŠÙ„',
            formName: 'ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…', formPhone: 'ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', formCurrency: 'ğŸª™ Ø§Ù„Ø¹Ù…Ù„Ø©', formInitialAmountIQD: 'ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ÙˆÙ„ÙŠ (Ø¯.Ø¹)', formInitialAmountUSD: 'ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ÙˆÙ„ÙŠ ($)', formDate: 'ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®', formDueDate: 'ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚', formDebtType: 'ğŸ·ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙŠÙ†', formNote: 'ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª',
            debtorNamePlaceholder: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†', debtAmountPlaceholder: 'Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†',
            saveBtn: 'Ø­ÙØ¸', cancelBtn: 'Ø¥Ù„ØºØ§Ø¡', addBtn: 'Ø¥Ø¶Ø§ÙØ©',
            confirmDeleteTitle: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ', confirmDeleteMsg: 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥ÙŠØµØ§Ù„.',
            yesBtn: 'Ù†Ø¹Ù…', noBtn: 'Ù„Ø§',
            receiptDeletedToast: 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­.',
            receiptUpdatedToast: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥ÙŠØµØ§Ù„!', receiptAddedToast: 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠØµØ§Ù„ Ø¬Ø¯ÙŠØ¯!',
            formErrorFillFields: 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.',
            formErrorInvalidPhone: 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 07 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 11 Ø±Ù‚Ù…Ù‹Ø§.',
            detailsModalTotalLoan: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙ†', detailsModalTotalPaid: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹', detailsModalRemaining: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ',
            detailsModalType: 'Ø§Ù„Ù†ÙˆØ¹:', detailsModalStartDate: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:', detailsModalDueDate: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:', detailsModalPhone: 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:', detailsModalNote: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª:', detailsModalStatus: 'Ø§Ù„Ø­Ø§Ù„Ø©:',
            notRegistered: 'ØºÙŠØ± Ù…Ø³Ø¬Ù„', none: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯',
            detailsModalContact: 'Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø¯ÙŠÙ†', detailsModalWhatsapp: 'ÙˆØ§ØªØ³Ø§Ø¨', detailsModalTelegram: 'ØªÙ„ÙŠØ¬Ø±Ø§Ù…',
            detailsModalHistory: 'Ø³Ø¬Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„:', historyInitialLoan: 'Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„ÙŠ', historyAddedLoan: 'Ø¯ÙŠÙ† Ù…Ø¶Ø§Ù', historyPayment: 'Ø¯ÙØ¹Ø©',
            closeBtn: 'Ø¥ØºÙ„Ø§Ù‚', editBtn: 'ØªØ¹Ø¯ÙŠÙ„', deleteBtn: 'Ø­Ø°Ù',
            paymentModalTitle: 'ğŸ’° ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©', formPaidAmountIQD: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ (Ø¯.Ø¹)', formPaidAmountUSD: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ($)', formNoteOptional: 'ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)', paymentNotePlaceholder: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙØ¹Ø©',
            formInvalidAmount: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­.', paymentExceedsError: 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø£ÙƒØ¨Ø± Ù…Ù† {amount}.', paymentRecordedToast: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©.',
            addLoanModalTitle: 'â• Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯', formNewLoanAmountIQD: 'Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¯.Ø¹)', formNewLoanAmountUSD: 'Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ ($)', newLoanNotePlaceholder: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù…Ø¶Ø§Ù', newLoanAddedToast: 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯.',
            analyticsTitle: 'ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª', analyticsEmpty: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ù†Ø´Ø§Ø¡ ØªØ­Ù„ÙŠÙ„Ø§Øª.', reportRatioTitle: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠ', reportPaid: 'Ù…Ø¯ÙÙˆØ¹', reportRemaining: 'Ù…ØªØ¨Ù‚ÙŠ',
            reportByCategoryTitle: 'Ø§Ù„Ø¯ÙŠÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹', reportByMonthTitle: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø±', reportTotalDebtsLabel: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†',
            settingsTitle: 'âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', langSettings: 'ğŸŒ Ø§Ù„Ù„ØºØ©', dataManagement: 'ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
            deleteAllData: 'Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', deleteAllDataDesc: 'Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù….',
            confirmClearAllTitle: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ', confirmClearAllMsg: 'Ø³ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¥Ù„Ù‰ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.', allDataDeleted: 'ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª.',
            contactAndHelp: 'ğŸ“ Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©', contactViaWhatsapp: 'Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨', contactViaWhatsappDesc: 'Ù„Ø¥Ø±Ø³Ø§Ù„ Ø£Ø³Ø¦Ù„ØªÙƒ ÙˆØ§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ.', contactViaTelegram: 'Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ø¨Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù…', contactViaTelegramDesc: 'Ù„Ù„Ù…Ù†Ø§Ù‚Ø´Ø© ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.',
            notificationOverdue: 'ÙØ§Øª Ù…ÙˆØ¹Ø¯ Ø¯ÙŠÙ† {name}!',
            notificationDueSoon: 'ØªØ¨Ù‚Ù‰ {days} Ø£ÙŠØ§Ù… Ø¹Ù„Ù‰ Ø¯ÙŠÙ† {name}',
            smartAlertsEmptyTitle: 'ÙƒÙ„ Ø´ÙŠØ¡ Ø¹Ù„Ù‰ Ù…Ø§ ÙŠØ±Ø§Ù…!', smartAlertsEmptyDesc: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ù†ØªØ¸Ù…Ø©ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¹Ø§Ø¬Ù„Ø©.',
            smartAlertsTitleOverdue: "Ø¯ÙŠÙ† Ù…ØªØ£Ø®Ø±",
            smartAlertsTitleDueSoon: "Ø¯ÙŠÙ† Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚",
            formTitleEdit: 'ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥ÙŠØµØ§Ù„', formTitleAdd: 'â• Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠØµØ§Ù„ Ø¬Ø¯ÙŠØ¯',
            filterAll: 'Ø§Ù„ÙƒÙ„', filterUnpaid: 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹', filterPaid: 'Ù…Ø¯ÙÙˆØ¹', filterAlerts: 'ØªÙ†Ø¨ÙŠÙ‡Ø§Øª',
            defaultCurrency: "Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©", settingsSavedToast: "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª!",
            analyticsTabGeneral: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø¹Ø§Ù…Ø©', analyticsTabDeeper: 'ØªØ­Ù„ÙŠÙ„Ø§Øª Ø£Ø¹Ù…Ù‚', analyticsTabProfiles: 'Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†ÙŠÙ†',
            deeperAnalyticsTopDebtors: 'Ø£ÙƒØ¨Ø± 5 Ù…Ø¯ÙŠÙ†ÙŠÙ† (Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ)', deeperAnalyticsOldestDebts: 'Ø£Ù‚Ø¯Ù… 5 Ø¯ÙŠÙˆÙ† ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©',
            debtorProfileTitle: 'Ù…Ù„Ù Ø§Ù„Ù…Ø¯ÙŠÙ†', totalLoans: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø±ÙˆØ¶', remaining: 'Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ',
            confirmDuplicateNameTitle: 'Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„',
            confirmDuplicateNameMsg: 'Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ø®ØµØŸ',
            formInstallments: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù„Ù‰ Ø£Ù‚Ø³Ø§Ø·ØŸ',
            formNumberOfInstallments: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·',
            formInstallmentFrequency: 'Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø³Ø·',
            monthly: 'Ø´Ù‡Ø±ÙŠ',
            weekly: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ',
            installmentPlan: 'Ø®Ø·Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·',
            installmentPreviewText: '{count} {freq} Ø£Ù‚Ø³Ø§Ø· Ø¨Ù‚ÙŠÙ…Ø© {amount} Ù„ÙƒÙ„ Ù‚Ø³Ø·.',
            installment: 'Ù‚Ø³Ø·',
            dueDate: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚',
            businessNameSettings: 'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„/Ø§Ù„Ù…ØªØ¬Ø±',
            businessNamePlaceholder: 'Ù…Ø«Ø§Ù„: Ù…ØªØ¬Ø± Ø§Ù„Ø£Ù…Ù„',
            businessNameSavedToast: 'ØªÙ… Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„!',
            categoryManagementTitle: 'Ø¥Ø¯Ø§Ø±Ø© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¯ÙŠÙˆÙ†',
            newCategoryPlaceholder: 'Ø§Ø³Ù… Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯',
            categoryAddedToast: 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!',
            categoryDeletedToast: 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†ÙˆØ¹.',
            categoryExistsError: 'Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.',
            achievementsTitle: 'Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙŠ',
            achievementUnlocked: 'Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯!',
            weeklyReportTitle: 'Ù…Ù„Ø®ØµÙƒ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ',
            weeklyReportDesc: 'Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹ ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ! Ø¥Ù„ÙŠÙƒ Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹:',
            weeklyReportCollected: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ØµÙ„',
            weeklyReportNewLoans: 'Ø¯ÙŠÙˆÙ† Ø¬Ø¯ÙŠØ¯Ø©',
            weeklyReportTopPayer: 'Ø£ÙƒØ«Ø± Ù…Ù† Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¯ÙØ¹',
            noActivity: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·',
            ach_first_debt_title: 'Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰',
            ach_first_debt_desc: 'Ù‚Ù…Øª Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¯ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­.',
            ach_first_paid_title: 'Ø£ÙˆÙ„ Ø§Ù„ØºÙŠØ«',
            ach_first_paid_desc: 'ØªÙ… Ø³Ø¯Ø§Ø¯ Ø£ÙˆÙ„ Ø¯ÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.',
            ach_ten_debtors_title: 'Ù…Ø¯ÙŠØ± Ø´Ø¹Ø¨ÙŠ',
            ach_ten_debtors_desc: 'Ø£Ù†Øª Ø§Ù„Ø¢Ù† ØªØ¯ÙŠØ± Ø¯ÙŠÙˆÙ† 10 Ø£Ø´Ø®Ø§Øµ Ù…Ø®ØªÙ„ÙÙŠÙ†.',
            ach_milestone_1m_iqd_title: 'Ù…Ù„ÙŠÙˆÙ†ÙŠØ± Ø§Ù„Ø¯ÙŠÙˆÙ†',
            ach_milestone_1m_iqd_desc: 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ù„ÙŠÙˆÙ† Ø¯ÙŠÙ†Ø§Ø±.',
            ach_collector_1m_iqd_title: 'Ù…Ø­ØµÙ‘Ù„ Ø§Ù„Ù…Ù„ÙŠÙˆÙ†',
            ach_collector_1m_iqd_desc: 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„ØªÙŠ Ø­ØµÙ„ØªÙ‡Ø§ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ù„ÙŠÙˆÙ† Ø¯ÙŠÙ†Ø§Ø±.',
            ach_on_time_champ_title: 'Ø¨Ø·Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…',
            ach_on_time_champ_desc: 'Ù‚Ù…Øª Ø¨ØªØ­ØµÙŠÙ„ 5 Ø¯ÙŠÙˆÙ† Ø¯ÙˆÙ† Ø£ÙŠ ØªØ£Ø®ÙŠØ±.',
            advisorNewDebtor: 'Ù…Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯',
            advisorNewDebtorDesc: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø³Ø§Ø¨Ù‚ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù….',
            advisorNewDebtorNameDesc: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø³Ø§Ø¨Ù‚ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù….',
            advisorGoodDebtor: 'Ù…Ø¯ÙŠÙ† Ø¬ÙŠØ¯',
            advisorActiveDebts: 'Ù„Ø¯ÙŠÙ‡ Ø¯ÙŠÙˆÙ† Ù†Ø´Ø·Ø©',
            advisorRiskyDebtor: 'Ù…Ø¯ÙŠÙ† Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø®Ø·ÙˆØ±Ø©',
            advisorTotalRemaining: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:',
            advisorOverdueCount: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©:',
            advisorPaidCount: 'Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„:',
            advisorTotalLoans: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø±ÙˆØ¶:',
            analyticsCashFlowTitle: 'ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ (30 ÙŠÙˆÙ…Ù‹Ø§)',
            cashFlowExpected: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªÙˆÙ‚Ø¹',
            rescheduledNote: 'ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¯ÙŠÙ†.',
            aiSummaryTitle: 'ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø°ÙƒÙŠ',
            collectionsUp: 'Ø§Ø±ØªÙØ¹Øª ØªØ­ØµÙŠÙ„Ø§ØªÙƒ Ø¨Ù†Ø³Ø¨Ø© {percent}% Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ø¨Ø¹Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©.',
            collectionsDown: 'Ø§Ù†Ø®ÙØ¶Øª ØªØ­ØµÙŠÙ„Ø§ØªÙƒ Ø¨Ù†Ø³Ø¨Ø© {percent}% Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ø¨Ø¹Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©.',
            collectionsSame: 'ØªØ­ØµÙŠÙ„Ø§ØªÙƒ Ù…Ø³ØªÙ‚Ø±Ø© Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ.',
            topCategory: 'Ù…Ø¹Ø¸Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø¬Ø§Ø¡Øª Ù…Ù† ÙØ¦Ø© "{category}".',
            oldestDebtWarning: 'Ø§Ù†ØªØ¨Ù‡ Ù„Ø¯ÙŠÙ† {name}ØŒ Ø§Ù„Ù…Ø³ØªØ­Ù‚ Ù…Ù†Ø° {date}ØŒ ÙÙ‡Ùˆ Ø£Ù‚Ø¯Ù… Ø¯ÙŠÙ† ØºÙŠØ± Ù…Ø³Ø¯Ø¯.',
            notEnoughData: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù† Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ Ø°ÙƒÙŠ.',
            debtorAnalysisTitle: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ù„ÙˆÙƒ',
            paysLate: 'ÙŠÙ…ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¯ÙŠÙ† Ø¥Ù„Ù‰ Ø¯ÙØ¹ Ø¯ÙŠÙˆÙ†Ù‡ Ø¨Ù…ØªÙˆØ³Ø· ØªØ£Ø®ÙŠØ± {days} ÙŠÙˆÙ….',
            paysOnTime: 'Ù„Ø¯ÙŠÙ‡ Ø³Ø¬Ù„ Ø¬ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¯ÙØ¹ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯.',
            hasOverdueWarning: 'ØªÙ†Ø¨ÙŠÙ‡: Ù„Ø¯Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø®Øµ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ø¯ÙŠÙˆÙ† Ù…ØªØ¹Ø¯Ø¯Ø© Ù…ØªØ£Ø®Ø±Ø©.',
            noPaymentHistory: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¯ÙØ¹ Ù„ØªØ­Ù„ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯.',
            exchangeRateSettingsTitle: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù',
            exchangeRateLabel: 'Ø³Ø¹Ø± ØµØ±Ù 1 Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ',
            exchangeRatePlaceholder: 'Ù…Ø«Ø§Ù„: 1450',
            paymentNoteAuto: 'ØªÙ… Ø§Ù„Ø¯ÙØ¹ {amount} {currency} Ø¨Ø³Ø¹Ø± {rate}',
            paymentCurrency: 'Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹',
            pasteNotAllowed: 'Ø§Ù„Ù„ØµÙ‚ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„.',
            confirmClearAllThirdMsg: 'Ø³ÙŠØ¯ÙŠØŒ Ø£Ù†Ø¨Ù‡Ùƒ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø³ÙŠØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¯ÙŠÙˆÙ†Ùƒ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ù‹Ø§ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ',
            confirmClearAllPromptTitle: 'Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ',
Â  Â  Â  Â  Â  Â  confirmClearAllPromptMsg: 'Ù„Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ†ØŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© <strong class="text-danger">Ù…ÙˆØ§ÙÙ‚</strong> ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„:',
Â  Â  Â  Â  Â  Â  confirmClearAllPromptError: 'Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªÙŠ Ø£Ø¯Ø®Ù„ØªÙ‡Ø§ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.',
Â  Â  Â  Â  Â  Â  confirmBtn: 'ØªØ£ÙƒÙŠØ¯',
analysisAvgDelay: 'Ù…ØªÙˆØ³Ø· Ø£ÙŠØ§Ù… Ø§Ù„ØªØ£Ø®ÙŠØ±:',
            analysisOnTimeRate: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø¨Ø§Ù„Ù…ÙˆØ¹Ø¯:',
            analysisOverdueCount: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹:',
            analysisStatusGood: 'Ø³Ø¬Ù„ Ø¬ÙŠØ¯: Ù…Ù„ØªØ²Ù… Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù….',
            analysisStatusAverage: 'Ù…ØªÙˆØ³Ø·: ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¶ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø£Ø­ÙŠØ§Ù†Ø§Ù‹.',
            analysisStatusRisky: 'Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ÙŠÙ…ÙŠÙ„ Ù„Ù„ØªØ£Ø®ÙŠØ± ÙˆÙ„Ø¯ÙŠÙ‡ Ø¯ÙŠÙˆÙ† Ù…ØªØ£Ø®Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.',
            analysisStatusVeryRisky: 'Ø®Ø·ÙˆØ±Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹: Ù„Ø¯ÙŠÙ‡ Ø³Ø¬Ù„ ØªØ£Ø®ÙŠØ± ÙƒØ¨ÙŠØ± ÙˆØ¯ÙŠÙˆÙ† Ù…ØªØ£Ø®Ø±Ø© Ù…ØªØ¹Ø¯Ø¯Ø©.',
            analysisNotEnoughData: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© (Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø³Ø§Ø¨Ù‚Ø©) Ù„Ù„ØªØ­Ù„ÙŠÙ„.',
            daysUnit: 'Ø£ÙŠØ§Ù…',
            riskiestCategoryWarning: 'Ø§Ù†ØªØ¨Ù‡ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙŠÙ† "{category}" Ù„Ø¯ÙŠÙ‡ Ø£Ø¹Ù„Ù‰ Ù…Ø¨Ù„Øº Ù…ØªØ£Ø®Ø±.',
Â  Â  Â  Â  Â  Â  avgGlobalDelayInfo: 'Ø¨Ø§Ù„Ù…ØªÙˆØ³Ø·ØŒ ÙŠÙ‚ÙˆÙ… Ù…Ø¯ÙŠÙ†ÙˆÙƒ Ø¨Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø¨ØªØ£Ø®ÙŠØ± {days} ÙŠÙˆÙ… Ø¹Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯.',
Â  Â  Â  Â  Â  Â  atRiskMoneyWarning: 'Ù„Ø¯ÙŠÙƒ Ø¥Ø¬Ù…Ø§Ù„ÙŠ {amount} Ø¯ÙŠÙ†Ø§Ø± Ù…ØªØ£Ø®Ø± Ù„Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ…Ù‹Ø§ (Ø£Ù…ÙˆØ§Ù„ ÙÙŠ Ø®Ø·Ø±).'
,
Â  Â  Â  Â  Â  Â  formDownPayment: 'ğŸ’° Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©',
Â  Â  Â  Â  Â  Â  downPaymentPlaceholder: 'Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (Ø¥Ù† ÙˆØ¬Ø¯)',
Â  Â  Â  Â  Â  Â  formErrorDownPaymentExceeds: 'Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ.',
Â  Â  Â  Â  Â  Â  historyInitialDownPayment: 'Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©'
,
Â  Â  Â  Â  Â  Â  formInstallmentAmount: 'Ù…Ø¨Ù„Øº Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù…Ø­Ø¯Ø¯',
Â  Â  Â  Â  Â  Â  installmentAmountPlaceholder: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù„ÙƒÙ„ Ù‚Ø³Ø·',
Â  Â  Â  Â  Â  Â  installmentPreviewCalculated: 'Ø³ÙŠÙ†ØªØ¬ Ø¹Ù† Ù‡Ø°Ø§ {count} Ø£Ù‚Ø³Ø§Ø· {freq}.',
Â  Â  Â  Â  Â  Â  installmentPreviewCalculatedLast: 'Ø³ÙŠÙ†ØªØ¬ Ø¹Ù† Ù‡Ø°Ø§ {count} Ø£Ù‚Ø³Ø§Ø· {freq}. (Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø£Ø®ÙŠØ±: {lastAmount})',
Â  Â  Â  Â  Â  Â  formErrorInstallmentAmount: 'Ù…Ø¨Ù„Øº Ø§Ù„Ù‚Ø³Ø· ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ.'
,
Â  Â  Â  Â  Â  Â  formFirstInstallmentDate: 'ğŸ“… ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ù‚Ø³Ø·'
        },
        ku: {
            pageTitle: 'ğŸ“’ Ø¯Û•ÙØªÛ•Ø±ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù† - ÙˆÛ•Ø´Ø§Ù†ÛŒ Ø¦Û†ÙÙ„Ø§ÛŒÙ†', appTitle: 'Ø¯Û•ÙØªÛ•Ø±ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†',
            navHome: 'Ø³Û•Ø±Û•Ú©ÛŒ', navDebts: 'Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†', navAnalytics: 'Ø´ÛŒÚ©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†', navSettings: 'Ú•ÛÚ©Ø®Ø³ØªÙ†',
            addReceiptTitle: 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ', notifications: 'Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†',
            greatBtn: 'Ù†Ø§ÛŒØ§Ø¨Û•!',
            welcomeStatusOverdueTitle: "Ø¨Û•ÛŒØ§Ù†ÛŒØª Ø¨Ø§Ø´ØŒ Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ø¨Û•!",
            welcomeStatusOverdueBody: "ØªÛ† {count} Ù‚Û•Ø±Ø²ÛŒ Ú©Ø§Øª Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆØª Ù‡Û•ÛŒÛ• Ø¨Û• Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ {amount}.",
            welcomeStatusDueSoonTitle: "Ù†ÛŒÙˆÛ•Ú•Û†Øª Ø¨Ø§Ø´ØŒ Ø¦Û•Ù…Ú•Û† Ú†Ø§Ù„Ø§Ú© Ø¨Û•!",
            welcomeStatusDueSoonBody: "{count} Ù‚Û•Ø±Ø² Ø¨Û• Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ {amount} Ù„Û• Ú†Û•Ù†Ø¯ Ú•Û†Ú˜ÛŒ Ø¯Ø§Ù‡Ø§ØªÙˆÙˆØ¯Ø§ Ú©Ø§ØªÛŒØ§Ù† Ø¯ÛØªØŒ ØªÚ©Ø§ÛŒÛ• Ø¨Û•Ø¯ÙˆØ§Ø¯Ø§Ú†ÙˆÙˆÙ† Ø¨Ú©Û•.",
            welcomeDueTodayBody: "{count} Ù‚Û•Ø±Ø² Ø¨Û• Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ {amount} **Ø¦Û•Ù…Ú•Û†** Ú©Ø§ØªÛŒØ§Ù† Ø¯ÛØªØŒ ØªÚ©Ø§ÛŒÛ• Ø¨Û•Ø¯ÙˆØ§Ø¯Ø§Ú†ÙˆÙˆÙ† Ø¨Ú©Û•.",
Â  Â  Â  Â  Â  Â  welcomeDueTomorrowBody: "{count} Ù‚Û•Ø±Ø² Ø¨Û• Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ {amount} **Ø³Ø¨Û•ÛŒ** Ú©Ø§ØªÛŒØ§Ù† Ø¯ÛØªØŒ ØªÚ©Ø§ÛŒÛ• Ø¨Û•Ø¯ÙˆØ§Ø¯Ø§Ú†ÙˆÙˆÙ† Ø¨Ú©Û•.",
Â  Â  Â  Â  Â  Â  welcomeDueInXDaysBody: "{count} Ù‚Û•Ø±Ø² Ø¨Û• Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ {amount} Ù„Û• Ù…Ø§ÙˆÛ•ÛŒ **{days} Ú•Û†Ú˜ÛŒ ØªØ±Ø¯Ø§** Ú©Ø§ØªÛŒØ§Ù† Ø¯ÛØªØŒ ØªÚ©Ø§ÛŒÛ• Ø¨Û•Ø¯ÙˆØ§Ø¯Ø§Ú†ÙˆÙˆÙ† Ø¨Ú©Û•.",
            welcomeStatusOkTitle: "Ø¦ÛÙˆØ§Ø±Û•Øª Ø¨Ø§Ø´ØŒ Ù‡Û•Ù…ÙˆÙˆ Ø´ØªÛÚ© Ù„Û•Ú˜ÛØ± Ú©Û†Ù†ØªØ±Û†ÚµØ¯Ø§ÛŒÛ•!",
            welcomeStatusOkBody: "Ù‡ÛŒÚ† Ù‚Û•Ø±Ø²ÛÚ©ÛŒ Ø¯ÙˆØ§Ú©Û•ÙˆØªÙˆÙˆ ÛŒØ§Ù† Ø¨Û•Ù¾Û•Ù„Û•Øª Ù†ÛŒÛŒÛ•. Ú©Ø§Ø±ÛÚ©ÛŒ Ø¨Ø§Ø´Øª Ú©Ø±Ø¯ÙˆÙˆÛ•.",
            msgGreeting: "Ø³ÚµØ§Ùˆ Ø¨Û•Ú•ÛØ² {name}ØŒ", msgBodyTitle: "Ø¦Û•Ù…Û• Ù¾ÙˆØ®ØªÛ•ÛŒ Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Û•ØªØ§Ù†Û•:",
            msgTotalLoan: "ğŸ”¸ Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù‚Û•Ø±Ø²:", msgPaid: "ğŸ”¹ Ø¨Ú•ÛŒ Ø¯Ø±Ø§Ùˆ:", msgRemaining: "ğŸ’° Ø¨Ú•ÛŒ Ù…Ø§ÙˆÛ•:",
            msgType: "ğŸ·ï¸ Ø¬Û†Ø±:", msgStartDate: "ğŸ“… Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†:", msgDueDate: "ğŸ“… Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Ø§Ù†Û•ÙˆÛ•:", msgPhone: "ğŸ“ Ú˜. ØªÛ•Ù„Û•ÙÛ†Ù†:", msgNote: "ğŸ“ ØªÛØ¨ÛŒÙ†ÛŒ Ú¯Ø´ØªÛŒ:",
            msgHistoryTitle: "ğŸ“œ Ù…ÛÚ˜ÙˆÙˆÛŒ Ù…Ø§Ù…Û•ÚµÛ•Ú©Ø§Ù†:", msgHistoryInitialLoan: "Ù‚Û•Ø±Ø²ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ", msgHistoryAddedLoan: "Ù‚Û•Ø±Ø²ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§Ùˆ", msgHistoryPayment: "Ù¾Ø§Ø±Û•Ø¯Ø§Ù†",
            msgThanks: "Ø³ÙˆÙ¾Ø§Ø³ Ø¨Û† Ù…Ø§Ù…Û•ÚµÛ•Ú©Ø±Ø¯Ù† Ù„Û•Ú¯Û•ÚµÙ…Ø§Ù†.",
            msgThanksWithBusiness: "Ø³ÙˆÙ¾Ø§Ø³ Ø¨Û† Ù…Ø§Ù…Û•ÚµÛ•Ú©Ø±Ø¯Ù† Ù„Û•Ú¯Û•ÚµÙ…Ø§Ù†.\n*{businessName}*",
            msgPaidFully: "Ù‚Û•Ø±Ø²Û•Ú©Û•ØªØ§Ù† Ø¨Û• ØªÛ•ÙˆØ§ÙˆÛŒ Ø¯Ø±Ø§ÛŒÛ•ÙˆÛ•. Ø³ÙˆÙ¾Ø§Ø³ Ø¨Û† Ù…Ø§Ù…Û•ÚµÛ•Ú©Û•ØªØ§Ù†.",
            confirmSure: 'Ø¯ÚµÙ†ÛŒØ§ÛŒØŸ',
            welcomeFirstTimeTitle: "Ø¨Û•Ø®ÛØ±Ø¨ÛÛŒØª Ø¨Û† Ø¯Û•ÙØªÛ•Ø±ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†!",
Â  Â  Â  Â  Â  Â  welcomeFirstTimeBody: "Ù‡Û•Ù…Ùˆ Ø´ØªÛÚ© Ù„Û•Ú˜ÛØ± Ú©Ú•Û†Ù†ØªÚ•Û†Úµ Ø¯Ø§ÛŒÛ• Ø¦Ø§Ù…Ø§Ø¯Û•ÛŒØª Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†Øª Ú•ÛÚ©Ø¨Ø®Û•ÛŒØªØŸ Ú©Ø±ØªÛ• Ù„Û• Ø¯ÙˆÚ¯Ù…Û•ÛŒ Ú¯Û•ÙˆØ±Û•ÛŒ (+)Ù€ÛŒ Ø®ÙˆØ§Ø±Û•ÙˆÛ• Ø¨Ú©Û• Ø¨Û† ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ ÛŒÛ•Ú©Û•Ù… Ù‚Û•Ø±Ø²Øª.",
            welcomeGreetingMorning: 'Ø¨Û•ÛŒØ§Ù†ÛŒØª Ø¨Ø§Ø´', welcomeGreetingAfternoon: 'Ù†ÛŒÙˆÛ•Ú•Û†Øª Ø¨Ø§Ø´', welcomeGreetingEvening: 'Ø¦ÛÙˆØ§Ø±Û•Øª Ø¨Ø§Ø´',
            debtorsCount: 'Ú˜Ù…Ø§Ø±Û•ÛŒ Ù‚Û•Ø±Ø²Ø¯Ø§Ø±Û•Ú©Ø§Ù†', totalDebts: 'Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†', totalPaid: 'Ù¾Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§Ùˆ', totalUnpaid: 'Ù¾Ø§Ø±Û•ÛŒ Ù…Ø§ÙˆÛ•',
            currencyIQDTitle: 'Ø¯ÛŒÙ†Ø§Ø±ÛŒ Ø¹ÛØ±Ø§Ù‚ÛŒ (IQD)', currencyUSDTitle: 'Ø¯Û†Ù„Ø§Ø±ÛŒ Ø¦Û•Ù…Ø±ÛŒÚ©ÛŒ (USD)',
            emptyStateNoItems: 'Ù‡ÛŒÚ† Ù‚Û•Ø±Ø²ÛÚ© ØªÛ†Ù…Ø§Ø± Ù†Û•Ú©Ø±Ø§ÙˆÛ•.', emptyStateAddItem: 'Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ Ø²ÛŒØ§Ø¯Ø¨Ú©Û•', emptyStateNoResults: 'Ù‡ÛŒÚ† Ø¦Û•Ù†Ø¬Ø§Ù…ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•.',
            searchPlaceholder: 'ğŸ” Ú¯Û•Ú•Ø§Ù† Ø¨Û•Ù†Ø§Ùˆ ÛŒØ§Ù† Ø¨Û• Ú˜Ù…Ø§Ø±Û• Ù…ÙˆØ¨Ø§ÛŒÙ„',
            cardStatusPaid: 'Ø¯Ø±Ø§ÙˆÛ•ØªÛ•ÙˆÛ•', cardStatusOverdue: 'Ú©Ø§ØªÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆ', cardStatusPending: 'Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Û•',
            cardTotalLoan: 'Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù‚Û•Ø±Ø²:', cardPaidAmount: 'Ø¨Ú•ÛŒ Ø¯Ø±Ø§Ùˆ:', cardRemainingAmount: 'Ø¨Ú•ÛŒ Ù…Ø§ÙˆÛ•:',
            cardPayBtn: 'Ù¾Ø§Ø±Û•Ø¯Ø§Ù†', cardAddLoanBtn: 'Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ', cardDetailsBtn: 'ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ',
            formName: 'ğŸ‘¤ Ù†Ø§Ùˆ', formPhone: 'ğŸ“ Ú˜Ù…Ø§Ø±Û•ÛŒ ØªÛ•Ù„Û•ÙÛ†Ù†', formCurrency: 'ğŸª™ Ø¯Ø±Ø§Ùˆ', formInitialAmountIQD: 'ğŸ’° Ø¨Ú•ÛŒ Ù‚Û•Ø±Ø² (Ø¯.Ø¹)', formInitialAmountUSD: 'ğŸ’° Ø¨Ú•ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ ($)', formDate: 'ğŸ“… Ø¨Û•Ø±ÙˆØ§Ø±', formDueDate: 'ğŸ“… Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Ø§Ù†Û•ÙˆÛ•', formDebtType: 'ğŸ·ï¸ Ø¬Û†Ø±ÛŒ Ù‚Û•Ø±Ø²', formNote: 'ğŸ“ ØªÛØ¨ÛŒÙ†ÛŒ',
            debtorNamePlaceholder: 'Ù†Ø§ÙˆÛŒ Ú©Û•Ø³ÛŒ Ù‚Û•Ø±Ø²Ø¯Ø§Ø±', debtAmountPlaceholder: 'Ø¨Ú•ÛŒ Ù¾ÛØ¯Ø§Ù†ÛŒ Ù‚Û•Ø±Ø²',
            saveBtn: 'Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª', cancelBtn: 'Ù‡Û•ÚµÙˆÛ•Ø´Ø§Ù†Ø¯Ù†Û•ÙˆÛ•', addBtn: 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†',
            confirmDeleteTitle: 'Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ', confirmDeleteMsg: 'Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ù‚Û•Ø±Ø²Û• Ù†Ø§ØªÙˆØ§Ù†Ø±ÛØª Ø¨Ú¯Û•Ú•ÛÙ†Ø±ÛØªÛ•ÙˆÛ•.',
            yesBtn: 'Ø¨Û•ÚµÛ', noBtn: 'Ù†Û•Ø®ÛØ±',
            receiptDeletedToast: 'Ù‚Û•Ø±Ø²Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•.',
            receiptUpdatedToast: 'Ù‚Û•Ø±Ø²Û•Ú©Û• Ù†ÙˆÛ Ú©Ø±Ø§ÛŒÛ•ÙˆÛ•!', receiptAddedToast: 'Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§!',
            formErrorFillFields: 'ØªÚ©Ø§ÛŒÛ• Ø®Ø§Ù†Û• Ø¯Ø§ÙˆØ§Ú©Ø±Ø§ÙˆÛ•Ú©Ø§Ù† Ø¨Û• Ø¯Ø±ÙˆØ³ØªÛŒ Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•.',
            formErrorInvalidPhone: 'Ú˜Ù…Ø§Ø±Û•ÛŒ ØªÛ•Ù„Û•ÙÛ†Ù†Û•Ú©Û• Ù‡Û•ÚµÛ•ÛŒÛ•! ØªÚ©Ø§ÛŒÛ• Ø¯ÚµÙ†ÛŒØ§Ø¨Û• Ø¨Û• 07 Ø¯Û•Ø³ØªÙ¾ÛØ¯Û•Ú©Ø§Øª Ùˆ 11 Ú˜Ù…Ø§Ø±Û•ÛŒÛ•.',
            detailsModalTotalLoan: 'Ú©Û†ÛŒ Ù‚Û•Ø±Ø²', detailsModalTotalPaid: 'Ú©Û†ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø±Ø§Ùˆ', detailsModalRemaining: 'Ø¨Ú•ÛŒ Ù…Ø§ÙˆÛ•',
            detailsModalType: 'Ø¬Û†Ø±:', detailsModalStartDate: 'Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†:', detailsModalDueDate: 'Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ú©Û†ØªØ§ÛŒÛŒ:', detailsModalPhone: 'Ú˜. ØªÛ•Ù„Û•ÙÛ†Ù†:', detailsModalNote: 'ØªÛØ¨ÛŒÙ†ÛŒ:', detailsModalStatus: 'Ø¨Ø§Ø±ÙˆØ¯Û†Ø®:',
            notRegistered: 'ØªÛ†Ù…Ø§Ø±Ù†Û•Ú©Ø±Ø§ÙˆÛ•', none: 'Ù†ÛŒÛŒÛ•',
            detailsModalContact: 'Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ', detailsModalWhatsapp: 'ÙˆØ§ØªØ³Ø§Ù¾', detailsModalTelegram: 'ØªÛÙ„ÛŒÚ¯Ø±Ø§Ù…',
            detailsModalHistory: 'Ù…ÛÚ˜ÙˆÙˆÛŒ Ù‚Û•Ø±Ø²:', historyInitialLoan: 'Ù‚Û•Ø±Ø²ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ', historyAddedLoan: 'Ù‚Û•Ø±Ø²ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§Ùˆ', historyPayment: 'Ù¾Ø§Ø±Û•Ø¯Ø§Ù†',
            closeBtn: 'Ø¯Ø§Ø®Ø³ØªÙ†', editBtn: 'Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ', deleteBtn: 'Ø³Ú•ÛŒÙ†Û•ÙˆÛ•',
            paymentModalTitle: 'ğŸ’° ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù†', formPaidAmountIQD: 'Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø±Ø§Ùˆ (Ø¯.Ø¹)', formPaidAmountUSD: 'Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø±Ø§Ùˆ ($)', formNoteOptional: 'ğŸ“ ØªÛØ¨ÛŒÙ†ÛŒ (Ø¦Ø§Ø±Û•Ø²ÙˆÙˆÙ…Û•Ù†Ø¯Ø§Ù†Û•)', paymentNotePlaceholder: 'ØªÛØ¨ÛŒÙ†ÛŒ Ø¨Û† Ø¦Û•Ù… Ù¾Ø§Ø±Û•Ø¯Ø§Ù†Û•',
            formInvalidAmount: 'Ø¨Ú•ÛÚ©ÛŒ Ø¯Ø±ÙˆØ³Øª Ø¯Ø§Ø®Úµ Ø¨Ú©Û•.', paymentExceedsError: 'Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ù†Ø§ØªÙˆØ§Ù†ÛØª Ù„Û• {amount} Ø²ÛŒØ§ØªØ± Ø¨ÛØª.', paymentRecordedToast: 'Ù¾Ø§Ø±Û•Ø¯Ø§Ù† ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§.',
            addLoanModalTitle: 'â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ', formNewLoanAmountIQD: 'Ø¨Ú•ÛŒ Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ (Ø¯.Ø¹)', formNewLoanAmountUSD: 'Ø¨Ú•ÛŒ Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ ($)', newLoanNotePlaceholder: 'ØªÛØ¨ÛŒÙ†ÛŒ Ø¨Û† Ø¦Û•Ù… Ù‚Û•Ø±Ø²Û• Ø²ÛŒØ§Ø¯Ú©Ø±Ø§ÙˆÛ• Ø¨Ù†ÙˆÙˆØ³Û•', newLoanAddedToast: 'Ù‚Û•Ø±Ø²Û• Ù†ÙˆÛÛŒÛ•Ú©Û• Ø²ÛŒØ§Ø¯Ú©Ø±Ø§.',
            analyticsTitle: 'ğŸ“Š Ø´ÛŒÚ©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†', analyticsEmpty: 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛŒÛ• Ø¨Û† Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ø´ÛŒÚ©Ø§Ø±ÛŒ.', reportRatioTitle: 'Ú•ÛÚ˜Û•ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø±Ø§Ùˆ Ùˆ Ù…Ø§ÙˆÛ•', reportPaid: 'Ù¾Ø§Ø±Û•ÛŒ Ø¯Ø±Ø§ÙˆÛ•', reportRemaining: 'Ù¾Ø§Ø±Û•ÛŒ Ù…Ø§ÙˆÛ•',
            reportByCategoryTitle: 'Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù† Ø¨Û•Ù¾ÛÛŒ Ø¬Û†Ø±', reportByMonthTitle: 'Ú©Û†ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù† Ø¨Û•Ù¾ÛÛŒ Ù…Ø§Ù†Ú¯', reportTotalDebtsLabel: 'Ú©Û†ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†',
            settingsTitle: 'âš™ï¸ Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†', langSettings: 'ğŸŒ Ø²Ù…Ø§Ù†', dataManagement: 'ğŸ’¾ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§',
            deleteAllData: 'Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ø¯Ø§ØªØ§', deleteAllDataDesc: 'Ù‡Û•Ù…ÙˆÙˆ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù† Ø¨Û• ÛŒÛ•Ú©Ø¬Ø§Ø±ÛŒ Ø¨Ø³Ú•Û•ÙˆÛ•.',
            confirmClearAllTitle: 'Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ø¯Ø§ØªØ§ØŸ', confirmClearAllMsg: 'Ø¦Û•Ù… Ú©Ø§Ø±Û• Ù‡Û•Ù…ÙˆÙˆ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù† Ø¯Û•Ø³Ú•ÛØªÛ•ÙˆÛ• Ùˆ Ù†Ø§ØªÙˆØ§Ù†Ø±ÛØª Ø¨Ú¯Û•Ú•ÛÙ†Ø±ÛØªÛ•ÙˆÛ•.', allDataDeleted: 'Ù‡Û•Ù…ÙˆÙˆ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù† Ø³Ú•Ø§Ù†Û•ÙˆÛ•.',
            contactAndHelp: 'ğŸ“ Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ùˆ ÛŒØ§Ø±Ù…Û•ØªÛŒ', contactViaWhatsapp: 'Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ù„Û• Ú•ÛÚ¯Û•ÛŒ ÙˆØ§ØªØ³Ø§Ù¾', contactViaWhatsappDesc: 'Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø±Ø³ÛŒØ§Ø± Ùˆ Ù¾ÛØ´Ù†ÛŒØ§Ø±Û•Ú©Ø§Ù†Øª.', contactViaTelegram: 'Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ù„Û• Ú•ÛÚ¯Û•ÛŒ ØªÛÙ„ÛŒÚ¯Ø±Ø§Ù…', contactViaTelegramDesc: 'Ø¨Û† Ú¯ÙØªÙˆÚ¯Û† Ùˆ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ù†ÙˆÛØªØ±ÛŒÙ† Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ.',
            notificationOverdue: 'Ù‚Û•Ø±Ø²ÛŒ {name} Ú©Ø§ØªÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆÛ•!',
            notificationDueSoon: '{days} Ú•Û†Ú˜ÛŒ Ù…Ø§ÙˆÛ• Ø¨Û† Ù‚Û•Ø±Ø²ÛŒ {name}',
            smartAlertsEmptyTitle: 'Ù‡Û•Ù…ÙˆÙˆØ´ØªÛÚ© Ú•ÛÚ© Ùˆ Ù¾ÛÚ©Ù‡!', smartAlertsEmptyDesc: 'Ù‡ÛŒÚ† Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒÛŒÛ•Ú©ÛŒ Ø¨Û•Ù¾Û•Ù„Û• ÛŒØ§Ù† Ù‚Û•Ø±Ø²ÛŒ Ø¯ÙˆØ§Ú©Û•ÙˆØªÙˆÙˆ Ø¨ÙˆÙˆÙ†ÛŒ Ù†ÛŒÛŒÛ•.',
            smartAlertsTitleOverdue: "Ù‚Û•Ø±Ø²ÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆ",
            smartAlertsTitleDueSoon: "Ú©Ø§ØªÛŒ Ù‚Û•Ø±Ø² Ù†Ø²ÛŒÚ©Û•",
            formTitleEdit: 'ğŸ“ Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†ÛŒ Ù‚Û•Ø±Ø²', formTitleAdd: 'â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ',
            filterAll: 'Ù‡Û•Ù…ÙˆÙˆÛŒ', filterUnpaid: 'Ù†Û•Ø¯Ø±Ø§ÙˆÛ•', filterPaid: 'Ø¯Ø±Ø§ÙˆÛ•', filterAlerts: 'Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒ',
            defaultCurrency: "Ø¯Ø±Ø§ÙˆÛŒ Ø³Û•Ø±Û•Ú©ÛŒ", settingsSavedToast: "Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù† Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø§Ù†!",
            analyticsTabGeneral: 'Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ú¯Ø´ØªÛŒ', analyticsTabDeeper: 'Ø´ÛŒÚ©Ø§Ø±ÛŒÛŒ Ù‚ÙˆÙˆÚµØªØ±', analyticsTabProfiles: 'Ù¾Ø±Û†ÙØ§ÛŒÙ„ÛŒ Ù‚Û•Ø±Ø²Ø¯Ø§Ø±',
            deeperAnalyticsTopDebtors: 'Ù¥ Ù‚Û•Ø±Ø²Ø¯Ø§Ø±ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ (Ø¨Û•Ù¾ÛÛŒ Ø¨Ú•ÛŒ Ù…Ø§ÙˆÛ•)', deeperAnalyticsOldestDebts: 'Ù¥ Ú©Û†Ù†ØªØ±ÛŒÙ† Ù‚Û•Ø±Ø²ÛŒ Ù†Û•Ø¯Ø±Ø§ÙˆÛ•',
            debtorProfileTitle: 'Ù¾Ø±Û†ÙØ§ÛŒÙ„ÛŒ Ù‚Û•Ø±Ø²Ø¯Ø§Ø±', totalLoans: 'Ú©Û†ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†', remaining: 'Ù…Ø§ÙˆÛ•',
            confirmDuplicateNameTitle: 'Ù†Ø§Ùˆ Ø¯ÙˆÙˆØ¨Ø§Ø±Û•ÛŒÛ•',
            confirmDuplicateNameMsg: 'Ø¦Û•Ù… Ù†Ø§ÙˆÛ• Ù¾ÛØ´ØªØ± ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§ÙˆÛ•ØŒ Ø¯ÚµÙ†ÛŒØ§ÛŒ Ø¯Û•ØªÛ•ÙˆÛØª Ù‚Û•Ø±Ø²ÛÚ©ÛŒ Ù†ÙˆÛ Ø¨Û• Ù‡Û•Ù…Ø§Ù† Ù†Ø§Ùˆ Ø²ÛŒØ§Ø¯ Ø¨Ú©Û•ÛŒØªØŸ',
            formInstallments: 'Ø¯Ø§Ù†Û•ÙˆÛ• Ø¨Û•Ø´ÛÙˆÛ•ÛŒ Ù‚ÛŒØ³ØªØŸ',
            formNumberOfInstallments: 'Ú˜Ù…Ø§Ø±Û•ÛŒ Ù‚ÛŒØ³ØªÛ•Ú©Ø§Ù†',
            formInstallmentFrequency: 'Ø¬Û†Ø±ÛŒ Ù‚ÛŒØ³Øª',
            monthly: 'Ù…Ø§Ù†Ú¯Ø§Ù†Û•',
            weekly: 'Ù‡Û•ÙØªØ§Ù†Û•',
            installmentPlan: 'Ù¾Ù„Ø§Ù†ÛŒ Ù‚ÛŒØ³ØªÛ•Ú©Ø§Ù†',
            installmentPreviewText: '{count} Ù‚ÛŒØ³ØªÛŒ {freq} Ø¨Û• Ø¨Ú•ÛŒ {amount} Ø¨Û† Ù‡Û•Ø± Ù‚ÛŒØ³ØªÛÚ©.',
            installment: 'Ù‚ÛŒØ³Øª',
            dueDate: 'Ú©Ø§ØªÛŒ Ø¯Ø§Ù†Û•ÙˆÛ•',
            businessNameSettings: 'Ù†Ø§ÙˆÛŒ Ú©Ø§Ø±Û•Ú©Û•Øª (Ø¯ÙˆÚ©Ø§Ù†/Ù…Ø§Ø±Ú©ÛØª)',
            businessNamePlaceholder: 'Ù†Ù…ÙˆÙˆÙ†Û•: Ù…Ø§Ø±Ú©ÛØªÛŒ Ù‡ÛŒÙˆØ§',
            businessNameSavedToast: 'Ù†Ø§ÙˆÛŒ Ú©Ø§Ø±Û•Ú©Û•Øª Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø§!',
            categoryManagementTitle: 'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ø¬Û†Ø±Û•Ú©Ø§Ù†ÛŒ Ù‚Û•Ø±Ø²',
            newCategoryPlaceholder: 'Ù†Ø§ÙˆÛŒ Ø¬Û†Ø±ÛŒ Ù†ÙˆÛ',
            categoryAddedToast: 'Ø¬Û†Ø±Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§!',
            categoryDeletedToast: 'Ø¬Û†Ø±Û•Ú©Û• Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•.',
            categoryExistsError: 'Ø¦Û•Ù… Ø¬Û†Ø±Û• Ù¾ÛØ´ØªØ± Ø²ÛŒØ§Ø¯Ú©Ø±Ø§ÙˆÛ•.',
            achievementsTitle: 'Ø¯Û•Ø³ØªÚ©Û•ÙˆØªÛ•Ú©Ø§Ù†Ù…',
            achievementUnlocked: 'Ø¯Û•Ø³ØªÚ©Û•ÙˆØªÛÚ©ÛŒ Ù†ÙˆÛ!',
            weeklyReportTitle: 'Ù¾ÙˆØ®ØªÛ•ÛŒ Ù‡Û•ÙØªØ§Ù†Û•Øª',
            weeklyReportDesc: 'Ú©Ø§Ø±ÛÚ©ÛŒ Ù†Ø§ÛŒØ§Ø¨Øª Ú©Ø±Ø¯ Ù„Û• Ù‡Û•ÙØªÛ•ÛŒ Ú•Ø§Ø¨Ø±Ø¯ÙˆÙˆØ¯Ø§! Ø¦Û•Ù…Û•Ø´ Ù¾ÙˆØ®ØªÛ•ÛŒÛ•Ú©ÛŒ Ø®ÛØ±Ø§ÛŒÛ•:',
            weeklyReportCollected: 'Ú©Û†ÛŒ ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§Ùˆ',
            weeklyReportNewLoans: 'Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ',
            weeklyReportTopPayer: 'Ú†Ø§Ù„Ø§Ú©ØªØ±ÛŒÙ† Ù¾Ø§Ø±Û•Ø¯Û•Ø±',
            noActivity: 'Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú© Ù†Û•Ø¨ÙˆÙˆÛ•',
            ach_first_debt_title: 'ÛŒÛ•Ú©Û•Ù… Ù‡Û•Ù†Ú¯Ø§Ùˆ',
            ach_first_debt_desc: 'ÛŒÛ•Ú©Û•Ù… Ù‚Û•Ø±Ø²Øª Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯.',
            ach_first_paid_title: 'ÛŒÛ•Ú©Û•Ù… Ø¨Û•Ø±Ù‡Û•Ù…',
            ach_first_paid_desc: 'ÛŒÛ•Ú©Û•Ù… Ù‚Û•Ø±Ø² Ø¨Û• ØªÛ•ÙˆØ§ÙˆÛŒ ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§ÛŒÛ•ÙˆÛ•.',
            ach_ten_debtors_title: 'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±ÛŒ Ø¬Û•Ù…Ø§ÙˆÛ•Ø±ÛŒ',
            ach_ten_debtors_desc: 'Ø¦ÛØ³ØªØ§ ØªÛ† Ù‚Û•Ø±Ø²ÛŒ Ù¡Ù  Ú©Û•Ø³ÛŒ Ø¬ÛŒØ§ÙˆØ§Ø² Ø¨Û•Ú•ÛÙˆÛ•Ø¯Û•Ø¨Û•ÛŒØª.',
            ach_milestone_1m_iqd_title: 'Ù…Ù„ÛŒÛ†Ù†Û•Ø±ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†',
            ach_milestone_1m_iqd_desc: 'Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ø¦Û•Ùˆ Ù‚Û•Ø±Ø²Ø§Ù†Û•ÛŒ Ø¯Ø§ÙˆØªÛ• Ø²ÛŒØ§ØªØ±Û• Ù„Û• ÛŒÛ•Ú© Ù…Ù„ÛŒÛ†Ù† Ø¯ÛŒÙ†Ø§Ø±.',
            ach_collector_1m_iqd_title: 'Ú©Û†Ú©Û•Ø±Û•ÙˆÛ•ÛŒ Ù…Ù„ÛŒÛ†Ù†ÛŒ',
            ach_collector_1m_iqd_desc: 'Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ø¦Û•Ùˆ Ù¾Ø§Ø±Ø§Ù†Û•ÛŒ ÙˆÛ•Ø±ØªÚ¯Ø±ØªÛ†ØªÛ•ÙˆÛ• Ø²ÛŒØ§ØªØ±Û• Ù„Û• ÛŒÛ•Ú© Ù…Ù„ÛŒÛ†Ù† Ø¯ÛŒÙ†Ø§Ø±.',
            ach_on_time_champ_title: 'Ù¾Ø§ÚµÛ•ÙˆØ§Ù†ÛŒ Ù¾Ø§Ø¨Û•Ù†Ø¯Ø¨ÙˆÙˆÙ†',
            ach_on_time_champ_desc: 'Ù¥ Ù‚Û•Ø±Ø²Øª Ø¨Û•Ø¨Û Ù‡ÛŒÚ† Ø¯ÙˆØ§Ú©Û•ÙˆØªÙ†ÛÚ© ÙˆÛ•Ø±Ú¯Ø±ØªÛ†ØªÛ•ÙˆÛ•.',
            advisorNewDebtor: 'Ù‚Û•Ø±Ø²Ø¯Ø§Ø±ÛŒ Ù†ÙˆÛ',
            advisorNewDebtorDesc: 'Ù‡ÛŒÚ† ØªÛ†Ù…Ø§Ø±ÛÚ©ÛŒ Ù¾ÛØ´ÙˆÙˆ Ø¨Û† Ø¦Û•Ù… Ú˜Ù…Ø§Ø±Û•ÛŒÛ• Ù†ÛŒÛŒÛ•.',
            advisorNewDebtorNameDesc: 'Ù‡ÛŒÚ† ØªÛ†Ù…Ø§Ø±ÛÚ©ÛŒ Ù¾ÛØ´ÙˆÙˆ Ø¨Û† Ø¦Û•Ù… Ù†Ø§ÙˆÛ• Ù†ÛŒÛŒÛ•.',
            advisorGoodDebtor: 'Ù‚Û•Ø±Ø²Ø¯Ø§Ø±ÛÚ©ÛŒ Ø¨Ø§Ø´',
            advisorActiveDebts: 'Ù‚Û•Ø±Ø²ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù‡Û•ÛŒÛ•',
            advisorRiskyDebtor: 'Ù‚Û•Ø±Ø²Ø¯Ø§Ø±ÛŒ Ù…Û•ØªØ±Ø³ÛŒØ¯Ø§Ø±',
            advisorTotalRemaining: 'Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù‚Û•Ø±Ø²ÛŒ Ù…Ø§ÙˆÛ•:',
            advisorOverdueCount: 'Ú˜Ù…Ø§Ø±Û•ÛŒ Ù‚Û•Ø±Ø²ÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆ:',
            advisorPaidCount: 'Ù‚Û•Ø±Ø²ÛŒ Ø¯Ø±Ø§ÙˆÛ•ØªÛ•ÙˆÛ•:',
            advisorTotalLoans: 'Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†:',
            analyticsCashFlowTitle: 'Ù¾ÛØ´Ø¨ÛŒÙ†ÛŒ Ù‡Ø§ØªÙ†ÛŒ Ù¾Ø§Ø±Û• (Ù£Ù  Ú•Û†Ú˜)',
            cashFlowExpected: 'Ø¨Ú•ÛŒ Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Ú©Ø±Ø§Ùˆ',
            rescheduledNote: 'Ù‚Û•Ø±Ø²Û•Ú©Û• Ø¯ÙˆÙˆØ¨Ø§Ø±Û• Ø®Ø´ØªÛ•Ø¨Û•Ù†Ø¯ Ú©Ø±Ø§ÛŒÛ•ÙˆÛ•.',
            aiSummaryTitle: 'ğŸ“Š Ù¾ÙˆØ®ØªÛ•ÛŒ Ø²ÛŒØ±Û•Ú©',
            collectionsUp: 'Ú©Û†Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾Ø§Ø±Û•Ú©Ø§Ù†Øª {percent}% Ø²ÛŒØ§Ø¯ÛŒ Ú©Ø±Ø¯ÙˆÙˆÛ• Ø¨Û•Ø±Ø§ÙˆØ±Ø¯ Ø¨Û• Ù§ Ú•Û†Ú˜ÛŒ Ú•Ø§Ø¨Ø±Ø¯ÙˆÙˆ.',
            collectionsDown: 'Ú©Û†Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾Ø§Ø±Û•Ú©Ø§Ù†Øª {percent}% Ú©Û•Ù…ÛŒ Ú©Ø±Ø¯ÙˆÙˆÛ• Ø¨Û•Ø±Ø§ÙˆØ±Ø¯ Ø¨Û• Ù§ Ú•Û†Ú˜ÛŒ Ú•Ø§Ø¨Ø±Ø¯ÙˆÙˆ.',
            collectionsSame: 'Ú©Û†Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾Ø§Ø±Û•Ú©Ø§Ù†Øª ÙˆÛ•Ú© Ù§ Ú•Û†Ú˜ÛŒ Ú•Ø§Ø¨Ø±Ø¯ÙˆÙˆ Ø¨ÙˆÙˆÛ•.',
            topCategory: 'Ø²Û†Ø±ØªØ±ÛŒÙ† Ù¾Ø§Ø±Û•Øª Ù„Û• Ù‚Û•Ø±Ø²ÛŒ Ø¬Û†Ø±ÛŒ "{category}" ÙˆÛ•Ø±Ú¯Ø±ØªÙˆÙˆÛ•.',
            oldestDebtWarning: 'Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒ Ù‚Û•Ø±Ø²ÛŒ {name} Ø¨Û•ØŒ Ú©Û• Ù„Û• {date} ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§ÙˆÛ• Ùˆ Ú©Û†Ù†ØªØ±ÛŒÙ† Ù‚Û•Ø±Ø²ÛŒ Ù†Û•Ø¯Ø±Ø§ÙˆÛ•ÛŒ ØªÛ†ÛŒÛ•.',
            notEnoughData: 'Ù‡ÛØ´ØªØ§ Ø¯Ø§ØªØ§ÛŒ Ù¾ÛÙˆÛŒØ³Øª Ù†ÛŒÛŒÛ• Ø¨Û† Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ù¾ÙˆØ®ØªÛ•ÛŒ Ø²ÛŒØ±Û•Ú©.',
            debtorAnalysisTitle: 'Ø´ÛŒÚ©Ø§Ø±ÛŒÛŒ Ú•Û•ÙØªØ§Ø±',
            paysLate: 'Ø¦Û•Ù… Ù‚Û•Ø±Ø²Ø¯Ø§Ø±Û• Ø¨Û• Ø´ÛÙˆÛ•ÛŒÛ•Ú©ÛŒ Ú¯Ø´ØªÛŒ Ù…Ø§Ù…Û•ÚµÛ•Ú©Ø§Ù†ÛŒ {days} Ú•Û†Ú˜ Ø¯ÙˆØ§Ø¯Û•Ø®Ø§Øª.',
            paysOnTime: 'ØªÛ†Ù…Ø§Ø±ÛÚ©ÛŒ Ø¨Ø§Ø´ÛŒ Ù‡Û•ÛŒÛ• Ù„Û• Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ù„Û• Ú©Ø§ØªÛŒ Ø®Û†ÛŒØ¯Ø§.',
            hasOverdueWarning: 'Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ø¨Û•ØŒ Ø¦Û•Ù… Ú©Û•Ø³Û• Ú†Û•Ù†Ø¯ÛŒÙ† Ù‚Û•Ø±Ø²ÛŒ Ú©Ø§Øª Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆÛŒ Ù‡Û•ÛŒÛ•.',
            noPaymentHistory: 'Ù‡ÛØ´ØªØ§ Ù…ÛÚ˜ÙˆÙˆÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù†ÛŒ Ù†ÛŒÛŒÛ• Ø¨Û† Ø´ÛŒÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†.',
            exchangeRateSettingsTitle: 'Ú•ÛÚ©Ø®Ø³ØªÙ†ÛŒ Ù†Ø±Ø®ÛŒ Ú¯Û†Ú•ÛŒÙ†Û•ÙˆÛ•',
            exchangeRateLabel: 'Ù†Ø±Ø®ÛŒ Ù¡ Ø¯Û†Ù„Ø§Ø±ÛŒ Ø¦Û•Ù…Ø±ÛŒÚ©ÛŒ Ø¨Û•Ø±Ø§Ù…Ø¨Û•Ø± Ø¯ÛŒÙ†Ø§Ø±ÛŒ Ø¹ÛØ±Ø§Ù‚ÛŒ',
            exchangeRatePlaceholder: 'Ù†Ù…ÙˆÙˆÙ†Û•: 1450',
            paymentNoteAuto: 'Ø¯Ø±Ø§ÙˆÛ• Ø¨Û• {amount} {currency} Ø¨Û• Ù†Ø±Ø®ÛŒ {rate}',
            paymentCurrency: 'Ø¯Ø±Ø§ÙˆÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù†',
            pasteNotAllowed: 'Ú©Û†Ù¾ÛŒ Ù¾Û•ÛŒØ³Øª Ú•ÛÚ¯Û•Ù¾ÛØ¯Ø±Ø§Ùˆ Ù†ÛŒÛŒÛ• Ù„Û•Ù… Ø®Ø§Ù†Û•ÛŒÛ•.',
            confirmClearAllThirdMsg: 'Ø¨Û•Ú•ÛØ² Ø¬Ø§Ø±ÛŒÚ©ÛŒ ØªØ± Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Øª Ø¯Û•Ú©Û•Ù…Û•ÙˆÛ• Ú©Û•Ø¦Û•Ù… Ú©Ø§Ø±Û• Ù‡Û•Ù…Ùˆ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†Øª Ø¯Û•Ø³Ú•ÛØªÛ•ÙˆÛ• Ø¦ÛØ³ØªØ§ Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù„Û•Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ ØŒØŸ',
            confirmClearAllPromptTitle: 'Ø¯ÚµÙ†ÛŒØ§ÛŒÛŒ Ú©Û†ØªØ§ÛŒÛŒ',
Â  Â  Â  Â  Â  Â  confirmClearAllPromptMsg: 'Ø¨Û† Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†ØŒ ØªÚ©Ø§ÛŒÛ• ÙˆØ´Û•ÛŒ <strong class="text-danger">Ú•Ø§Ø²ÛŒÙ…</strong> Ø¨Ù†ÙˆÙˆØ³Û• Ù„Û• Ø®ÙˆØ§Ø±Û•ÙˆÛ•:',
Â  Â  Â  Â  Â  Â  confirmClearAllPromptError: 'ÙˆØ´Û•ÛŒ Ù†ÙˆÙˆØ³Ø±Ø§Ùˆ Ù‡Û•ÚµÛ•ÛŒÛ•.',
Â  Â  Â  Â  Â  Â  confirmBtn: 'Ø¯ÚµÙ†ÛŒØ§Ù…',
analysisAvgDelay: 'ØªÛÚ©Ú•Ø§ÛŒ Ú•Û†Ú˜Ø§Ù†ÛŒ Ø¯ÙˆØ§Ú©Û•ÙˆØªÙ†:',
            analysisOnTimeRate: 'Ú•ÛÚ˜Û•ÛŒ Ø¯Ø§Ù†Û•ÙˆÛ• Ù„Û•Ú©Ø§ØªÛŒ Ø®Û†ÛŒØ¯Ø§:',
            analysisOverdueCount: 'Ú˜Ù…Ø§Ø±Û•ÛŒ Ù‚Û•Ø±Ø²ÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆÛŒ Ø¦ÛØ³ØªØ§:',
            analysisStatusGood: 'ØªÛ†Ù…Ø§Ø±ÛŒ Ø¨Ø§Ø´: Ø¨Û• Ú¯Ø´ØªÛŒ Ù¾Ø§Ø¨Û•Ù†Ø¯Û• Ø¨Û• Ú©Ø§ØªÛ•ÙˆÛ•.',
            analysisStatusAverage: 'ØªÛ†Ù…Ø§Ø±ÛŒ Ù…Ø§Ù…Ù†Ø§ÙˆÛ•Ù†Ø¯: Ù‡Û•Ù†Ø¯ÛÚ© Ø¬Ø§Ø± Ø¯ÙˆØ§Ú©Û•ÙˆØªÙ†ÛŒ Ù†ÛŒØ´Ø§Ù†Ø¯Ø§ÙˆÛ•.',
            analysisStatusRisky: 'Ù…Û•ØªØ±Ø³ÛŒØ¯Ø§Ø±: Ù…Û•ÛŒÙ„ÛŒ Ø¯ÙˆØ§Ú©Û•ÙˆØªÙ†ÛŒ Ù‡Û•ÛŒÛ• Ùˆ Ù‚Û•Ø±Ø²ÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆÛŒ Ù‡Û•ÛŒÛ•.',
            analysisStatusVeryRisky: 'Ø²Û†Ø± Ù…Û•ØªØ±Ø³ÛŒØ¯Ø§Ø±: ØªÛ†Ù…Ø§Ø±ÛÚ©ÛŒ Ø®Ø±Ø§Ù¾ÛŒ Ø¯ÙˆØ§Ú©Û•ÙˆØªÙ†ÛŒ Ù‡Û•ÛŒÛ• Ùˆ Ú†Û•Ù†Ø¯ÛŒÙ† Ù‚Û•Ø±Ø²ÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆÛŒ Ù‡Û•ÛŒÛ•.',
            analysisNotEnoughData: 'Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ù¾ÛÙˆÛŒØ³Øª (Ù¾Ø§Ø±Û•Ø¯Ø§Ù†ÛŒ Ù¾ÛØ´ÙˆÙˆ) Ù†ÛŒÛŒÛ• Ø¨Û† Ø´ÛŒÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†.',
            daysUnit: 'Ú•Û†Ú˜',
            riskiestCategoryWarning: 'Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ø¨Û•ØŒ Ø¬Û†Ø±ÛŒ Ù‚Û•Ø±Ø²ÛŒ "{category}" Ø²Û†Ø±ØªØ±ÛŒÙ† Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•ÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆÛŒ Ù‡Û•ÛŒÛ•.',
Â  Â  Â  Â  Â  Â  avgGlobalDelayInfo: 'Ø¨Û• ØªÛÚ©Ú•Ø§ØŒ Ù‚Û•Ø±Ø²Ø¯Ø§Ø±Û•Ú©Ø§Ù†Øª {days} Ú•Û†Ú˜ Ø¯ÙˆØ§ÛŒ Ú©Ø§ØªÛŒ Ø¯ÛŒØ§Ø±ÛŒÚ©Ø±Ø§Ùˆ Ù¾Ø§Ø±Û• Ø¯Û•Ø¯Û•Ù†Û•ÙˆÛ•.',
Â  Â  Â  Â  Â  Â  atRiskMoneyWarning: 'ØªÛ† Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ {amount} Ø¯ÛŒÙ†Ø§Ø±Øª Ù‡Û•ÛŒÛ• Ú©Û• Ø²ÛŒØ§ØªØ± Ù„Û• Ù£Ù  Ú•Û†Ú˜Û• Ú©Ø§ØªÛŒ Ø¨Û•Ø³Û•Ø±Ú†ÙˆÙˆÛ• (Ù¾Ø§Ø±Û•ÛŒ Ù…Û•ØªØ±Ø³ÛŒØ¯Ø§Ø±).'
,
Â  Â  Â  Â  Â  Â  formDownPayment: 'ğŸ’° Ù¾ÛØ´Û•Ú©ÛŒ (Down Payment)',
Â  Â  Â  Â  Â  Â  downPaymentPlaceholder: 'Ø¨Ú•ÛŒ Ù¾ÛØ´Û•Ú©ÛŒ (Ø¦Û•Ú¯Û•Ø± Ù‡Û•Ø¨ÛØª)',
Â  Â  Â  Â  Â  Â  formErrorDownPaymentExceeds: 'Ø¨Ú•ÛŒ Ù¾ÛØ´Û•Ú©ÛŒ Ù†Ø§Ø¨ÛØª Ù„Û• Ø¨Ú•ÛŒ Ú¯Ø´ØªÛŒ Ù‚Û•Ø±Ø² Ø²ÛŒØ§ØªØ± Ø¨ÛØª.',
Â  Â  Â  Â  Â  Â  historyInitialDownPayment: 'Ù¾ÛØ´Û•Ú©ÛŒ'
,
Â  Â  Â  Â  Â  Â  formInstallmentAmount: 'Ø¨Ú•ÛŒ Ù‚ÛŒØ³ØªÛŒ Ø¯ÛŒØ§Ø±ÛŒÚ©Ø±Ø§Ùˆ',
Â  Â  Â  Â  Â  Â  installmentAmountPlaceholder: 'Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ø¨Û† Ù‡Û•Ø± Ù‚ÛŒØ³ØªÛÚ©',
Â  Â  Â  Â  Â  Â  installmentPreviewCalculated: 'Ø¨Û•Ù… Ø´ÛÙˆÛ•ÛŒÛ• {count} Ù‚ÛŒØ³ØªÛŒ {freq} Ø¯Ø±ÙˆØ³Øª Ø¯Û•Ø¨ÛØª.',
Â  Â  Â  Â  Â  Â  installmentPreviewCalculatedLast: 'Ø¨Û•Ù… Ø´ÛÙˆÛ•ÛŒÛ• {count} Ù‚ÛŒØ³ØªÛŒ {freq} Ø¯Ø±ÙˆØ³Øª Ø¯Û•Ø¨ÛØª. (Ø¯ÙˆØ§ Ù‚ÛŒØ³Øª: {lastAmount})',
Â  Â  Â  Â  Â  Â  formErrorInstallmentAmount: 'Ø¨Ú•ÛŒ Ù‚ÛŒØ³Øª Ø¯Û•Ø¨ÛØª Ù„Û• Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù‚Û•Ø±Ø² Ú©Û•Ù…ØªØ± Ø¨ÛØª.'
,
Â  Â  Â  Â  Â  Â  formFirstInstallmentDate: 'ğŸ“… Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ ÛŒÛ•Ú©Û•Ù… Ù‚ÛŒØ³Øª'
        }
    };
    
    // --- IndexedDB Database Logic ---
    const DB_NAME = 'OfflineDebtDB';
    const DB_VERSION = 1;
    const STORE_NAME = 'receipts';
    let db;

    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, DB_VERSION);
            request.onerror = () => reject("Error opening DB");
            request.onsuccess = (event) => {
                db = event.target.result;
                resolve();
            };
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                }
            };
        });
    }

    function getStore(mode) {
        const transaction = db.transaction(STORE_NAME, mode);
        return transaction.objectStore(STORE_NAME);
    }

    function addReceiptDB(receipt) {
        return new Promise((resolve, reject) => {
            const request = getStore('readwrite').add(receipt);
            request.onsuccess = () => resolve();
            request.onerror = (e) => reject("Error adding receipt: " + e.target.error);
        });
    }

    function getReceipts() {
        return new Promise((resolve, reject) => {
            const request = getStore('readonly').getAll();
            request.onsuccess = () => resolve(request.result);
            request.onerror = (e) => reject("Error getting receipts: " + e.target.error);
        });
    }

    function updateReceiptDB(receipt) {
        return new Promise((resolve, reject) => {
            const request = getStore('readwrite').put(receipt);
            request.onsuccess = () => resolve();
            request.onerror = (e) => reject("Error updating receipt: " + e.target.error);
        });
    }

    function deleteReceiptDB(id) {
        return new Promise((resolve, reject) => {
            const request = getStore('readwrite').delete(id);
            request.onsuccess = () => resolve();
            request.onerror = (e) => reject("Error deleting receipt: " + e.target.error);
        });
    }

    function clearAllReceiptsDB() {
        return new Promise((resolve, reject) => {
            const request = getStore('readwrite').clear();
            request.onsuccess = () => resolve();
            request.onerror = (e) => reject("Error clearing store: " + e.target.error);
        });
    }
    // --- End of IndexedDB Logic ---


    let currentLang = localStorage.getItem('appLanguage') || 'ku';
    let defaultCurrency = localStorage.getItem('defaultCurrency') || 'IQD';
    let globalExchangeRate = 1450; // Default rate for $1
    let currentFilter = 'unpaid';

    function getTranslation(key, replacements = {}) {
        let text = (translations[currentLang] && translations[currentLang][key]) || key;
        for (const placeholder in replacements) {
            text = text.replace(`{${placeholder}}`, replacements[placeholder]);
        }
        return text;
    }

    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('appLanguage', lang);
        document.documentElement.lang = lang;
        document.documentElement.dir = (lang === 'ar' || lang === 'ku') ? 'rtl' : 'ltr';
        
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.dataset.translateKey;
            if (el.tagName === 'OPTION') {
                el.textContent = getTranslation(key);
            } else {
                el.innerHTML = getTranslation(key);
            }
        });
        document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
            el.placeholder = getTranslation(el.dataset.translatePlaceholder);
        });
        document.querySelectorAll('[data-translate-title]').forEach(el => {
            el.title = getTranslation(el.dataset.translateTitle);
        });
         document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
             el.setAttribute('aria-label', getTranslation(el.dataset.translateAriaLabel));
        });
        updateDynamicUIText();
    }
    
    function updateDynamicUIText() {
        document.getElementById('langKuBtn').classList.toggle('active', currentLang === 'ku');
        document.getElementById('langArBtn').classList.toggle('active', currentLang === 'ar');
        updateDefaultCurrencyUI();
        populateCategoryOptions();
        buildFilterButtons();
        const currentPage = document.querySelector('main > section:not(.hidden)');
        if (currentPage && currentPage.id === 'viewPage') {
            loadReceipts();
        }
    }

    function loadAndApplySettings() {
        const savedLang = localStorage.getItem('appLanguage') || 'ku';
        setLanguage(savedLang);

        const savedCurrency = localStorage.getItem('defaultCurrency') || 'IQD';
        defaultCurrency = savedCurrency;
        updateDefaultCurrencyUI();
        
        const savedBusinessName = localStorage.getItem('businessName') || '';
        document.getElementById('businessNameInput').value = savedBusinessName;

        const savedRate = localStorage.getItem('exchangeRate');
        if (savedRate) {
            globalExchangeRate = parseFloat(savedRate);
        }
        document.getElementById('exchangeRateSettingInput').value = globalExchangeRate;
    }

    function showLoader() { document.getElementById('loader').classList.remove('hidden'); }
    function hideLoader() { document.getElementById('loader').classList.add('hidden'); }
    function showModal(id) {
    document.body.classList.add('modal-open'); document.getElementById(id).classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show');
    if (!document.querySelector('.modal.show')) {
             document.body.classList.remove('modal-open');
        } }

    function showToast(message, type = 'info') {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.className = `toast show ${type}`;
        setTimeout(() => toast.classList.remove("show"), 3000);
    }

    function showConfirm({ title, message, okText, cancelText, okClass = 'btn-danger' }) {
        return new Promise((resolve) => {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            const okBtn = document.getElementById('confirmOkBtn');
            const cancelBtn = document.getElementById('confirmCancelBtn');
            okBtn.textContent = okText;
            okBtn.className = `btn ${okClass} w-28`;
            cancelBtn.textContent = cancelText;

            const cleanup = () => {
                closeModal('confirmModal');
                okBtn.removeEventListener('click', handleOk);
                cancelBtn.removeEventListener('click', handleCancel);
            };
            const handleOk = () => { resolve(true); cleanup(); };
            const handleCancel = () => { resolve(false); cleanup(); };

            okBtn.addEventListener('click', handleOk, { once: true });
            cancelBtn.addEventListener('click', handleCancel, { once: true });
            
            showModal('confirmModal');
        });
    }
    function showPromptConfirm({ title, message, placeholder, okText, cancelText, requiredWord }) {
Â  Â  Â  Â  return new Promise((resolve) => {
Â  Â  Â  Â  Â  Â  document.getElementById('promptConfirmTitle').textContent = title;
Â  Â  Â  Â  Â  Â  document.getElementById('promptConfirmMessage').innerHTML = message;
Â  Â  Â  Â  Â  Â  const input = document.getElementById('promptConfirmInput');
Â  Â  Â  Â  Â  Â  input.placeholder = placeholder;
Â  Â  Â  Â  Â  Â  input.value = '';

Â  Â  Â  Â  Â  Â  const okBtn = document.getElementById('promptConfirmOkBtn');
Â  Â  Â  Â  Â  Â  const cancelBtn = document.getElementById('promptConfirmCancelBtn');
Â  Â  Â  Â  Â  Â  okBtn.textContent = okText;
Â  Â  Â  Â  Â  Â  cancelBtn.textContent = cancelText;

Â  Â  Â  Â  Â  Â  const cleanup = () => {
Â  Â  Â  Â  Â  Â  Â  Â  closeModal('promptConfirmModal');
Â  Â  Â  Â  Â  Â  Â  Â  okBtn.removeEventListener('click', handleOk);
Â  Â  Â  Â  Â  Â  Â  Â  cancelBtn.removeEventListener('click', handleCancel);
Â  Â  Â  Â  Â  Â  Â  Â  input.removeEventListener('input', validateInput);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const validateInput = () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (input.value.trim() === requiredWord) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  okBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  okBtn.classList.remove('opacity-50', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  okBtn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  okBtn.classList.add('opacity-50', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleOk = () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (input.value.trim() === requiredWord) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve(true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cleanup();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const handleCancel = () => {
Â  Â  Â  Â  Â  Â  Â  Â  resolve(false);
Â  Â  Â  Â  Â  Â  Â  Â  cleanup();
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  okBtn.disabled = true;
Â  Â  Â  Â  Â  Â  okBtn.classList.add('opacity-50', 'cursor-not-allowed');

Â  Â  Â  Â  Â  Â  input.addEventListener('input', validateInput);
Â  Â  Â  Â  Â  Â  okBtn.addEventListener('click', handleOk);
Â  Â  Â  Â  Â  Â  cancelBtn.addEventListener('click', handleCancel, { once: true });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showModal('promptConfirmModal');
Â  Â  Â  Â  });
Â  Â  }

    function formatLocaleDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return new Intl.DateTimeFormat('en-CA').format(date); 
    }
    
    function getTotalPaid(receipt) { return (receipt.payments || []).reduce((sum, p) => sum + p.amount, 0); }
    function getTotalLoan(receipt) {
        const initialAmount = receipt.initialAmount || 0;
        const additionalLoans = (receipt.loanHistory || []).reduce((sum, l) => sum + l.amount, 0);
        return initialAmount + additionalLoans;
    }
    function getRemainingAmount(receipt) { return getTotalLoan(receipt) - getTotalPaid(receipt); }
    function formatWithEquivalent(amount, currency, breakLine = false) {
        const primarySymbol = currency === 'USD' ? '$' : 'Ø¯.Ø¹';
        const formattedPrimary = amount.toLocaleString(undefined, { maximumFractionDigits: (currency === 'USD' ? 2 : 0) });

        let equivalentAmount = null;
        let equivalentSymbol = '';
        const rate = typeof globalExchangeRate === 'number' && globalExchangeRate > 0 ? globalExchangeRate : 1450;

        if (currency === 'IQD' && amount !== 0) { 
            equivalentAmount = amount / rate;
            equivalentSymbol = '$';
        } else if (currency === 'USD' && amount !== 0) { 
            equivalentAmount = amount * rate;
            equivalentSymbol = 'Ø¯.Ø¹';
        }

        let equivalentString = '';
        if (equivalentAmount !== null) {
            const formattedEquivalent = equivalentAmount.toLocaleString(undefined, { maximumFractionDigits: (equivalentSymbol === '$' ? 2 : 0) });
            if (breakLine) {
            equivalentString = `<br><span style="font-size: 0.8em; color: #6b7280; opacity: 0.85;">(â‰ˆ ${formattedEquivalent} ${equivalentSymbol})</span>`;
        } else {
            equivalentString = ` <small style="color: #6b7280; opacity: 0.85;">(â‰ˆ ${formattedEquivalent} ${equivalentSymbol})</small>`;
        }
        }

        return `${formattedPrimary} <span class="text-base font-medium">${primarySymbol}</span>${equivalentString}`;
    }
    
    async function showPage(id, button = null) {
        showLoader();
        document.querySelectorAll("main > section").forEach(s => s.classList.add("hidden"));
        const targetPage = document.getElementById(id);
        if (targetPage) {
            targetPage.classList.remove("hidden");
  window.scrollTo(0, 0); // Added: Scroll window to top          
            targetPage.classList.add("fade-in");
            if (id === 'viewPage') {
                buildFilterButtons();
                await updateBadges();
                await loadReceipts();
            }
            else if (id === 'analyticsPage') await generateAnalytics();
            else if (id === 'settingsPage') {
                renderCategoryManager();
                renderAchievementsPage();
            }
            else if (id === 'homePage') {
                updateCurrencyDisplayOrder();
                await updateDashboardStats();
                await checkSmartNotifications();
                await updateWelcomeSection();
                await generateAiSummary();
            }
        }
        document.querySelectorAll(".nav-btn").forEach(btn => btn.classList.remove("active"));
        if (button) button.classList.add("active");
        hideLoader();
    }

    function prepareAddPage() {
        resetForm();
        const today = new Date();
        const formattedDate = formatLocaleDate(today);
        document.getElementById('date').value = formattedDate;
        document.getElementById('dueDateInput').value = formattedDate;

        document.getElementById('currency').value = defaultCurrency;
        document.querySelectorAll('#receiptForm .lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.currency === defaultCurrency);
        });
        updateAmountLabel(defaultCurrency); 
        showPage('addPage');
    }

    async function saveReceipt() {
Â  Â  Â  Â  const id = document.getElementById('editId').value;
Â  Â  Â  Â  const name = document.getElementById('name').value.trim();
Â  Â  Â  Â  const phone = document.getElementById('phone').value.trim();
Â  Â  Â  Â  const amount = parseFloat(document.getElementById('amount').value);
        const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
Â  Â  Â  Â  const date = document.getElementById('date').value;
Â  Â  Â  Â  const dueDate = document.getElementById('dueDateInput').value;
Â  Â  Â  Â  const category = document.getElementById('category').value;
Â  Â  Â  Â  const note = document.getElementById('note').value.trim();
Â  Â  Â  Â  const currency = document.getElementById('currency').value;
Â  Â  Â  Â  const isInstallment = document.getElementById('isInstallmentToggle').classList.contains('active');

Â  Â  Â  Â  if (phone && !/^07[0-9]{9}$/.test(phone)) {
Â  Â  Â  Â  Â  Â  showToast(getTranslation('formErrorInvalidPhone'), 'danger');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!name || (!id && (isNaN(amount) || amount <= 0)) || !date || !category) {
Â  Â  Â  Â  Â  Â  showToast(getTranslation('formErrorFillFields'), 'danger');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

        if (!id && downPayment > amount) {
            showToast(getTranslation('formErrorDownPaymentExceeds'), 'danger');
            return;
        }

Â  Â  Â  Â  if (!id) {
Â  Â  Â  Â  Â  Â  const receipts = await getReceipts();
Â  Â  Â  Â  Â  Â  const isDuplicate = receipts.some(r => r.name.trim().toLowerCase() === name.toLowerCase());
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isDuplicate) {
Â  Â  Â  Â  Â  Â  Â  Â  const confirmed = await showConfirm({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: getTranslation('confirmDuplicateNameTitle'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message: getTranslation('confirmDuplicateNameMsg'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  okText: getTranslation('yesBtn'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelText: getTranslation('noBtn'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  okClass: 'btn-success'
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (!confirmed) return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  let finalDueDate, loanPeriod, installments = null;
        const initialPayments = []; 

Â  Â  Â  Â  if (isInstallment) {
Â  Â  Â  Â  Â  Â  const fixedInstallmentAmount = parseFloat(document.getElementById('installmentAmount').value); 
Â  Â  Â  Â  Â  Â  const freq = document.getElementById('installmentFrequency').value;
            // â­ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§: ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ ÛŒÛ•Ú©Û•Ù… Ù‚ÛŒØ³Øª
            const firstInstallmentDateStr = document.getElementById('firstInstallmentDate').value; 

Â  Â  Â  Â  Â  Â  if (isNaN(fixedInstallmentAmount) || fixedInstallmentAmount <= 0 || !firstInstallmentDateStr) { // â­ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getTranslation('formErrorFillFields'), 'danger'); return;
Â  Â  Â  Â  Â  Â  }

            if (fixedInstallmentAmount >= amount) {
                showToast(getTranslation('formErrorInstallmentAmount'), 'danger'); return;
            }

Â  Â  Â  Â  Â  Â  const numInstallments = Math.ceil(amount / fixedInstallmentAmount); 
Â  Â  Â  Â  Â  Â  installments = [];
            // â­ï¸ Ú¯Û†Ú•Ø¯Ø±Ø§: currentDate Ø¦ÛØ³ØªØ§ Ù„Û• Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ ÛŒÛ•Ú©Û•Ù… Ù‚ÛŒØ³ØªÛ•ÙˆÛ• Ø¯Û•Ø³Øª Ù¾ÛØ¯Û•Ú©Ø§Øª
Â  Â  Â  Â  Â  Â  let currentDate = new Date(firstInstallmentDateStr);
            // â­ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§: Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ†Û•ÙˆÛ• Ù„Û• Ú©Ø§ØªÛŒ Ù†Ø§ÙˆØ®Û†ÛŒÛŒ
            currentDate.setMinutes(currentDate.getMinutes() + currentDate.getTimezoneOffset()); 

Â  Â  Â  Â  Â  Â  for (let i = 0; i < numInstallments; i++) {
                
                // â­ï¸ Ú¯Û†Ú•Ø¯Ø±Ø§: Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø§Ù†Ú¯/Ù‡Û•ÙØªÛ• ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ú¯Û•Ø± Ù‚ÛŒØ³ØªÛŒ ÛŒÛ•Ú©Û•Ù… Ù†Û•Ø¨ÙˆÙˆ
                if (i > 0) { 
    Â  Â  Â  Â  Â  Â  Â  Â  if (freq === 'monthly') {
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentDate.setMonth(currentDate.getMonth() + 1);
    Â  Â  Â  Â  Â  Â  Â  Â  } else {
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentDate.setDate(currentDate.getDate() + 7);
    Â  Â  Â  Â  Â  Â  Â  Â  }
                }

                const currentInstallmentAmount = (i === numInstallments - 1) ? (amount - (fixedInstallmentAmount * (i))) : fixedInstallmentAmount;

Â  Â  Â  Â  Â  Â  Â  Â  installments.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amount: currentInstallmentAmount,
                    // â­ï¸ Ú¯Û†Ú•Ø¯Ø±Ø§: Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ù‚ÛŒØ³ØªÛ•Ú©Û• Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª Ø¯Û•Ú©Û•ÛŒÙ†
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dueDate: new Date(currentDate).toISOString().split('T')[0], 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: 'pending',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paidAmount: 0,
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  finalDueDate = installments[installments.length-1].dueDate;
Â  Â  Â  Â  Â  Â  loanPeriod = Math.ceil((new Date(finalDueDate) - new Date(date)) / (1000 * 60 * 60 * 24));

            if (downPayment > 0) {
                initialPayments.push({
                    amount: downPayment,
                    date: date, 
                    note: getTranslation('historyInitialDownPayment')
                });
                
                let amountToDistribute = downPayment;
                for(const inst of installments) {
                    if (amountToDistribute <= 0) break;
                    const needed = inst.amount - (inst.paidAmount || 0);
                    const paymentForThisInstallment = Math.min(amountToDistribute, needed);
                    inst.paidAmount = (inst.paidAmount || 0) + paymentForThisInstallment;
                    if (inst.paidAmount >= inst.amount - 0.01) {
                        inst.status = 'paid';
                    }
                    amountToDistribute -= paymentForThisInstallment;
                }
            }

Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (!dueDate) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getTranslation('formErrorFillFields'), 'danger'); return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  finalDueDate = dueDate;
Â  Â  Â  Â  Â  Â  loanPeriod = Math.ceil((new Date(finalDueDate) - new Date(date)) / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  if (loanPeriod < 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â showToast(getTranslation('formErrorFillFields'), 'danger'); return;
Â  Â  Â  Â  Â  Â  }

            if (downPayment > 0) {
                initialPayments.push({
                    amount: downPayment,
                    date: date,
                    note: getTranslation('historyInitialDownPayment')
                });
            }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  showLoader();
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  if (id) {
Â  Â  Â  Â  Â  Â  Â  Â  const receipts = await getReceipts();
Â  Â  Â  Â  Â  Â  Â  Â  let existingReceipt = receipts.find(r => r.id === id);
Â  Â  Â  Â  Â  Â  Â  Â  existingReceipt = { ...existingReceipt, name, phone, date, category, note, currency };
Â  Â  Â  Â  Â  Â  Â  Â  await updateReceiptDB(existingReceipt);
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getTranslation('receiptUpdatedToast'), 'success');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  const createdAtISO = now.toISOString();Â 

Â  Â  Â  Â  Â  Â  Â  Â  const kurdishDays = ['ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û•', 'Ø¯ÙˆÙˆØ´Û•Ù…Ù…Û•', 'Ø³ÛØ´Û•Ù…Ù…Û•', 'Ú†ÙˆØ§Ø±Ø´Û•Ù…Ù…Û•', 'Ù¾ÛÙ†Ø¬Ø´Û•Ù…Ù…Û•', 'Ù‡Û•ÛŒÙ†ÛŒ', 'Ø´Û•Ù…Ù…Û•'];
Â  Â  Â  Â  Â  Â  Â  Â  const dayIndex = now.getDay();Â 
Â  Â  Â  Â  Â  Â  Â  Â  const createdAtDay = kurdishDays[dayIndex];

Â  Â  Â  Â  Â  Â  Â  Â  let hours = now.getHours();
Â  Â  Â  Â  Â  Â  Â  Â  const minutes = now.getMinutes().toString().padStart(2, '0');
Â  Â  Â  Â  Â  Â  Â  Â  let displayHours = hours % 12;
Â  Â  Â  Â  Â  Â  Â  Â  if (displayHours === 0) displayHours = 12;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const createdAtTime = `${displayHours}:${minutes}`;

Â  Â  Â  Â  Â  Â  Â  Â  const newReceipt = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: String(Date.now()), name, phone, date,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loanPeriod, category, note, initialAmount: amount,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dueDate: finalDueDate, 
                    payments: initialPayments, 
                    loanHistory: [],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currency, isInstallment, 
                    installments, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAtISO,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAtTime,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAtDayÂ  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  await addReceiptDB(newReceipt);
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getTranslation('receiptAddedToast'), 'success');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  resetForm();
Â  Â  Â  Â  Â  Â  await updateDashboardStats();
Â  Â  Â  Â  Â  Â  await updateBadges();
Â  Â  Â  Â  Â  Â  await updateHeaderForecast();Â 
Â  Â  Â  Â  Â  Â  await checkAndUnlockAchievements();
Â  Â  Â  Â  Â  Â  showPage('viewPage', document.querySelector('button[data-page="viewPage"]'));
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  showToast("Error saving receipt.", 'danger');
Â  Â  Â  Â  Â  Â  console.error("Save Error:", error);
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  hideLoader();
Â  Â  Â  Â  }
Â  Â  }


    function resetForm() {
Â  Â  Â  Â  document.getElementById('receiptForm').reset();
Â  Â  Â  Â  document.getElementById('editId').value = '';
Â  Â  Â  Â  document.getElementById('amount').disabled = false;
Â  Â  Â  Â  document.getElementById('formTitle').textContent = getTranslation('formTitleAdd');
Â  Â  Â  Â  document.getElementById('isInstallmentToggle').classList.remove('active');
Â  Â  Â  Â  document.getElementById('installmentFields').classList.add('hidden');
Â  Â  Â  Â  document.getElementById('dueDateContainer').classList.remove('hidden');
Â  Â  Â  Â  document.getElementById('installmentPreview').innerHTML = '';
Â  Â  Â  Â  document.getElementById('amount').readOnly = false;
Â  Â  Â  Â  document.getElementById('isInstallmentToggle').parentElement.parentElement.classList.remove('hidden');
Â  Â  Â  Â  document.getElementById('loanAdvisorBox').classList.add('hidden');

        // â­ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§: Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ†Û•ÙˆÛ• Ù„Û• Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø®Ø§Ù†Û•ÛŒ Ù¾ÛØ´Û•Ú©ÛŒ
        const downPaymentInputDiv = document.getElementById('downPayment').parentElement;
        if (downPaymentInputDiv) {
            downPaymentInputDiv.classList.remove('hidden');
        }
Â  Â  }

    async function loadReceipts() {
        await filterAndSortReceipts();
    }
    
    function getDebtStatus(receipt) {
        if (getRemainingAmount(receipt) <= 0.001) return 'paid';
        
        if (receipt.isInstallment && receipt.installments) {
            const now = new Date();
            now.setHours(0,0,0,0);
            for (const inst of receipt.installments) {
                if (inst.status !== 'paid' && new Date(inst.dueDate) < now) {
                    return 'overdue';
                }
            }
        } else {
            const today = new Date(); 
            today.setHours(0, 0, 0, 0);
            const dueDate = new Date(receipt.dueDate);
            if (dueDate < today) return 'overdue';
        }

        return 'pending';
    }

    function calculateDebtorScore(debtorReceipts) {
        let score = 50; 
        const totalLoans = debtorReceipts.length;
        if (totalLoans === 0) return 'average';

        let overdueCount = 0;
        let onTimePaidCount = 0;
        let completedLoans = 0;

        debtorReceipts.forEach(receipt => {
            const status = getDebtStatus(receipt);
            const totalLoan = getTotalLoan(receipt);
            const totalPaid = getTotalPaid(receipt);
            
            if (status === 'overdue') {
                overdueCount++;
            } else if (status === 'paid') {
                completedLoans++;
                const lastPaymentDate = receipt.payments.length > 0 ? new Date(receipt.payments[receipt.payments.length - 1].date) : new Date();
                if (lastPaymentDate <= new Date(receipt.dueDate)) {
                    onTimePaidCount++;
                } else {
                    overdueCount++;
                }
            }

            if (status !== 'paid' && receipt.payments.length > 0) {
                const avgPayment = totalPaid / receipt.payments.length;
                if (avgPayment < (totalLoan * 0.1)) {
                    score -= 5;
                } else if (avgPayment > (totalLoan * 0.25)) {
                    score += 5;
                }
            }
        });

        score += completedLoans * 5; 
        if (overdueCount > 0) {
            score -= overdueCount * 15;
        }
        if (onTimePaidCount > 0) {
            score += onTimePaidCount * 10;
        }

        score = Math.max(0, Math.min(100, score));

        if (score >= 80) return 'excellent'; 
        if (score >= 60) return 'good';     
        if (score >= 40) return 'average';    
        return 'risky';    
    }

    async function filterAndSortReceipts() {
        showLoader();
        try {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const receipts = await getReceipts();
            const list = document.getElementById("receiptsList");
            list.innerHTML = '';

            if (receipts.length === 0) {
                list.innerHTML = `<div class="empty-state"><i class="fas fa-folder-open"></i><p>${getTranslation('emptyStateNoItems')}</p><button class="btn btn-primary mt-4">${getTranslation('emptyStateAddItem')}</button></div>`;
                list.querySelector('button').addEventListener('click', prepareAddPage);
                return;
            }
            
            const receiptsByDebtor = receipts.reduce((acc, receipt) => {
                const key = receipt.phone || `unique_${receipt.id}`;
                if (!acc[key]) {
                    acc[key] = [];
                }
                acc[key].push(receipt);
                return acc;
            }, {});

            const debtorScores = {};
            for (const key in receiptsByDebtor) {
                const name = receiptsByDebtor[key][0].name;
                debtorScores[name] = calculateDebtorScore(receiptsByDebtor[key]);
            }

            let filteredReceipts = receipts.filter(r => {
                const status = getDebtStatus(r);
                
                if (currentFilter === 'paid') return status === 'paid';
                if (currentFilter === 'unpaid') return status !== 'paid';
                if (currentFilter === 'alerts') {
                    if (status === 'overdue') return true;

                    let isDueSoon = false;
                    if (r.isInstallment && r.installments) {
                        isDueSoon = r.installments.some(inst => {
                            if (inst.status === 'paid') return false;
                            const today = new Date(); today.setHours(0, 0, 0, 0);
                            const dueDate = new Date(inst.dueDate);
                            const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                            return daysDiff >= 0 && daysDiff <= 3;
                        });
                    } else if (status === 'pending') {
                        const today = new Date(); today.setHours(0, 0, 0, 0);
                        const dueDate = new Date(r.dueDate);
                        const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                        isDueSoon = daysDiff <= 3;
                    }
                    return isDueSoon;
                }
                return true; 
            }).filter(r => r.name.toLowerCase().includes(searchTerm) || (r.phone && r.phone.includes(searchTerm)));

            if (filteredReceipts.length === 0) {
                list.innerHTML = `<div class="empty-state"><i class="fas fa-search"></i><p>${getTranslation('emptyStateNoResults')}</p></div>`;
                return;
            }
            
            filteredReceipts.sort((a, b) => {
                const statusA = getDebtStatus(a);
                const statusB = getDebtStatus(b);
                const scoreA = statusA === 'overdue' ? 3 : (statusA === 'pending' ? 2 : 1);
                const scoreB = statusB === 'overdue' ? 3 : (statusB === 'pending' ? 2 : 1);
                if (scoreA !== scoreB) return scoreB - scoreA;
                return parseInt(b.id) - parseInt(a.id);
            });

            filteredReceipts.forEach(receipt => {
                const score = debtorScores[receipt.name];
                list.appendChild(createReceiptCard(receipt, score));
            });
        } finally {
            hideLoader();
        }
    }

    function createReceiptCard(receipt, debtorScore) {
        const remainingAmount = getRemainingAmount(receipt);
        const totalLoan = getTotalLoan(receipt);
        const isPaid = remainingAmount <= 0.001;
        
        let nextDueDate;
        if (receipt.isInstallment && receipt.installments) {
            const firstUnpaid = receipt.installments.find(i => i.status !== 'paid');
            nextDueDate = firstUnpaid ? firstUnpaid.dueDate : receipt.dueDate;
        } else {
            nextDueDate = receipt.dueDate;
        }

        const today = new Date(); today.setHours(0, 0, 0, 0);
        const isOverdue = !isPaid && new Date(nextDueDate) < today;
        let statusText, statusClass;

        if (isPaid) { statusText = getTranslation('cardStatusPaid'); statusClass = 'status-paid'; }
        else if (isOverdue) { statusText = getTranslation('cardStatusOverdue'); statusClass = 'status-overdue'; }
        else { statusText = getTranslation('cardStatusPending'); statusClass = 'status-pending'; }

        const paymentPercentage = totalLoan > 0 ? ((totalLoan - remainingAmount) / totalLoan) * 100 : 0;
        const currencySymbol = (receipt.currency === 'USD') ? '$' : 'Ø¯.Ø¹';
        
        const scoreIcons = {
            excellent: 'â­ï¸',
            good: 'âœ…',
            average: 'âš ï¸',
            risky: 'ğŸš©'
        };
        const scoreIcon = scoreIcons[debtorScore] || '';

        let paymentButton = !isPaid ? `<button data-action="pay" class="action-btn primary flex-1">${getTranslation('cardPayBtn')}</button>` : `<div class="text-secondary font-semibold text-center w-full flex-1 p-2">${getTranslation('cardStatusPaid')} <i class="fas fa-check-circle"></i></div>`;
        const addLoanButton = `<button data-action="add-loan" class="action-btn btn-info flex-1">${getTranslation('cardAddLoanBtn')}</button>`;

        const card = document.createElement('div');
        card.className = 'receipt-card';
        card.innerHTML = `
            <div class="card-top ${statusClass}">
                <h3 class="name" style="white-space: nowrap;">${scoreIcon} ${receipt.name}</h3>
                <span class="status-badge">${statusText}</span>
            </div>
            <div class="card-bottom">
                <div class="amount-main">
                    <span class="label">${getTranslation('cardRemainingAmount')}</span>
                    <div class="amount ${isPaid ? 'is-paid' : 'is-unpaid'}">${formatWithEquivalent(remainingAmount, receipt.currency || 'IQD')}</div>
                </div>
                <div class="progress-container"><div class="progress-bar" style="width: ${paymentPercentage}%;"></div></div>
                <div class="card-details-grid">
                    <div><span class="label">${getTranslation('cardTotalLoan')}</span><span class="value">${totalLoan.toLocaleString()} ${currencySymbol}</span></div>
                    <div><span class="label">${getTranslation('dueDate')}</span><span class="value ${isOverdue ? 'text-danger' : ''}">${formatLocaleDate(nextDueDate)}</span></div>
                </div>
                <div class="card-actions">
                    <div class="action-buttons flex-grow flex gap-2">
                        ${paymentButton}
                        ${addLoanButton}
                    </div>
                    <button data-action="details" class="icon-btn"><i class="fas fa-ellipsis-h"></i></button>
                </div>
            </div>`;
        
        card.querySelector('[data-action="details"]').addEventListener('click', (e) => { e.stopPropagation(); showReceiptDetails(receipt.id); });
        card.querySelector('[data-action="add-loan"]').addEventListener('click', (e) => { e.stopPropagation(); showAddLoanModal(receipt.id); });
        if (!isPaid) {
            card.querySelector('[data-action="pay"]').addEventListener('click', (e) => { e.stopPropagation(); showPaymentModal(receipt.id); });
        }
        card.addEventListener('click', (e) => { if (!e.target.closest('button, a')) { showReceiptDetails(receipt.id); } });
        return card;
    }
    
    function generateContactMessage(receipt) {
        const t = getTranslation;
        const currencySymbol = (receipt.currency === 'USD') ? '$' : 'Ø¯.Ø¹';
        const businessName = localStorage.getItem('businessName') || '';

        if (getDebtStatus(receipt) === 'paid') {
            return t('msgPaidFully', { name: receipt.name });
        }
        
        const totalLoan = getTotalLoan(receipt);
        const remainingAmount = getRemainingAmount(receipt);
        const totalPaid = totalLoan - remainingAmount;
        
        const allEvents = [
            { type: 'loan', date: receipt.date, amount: receipt.initialAmount, note: t('msgHistoryInitialLoan') },
            ...(receipt.loanHistory || []).map(l => ({ ...l, type: 'loan' })),
            ...(receipt.payments || []).map(p => ({ ...p, type: 'payment' }))
        ].sort((a, b) => new Date(a.date) - new Date(b.date));

        let historyText = '';
        if (allEvents.length > 1) {
            historyText += `\n\n*${t('msgHistoryTitle')}*\n`;
            historyText += '--------------------\n';
            allEvents.forEach(event => {
                const eventTitle = event.type === 'payment' ? t('msgHistoryPayment') : (event.note === t('msgHistoryInitialLoan') ? t('msgHistoryInitialLoan') : t('msgHistoryAddedLoan'));
                const sign = event.type === 'payment' ? '-' : '+';
                historyText += `*${eventTitle}* (${formatLocaleDate(event.date)})\n`;
                historyText += `${sign}${event.amount.toLocaleString(undefined, { maximumFractionDigits: 2 })} ${currencySymbol}\n`;
                if (event.note && event.note !== t('msgHistoryInitialLoan')) {
                    historyText += `  *${t('formNote')}:* ${event.note}\n`;
                }
                historyText += '\n';
            });
        }
        
        const thankYouMessage = businessName 
            ? t('msgThanksWithBusiness', { businessName: businessName })
            : t('msgThanks');

        const lines = [
            `*${t('msgGreeting', { name: receipt.name })}*`,
            '',
            `*${t('msgBodyTitle')}*`,
            '--------------------',
            `*${t('msgTotalLoan')}* ${totalLoan.toLocaleString(undefined, { maximumFractionDigits: 2 })} ${currencySymbol}`,
            `*${t('msgPaid')}* ${totalPaid.toLocaleString(undefined, { maximumFractionDigits: 2 })} ${currencySymbol}`,
            `*${t('msgRemaining')}* ${remainingAmount.toLocaleString(undefined, { maximumFractionDigits: 2 })} ${currencySymbol}`,
            '',
            `*${t('msgType')}* ${receipt.category}`,
            `*${t('msgStartDate')}* ${formatLocaleDate(receipt.date)}`,
            `*${t('msgDueDate')}* ${formatLocaleDate(receipt.dueDate)}`,
            `*${t('msgPhone')}* ${receipt.phone || t('notRegistered')}`,
            `*${t('msgNote')}* ${receipt.note || t('none')}`,
            historyText,
            '--------------------',
            thankYouMessage
        ];

        return lines.join('\n').trim();
    }
    
    async function showReceiptDetails(id) {
        const receipts = await getReceipts();
        const receipt = receipts.find(r => r.id === id);
        if (!receipt) return;
        const modalContentEl = document.getElementById('receiptDetailsModal').querySelector('.modal-content');
    if (modalContentEl) {
        modalContentEl.scrollTop = 0;
    }
        
        document.getElementById('modalTitle').textContent = receipt.name;
        const modalContent = document.getElementById('modalContent');
        const modalContact = document.getElementById('modalContactActions');
        modalContact.innerHTML = '';
        const remainingAmount = getRemainingAmount(receipt);
        const totalLoan = getTotalLoan(receipt);
        const totalPaid = getTotalPaid(receipt);
        const isPaid = remainingAmount <= 0.001;
        const currencySymbol = (receipt.currency === 'USD') ? '$' : 'Ø¯.Ø¹';
        
        const today = new Date(); today.setHours(0,0,0,0);
        let nextDueDate = receipt.dueDate;
        if (receipt.isInstallment && receipt.installments) {
            const firstUnpaid = receipt.installments.find(i => i.status !== 'paid');
            if(firstUnpaid) nextDueDate = firstUnpaid.dueDate;
        }
        const isOverdue = !isPaid && new Date(nextDueDate) < today;

        const statusText = isPaid ? getTranslation('cardStatusPaid') : (isOverdue ? getTranslation('cardStatusOverdue') : getTranslation('cardStatusPending'));
        const statusColor = isPaid ? 'bg-secondary' : (isOverdue ? 'bg-danger' : 'bg-accent');

        modalContent.innerHTML = `
            <div class="grid grid-cols-2 gap-4 text-center">
    <div class="bg-yellow-50 p-3 rounded-lg">
        <div class="font-bold text-lg leading-tight">${formatWithEquivalent(totalLoan, receipt.currency || 'IQD', true)}</div>
        <small class="block mt-1">${getTranslation('detailsModalTotalLoan')}</small>
    </div>
    <div class="bg-green-50 p-3 rounded-lg">
        <div class="font-bold text-lg leading-tight">${formatWithEquivalent(totalPaid, receipt.currency || 'IQD', true)}</div>
        <small class="block mt-1">${getTranslation('detailsModalTotalPaid')}</small>
    </div>
</div>
<div class="bg-red-50 p-4 rounded-lg mt-4 text-center">
    <div class="font-bold text-2xl text-danger">${formatWithEquivalent(remainingAmount, receipt.currency || 'IQD')}</div>
    <small>${getTranslation('detailsModalRemaining')}</small>
</div>
            <div class="text-sm space-y-3 border-t pt-4 mt-4">
                <p class="flex justify-between items-center"><strong>${getTranslation('detailsModalType')}</strong><span>${receipt.category}</span></p>
                <p class="flex justify-between items-center"><strong>${getTranslation('detailsModalStartDate')}</strong><span class="text-right">${formatLocaleDate(receipt.date)}${receipt.createdAtDay ? `<br><small class='text-gray-500'>(${receipt.createdAtDay}, ${receipt.createdAtTime || ''})</small>` : ''}</span></p>
                <p class="flex justify-between items-center"><strong>${getTranslation('detailsModalDueDate')}</strong><span>${formatLocaleDate(receipt.dueDate)}</span></p>
                <p class="flex justify-between items-center"><strong>${getTranslation('detailsModalPhone')}</strong><span>${receipt.phone ? `<a href="tel:${receipt.phone}" class="text-blue-600 hover:underline">${receipt.phone}</a>` : getTranslation('notRegistered')}</span></p>
                <p class="flex justify-between items-start gap-4"><strong>${getTranslation('detailsModalNote')}</strong><span class="text-left">${receipt.note || getTranslation('none')}</span></p>
                <p class="flex justify-between items-center"><strong>${getTranslation('detailsModalStatus')}</strong><span class="font-bold text-white py-1 px-2 text-xs rounded-full ${statusColor}">${statusText}</span></p>
            </div>`;
        
        const debtorAnalysisContainer = document.getElementById('debtorAiAnalysis');
        await generateDebtorAnalysis(receipt.id, debtorAnalysisContainer);
        
        if (receipt.isInstallment && receipt.installments) {
            const installmentContainer = document.createElement('div');
            installmentContainer.className = "border-t pt-4 mt-4";
            installmentContainer.innerHTML = `<h3 class="font-bold mb-3">${getTranslation('installmentPlan')}</h3>`;
            const plan = document.createElement('div');
            plan.className = "space-y-2";
            const now = new Date(); now.setHours(0,0,0,0);
            
            receipt.installments.forEach((inst, index) => {
            const totalInstallmentAmount = inst.amount;
Â  Â  Â  Â  Â  Â  Â  Â  const paidInstallmentAmount = inst.paidAmount || 0;
Â  Â  Â  Â  Â  Â  Â  Â  const remainingInstallmentAmount = totalInstallmentAmount - paidInstallmentAmount;
            const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  let statusClass, iconClass;
Â  Â  Â  Â  Â  Â  Â  Â  const isInstallmentPaid = inst.status === 'paid';
Â  Â  Â  Â  Â  Â  Â  Â  const isInstallmentOverdue = !isInstallmentPaid && new Date(inst.dueDate) < now;
                if(isInstallmentPaid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusClass = 'status-paid';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconClass = 'fa-check';
Â  Â  Â  Â  Â  Â  Â  Â  } else if (isInstallmentOverdue) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusClass = 'status-overdue';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconClass = 'fa-exclamation';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusClass = 'status-pending';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconClass = 'fa-clock';
Â  Â  Â  Â  Â  Â  Â  Â  }

                item.className = `installment-item ${statusClass}`;
                item.innerHTML = `
                    <div class="installment-icon"><i class="fas ${iconClass}"></i></div>
                    <div class="flex-grow">
                        <div class="flex justify-between items-center">
                            <span class="font-bold">${getTranslation('installment')} ${index + 1}</span>
                            <span class="font-bold text-sm">${inst.amount.toLocaleString(undefined, { maximumFractionDigits: 2 })} ${currencySymbol}</span>
                        </div>
                        <div class="text-xs text-gray-500">${formatLocaleDate(inst.dueDate)}</div>
                    </div>
                `;
                // â­ï¸ --- Ø¨Û•Ø´ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§Ùˆ --- â­ï¸
Â  Â  Â  Â  Â  Â  Â  Â  if (!isInstallmentPaid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.style.cursor = 'pointer';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.title = (currentLang === 'ku' ? 'Ú©Ø±ØªÛ• Ø¨Ú©Û• Ø¨Û† Ù¾Ø§Ø±Û•Ø¯Ø§Ù†ÛŒ Ø¦Û•Ù… Ù‚ÛŒØ³ØªÛ•' : 'Ø§Ø¶ØºØ· Ù„Ø¯ÙØ¹ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ø·');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeModal('receiptDetailsModal'); // Ù…Û†Ø¯Ø§ÚµÛŒ ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û• Ø¯Ø§Ø¨Ø®Û•
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showPaymentModal(receipt.id, index); // Ù…Û†Ø¯Ø§ÚµÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ø¨Ú©Û•Ø±Û•ÙˆÛ• Ø¨Û† Ø¦Û•Ù… Ù‚ÛŒØ³ØªÛ• Ø¯ÛŒØ§Ø±ÛŒÚ©Ø±Ø§ÙˆÛ•
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // â­ï¸ --- Ú©Û†ØªØ§ÛŒÛŒ Ø¨Û•Ø´ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§Ùˆ --- â­ï¸
                plan.appendChild(item);
            });
            installmentContainer.appendChild(plan);
            modalContent.appendChild(installmentContainer);
        }

        if (receipt.phone) {
            const message = encodeURIComponent(generateContactMessage(receipt));
            modalContact.innerHTML = `
                <div class="border-t pt-4 mt-4">
                    <h3 class="font-bold mb-3 text-center">${getTranslation('detailsModalContact')}</h3>
                    <div class="flex gap-2 justify-center">
                        <a href="https://wa.me/964${receipt.phone.substring(1)}?text=${message}" target="_blank" class="btn flex-1 bg-[#25D366] hover:bg-[#1DA851] text-white"><i class="fab fa-whatsapp"></i><span>${getTranslation('detailsModalWhatsapp')}</span></a>
                        <a href="https://t.me/share/url?url= &text=${message}" target="_blank" class="btn flex-1 bg-[#0088CC] hover:bg-[#007AB8] text-white"><i class="fab fa-telegram"></i><span>${getTranslation('detailsModalTelegram')}</span></a>
                    </div>
                </div>`;
        }

        const allEvents = [
            { type: 'loan', date: receipt.date, amount: receipt.initialAmount, note: getTranslation('historyInitialLoan') },
            ...(receipt.loanHistory || []).map(l => ({ ...l, type: 'loan' })),
            ...(receipt.payments || []).map(p => ({ ...p, type: 'payment' }))
        ].sort((a, b) => new Date(a.date) - new Date(b.date));

        if (allEvents.length > 1) {
            const historyContainer = document.createElement('div');
            historyContainer.className = "border-t pt-4 mt-4";
            historyContainer.innerHTML = `<h3 class="font-bold mb-3">${getTranslation('detailsModalHistory')}</h3>`;
            const timeline = document.createElement('div');
            timeline.className = "history-timeline space-y-4";
            allEvents.forEach(event => {
                const item = document.createElement('div');
                item.className = `history-item ${event.type}`;
                const eventTitle = event.type === 'payment' ? getTranslation('historyPayment') : (event.note === getTranslation('historyInitialLoan') ? getTranslation('historyInitialLoan') : (event.note || getTranslation('historyAddedLoan')));
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="font-semibold ${event.type === 'payment' ? 'text-secondary' : 'text-accent'}"><i class="fas ${event.type === 'payment' ? 'fa-arrow-down' : 'fa-arrow-up'} ml-2"></i>${eventTitle}</span>
                        <span class="text-sm text-gray-500">${formatLocaleDate(event.date)}</span>
                    </div>
                    <p class="pr-6 font-bold text-lg">${event.amount.toLocaleString(undefined, { maximumFractionDigits: 2 })} ${currencySymbol}</p>
                    ${event.note && event.note !== getTranslation('historyInitialLoan') ? `<p class="pr-6 text-sm text-gray-600">${event.note}</p>` : ''}
                `;
                timeline.appendChild(item);
            });
            historyContainer.appendChild(timeline);
            modalContent.appendChild(historyContainer);
        }
        
        const actionsContainer = document.getElementById('modalActionsContainer');
        actionsContainer.innerHTML = `
            <button type="button" class="btn btn-gray w-full" data-modal-close="receiptDetailsModal">
                <i class="fas fa-times"></i><span data-translate-key="closeBtn">${getTranslation('closeBtn')}</span>
            </button>
        `;

        let actionButtonsHtml = `
            <div class="flex items-center gap-2 mt-2">
                <button type="button" id="editReceiptBtn" class="btn btn-primary flex-1">
                    <i class="fas fa-edit"></i><span data-translate-key="editBtn">${getTranslation('editBtn')}</span>
                </button>
                <button type="button" id="deleteReceiptBtn" class="btn btn-danger flex-1">
                    <i class="fas fa-trash-alt"></i><span data-translate-key="deleteBtn">${getTranslation('deleteBtn')}</span>
                </button>
            </div>
        `;
        
        actionsContainer.insertAdjacentHTML('afterbegin', actionButtonsHtml);

        document.getElementById('editReceiptBtn').onclick = () => editReceipt(id);
        document.getElementById('deleteReceiptBtn').onclick = () => { closeModal('receiptDetailsModal'); deleteReceipt(id); };

        showModal('receiptDetailsModal');
    }

    async function editReceipt(id) {
Â  Â  Â  Â  closeModal('receiptDetailsModal');
Â  Â  Â  Â  await showPage('addPage');
Â  Â  Â  Â  const receipts = await getReceipts();
Â  Â  Â  Â  const receipt = receipts.find(r => r.id === id);
Â  Â  Â  Â  if (receipt) {
Â  Â  Â  Â  Â  Â  document.getElementById('editId').value = receipt.id;
Â  Â  Â  Â  Â  Â  document.getElementById('name').value = receipt.name;
Â  Â  Â  Â  Â  Â  document.getElementById('phone').value = receipt.phone;
Â  Â  Â  Â  Â  Â  document.getElementById('amount').value = receipt.initialAmount;
Â  Â  Â  Â  Â  Â  document.getElementById('amount').readOnly = true;
Â  Â  Â  Â  Â  Â  document.getElementById('date').value = receipt.date;
Â  Â  Â  Â  Â  Â  document.getElementById('date').readOnly = true;
Â  Â  Â  Â  Â  Â  document.getElementById('dueDateInput').value = receipt.dueDate;
Â  Â  Â  Â  Â  Â  document.getElementById('category').value = receipt.category;
Â  Â  Â  Â  Â  Â  document.getElementById('note').value = receipt.note;
Â  Â  Â  Â  Â  Â  document.getElementById('formTitle').textContent = getTranslation('formTitleEdit');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const currency = receipt.currency || 'IQD';
Â  Â  Â  Â  Â  Â  document.getElementById('currency').value = currency;
Â  Â  Â  Â  Â  Â  document.querySelectorAll('#receiptForm .lang-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.currency === currency));
Â  Â  Â  Â  Â  Â  updateAmountLabel(currency);

            // â­ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§: Ø´Ø§Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø®Ø§Ù†Û•ÛŒ Ù¾ÛØ´Û•Ú©ÛŒ Ù„Û• Ú©Ø§ØªÛŒ Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ
            const downPaymentInputDiv = document.getElementById('downPayment').parentElement;
            if (downPaymentInputDiv) {
                downPaymentInputDiv.classList.add('hidden');
            }

Â  Â  Â  Â  Â  Â  document.getElementById('isInstallmentToggle').parentElement.parentElement.classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('dueDateContainer').classList.add('hidden');
Â  Â  Â  Â  }
Â  Â  }

    async function deleteReceipt(id) {
        const confirmed = await showConfirm({
            title: getTranslation('confirmDeleteTitle'),
            message: getTranslation('confirmDeleteMsg'),
            okText: getTranslation('yesBtn'),
            cancelText: getTranslation('noBtn')
        });
        if (!confirmed) return;
        
        await deleteReceiptDB(id);
        await loadReceipts();
        await updateDashboardStats();
        await updateBadges();
        await updateHeaderForecast();
        showToast(getTranslation('receiptDeletedToast'), 'success');
    }
    
    async function updateDashboardStats() {
        const receipts = await getReceipts();
        let stats = {
            IQD: { initial: 0, paid: 0 },
            USD: { initial: 0, paid: 0 }
        };
        const uniqueDebtors = new Set(receipts.map(r => r.phone || `unique_${r.id}`));

        receipts.forEach(r => {
            const currency = r.currency || 'IQD';
            const totalLoanAmount = getTotalLoan(r);
            const totalPaidAmount = getTotalPaid(r);
            if (typeof totalLoanAmount === 'number') {
                 stats[currency].initial += totalLoanAmount;
            }
             if (typeof totalPaidAmount === 'number') {
                 stats[currency].paid += totalPaidAmount;
            }
        });

        const remainingIQD = stats.IQD.initial - stats.IQD.paid;
        const remainingUSD = stats.USD.initial - stats.USD.paid;

        const locale = currentLang === 'ar' ? 'ar-EG' : 'en-US'; 

        document.getElementById('statsCount').textContent = uniqueDebtors.size.toLocaleString(locale);

        document.getElementById('statsTotalInitialIQD').textContent = stats.IQD.initial.toLocaleString(locale, { maximumFractionDigits: 0 }); 
        document.getElementById('statsTotalPaidIQD').textContent = stats.IQD.paid.toLocaleString(locale, { maximumFractionDigits: 0 }); 
        document.getElementById('statsAmountIQD').innerHTML = formatWithEquivalent(remainingIQD, 'IQD'); 

        document.getElementById('statsTotalInitialUSD').textContent = stats.USD.initial.toLocaleString(locale, { maximumFractionDigits: 2 }); 
        document.getElementById('statsTotalPaidUSD').textContent = stats.USD.paid.toLocaleString(locale, { maximumFractionDigits: 2 }); 
        document.getElementById('statsAmountUSD').innerHTML = formatWithEquivalent(remainingUSD, 'USD'); 

        return { stats, receipts, uniqueDebtors };
    }

    async function showPaymentModal(id, installmentIndex = null) {
Â  Â  Â  Â  const receipts = await getReceipts();
Â  Â  Â  Â  const receipt = receipts.find(r => r.id === id);
Â  Â  Â  Â  if (!receipt) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const originalCurrency = receipt.currency || 'IQD';
Â  Â  Â  Â  const alternateCurrency = originalCurrency === 'USD' ? 'IQD' : 'USD';

Â  Â  Â  Â  document.getElementById('paymentReceiptId').value = id;
Â  Â  Â  Â  document.getElementById('originalDebtCurrency').value = originalCurrency;
Â  Â  Â  Â  
Â  Â  Â  Â  // â­ï¸ --- Ú¯Û†Ú•Ø§Ù†Ú©Ø§Ø±ÛŒ Ú¯Ø±Ù†Ú¯ Ù„ÛØ±Û•Ø¯Ø§ÛŒÛ• --- â­ï¸
Â  Â  Â  Â  // document.getElementById('paymentForm').reset(); // ğŸ‘ˆ Ø¦Û•Ù…Û• Ø³Ú•Ø§ÛŒÛ•ÙˆÛ• Ú†ÙˆÙ†Ú©Û• Ú©ÛØ´Û•ÛŒ Ø¯Ø±ÙˆØ³Øª Ø¯Û•Ú©Ø±Ø¯
Â  Â  Â  Â  // Ù„Û• Ø¬ÛŒØ§ØªÛŒ Ø¦Û•ÙˆÛ•ØŒ Ø®Ø§Ù†Û•Ú©Ø§Ù† Ø¨Û• Ø¯Û•Ø³Øª Ù¾Ø§Ú© Ø¯Û•Ú©Û•ÛŒÙ†Û•ÙˆÛ•
Â  Â  Â  Â  document.getElementById('paidAmountInput').value = '';
Â  Â  Â  Â  document.getElementById('paymentNoteInput').value = '';
Â  Â  Â  Â  document.getElementById('paymentInstallmentIndex').value = ''; // ğŸ‘ˆ Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø³Û•Ø±Û•ØªØ§ÛŒÛŒ
Â  Â  Â  Â  document.getElementById('conversionInfo').classList.add('hidden');
Â  Â  Â  Â  // â­ï¸ --- Ú©Û†ØªØ§ÛŒÛŒ Ú¯Û†Ú•Ø§Ù†Ú©Ø§Ø±ÛŒ --- â­ï¸
Â  Â  Â  Â Â 
Â  Â  Â  Â  const amountLabel = document.querySelector('#paymentModal label[for="paidAmountInput"]');
Â  Â  Â  Â  const currencyToggle = document.getElementById('paymentCurrencyToggle');
Â  Â  Â  Â  const paymentTitleEl = document.getElementById('paymentTitle'); 

Â  Â  Â  Â  currencyToggle.innerHTML = `
Â  Â  Â  Â  Â  Â  <button type="button" data-currency="${originalCurrency}" class="lang-btn flex-1 py-2 rounded-md">${originalCurrency}</button>
Â  Â  Â  Â  Â  Â  <button type="button" data-currency="${alternateCurrency}" class="lang-btn flex-1 py-2 rounded-md">${alternateCurrency}</button>
Â  Â  Â  Â  `;

Â  Â  Â  Â  function updateUIForCurrency(selectedCurrency) {
Â  Â  Â  Â  Â  Â  const labelKey = selectedCurrency === 'USD' ? 'formPaidAmountUSD' : 'formPaidAmountIQD';
Â  Â  Â  Â  Â  Â  amountLabel.setAttribute('data-translate-key', labelKey);
Â  Â  Â  Â  Â  Â  amountLabel.textContent = getTranslation(labelKey);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  currencyToggle.querySelectorAll('button').forEach(btn => {
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.toggle('active', btn.dataset.currency === selectedCurrency);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  updateConversionInfo();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  updateUIForCurrency(originalCurrency);

Â  Â  Â  Â  currencyToggle.querySelectorAll('button').forEach(btn => {
Â  Â  Â  Â  Â  Â  btn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  updateUIForCurrency(btn.dataset.currency);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  const amountInput = document.getElementById('paidAmountInput');
Â  Â  Â  Â  if (installmentIndex !== null) {
Â  Â  Â  Â  Â  Â  document.getElementById('paymentInstallmentIndex').value = installmentIndex;
Â  Â  Â  Â  Â  Â  const inst = receipt.installments[installmentIndex];
Â  Â  Â  Â  Â  Â  if (inst) {
Â  Â  Â  Â  Â  Â  Â  Â  const needed = inst.amount - (inst.paidAmount || 0);
Â  Â  Â  Â  Â  Â  Â  Â  amountInput.value = needed.toFixed(receipt.currency === 'USD' ? 2 : 0);

Â  Â  Â  Â  Â  Â  Â  Â  // Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ù…Û†Ø¯Ø§ÚµÛ•Ú©Û• Ù†ÙˆÛ Ø¨Ú©Û•Ø±Û•ÙˆÛ•
Â  Â  Â  Â  Â  Â  Â  Â  const originalTitle = getTranslation('paymentModalTitle');
Â  Â  Â  Â  Â  Â  Â  Â  paymentTitleEl.textContent = `${originalTitle} - ${getTranslation('installment')} ${parseInt(installmentIndex) + 1}`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Ø¦Û•Ú¯Û•Ø± Ù„Û• Ø¯Û•Ø±Û•ÙˆÛ• Ú©Ø±ØªÛ•ÛŒ Ù„ÛÚ©Ø±Ø§Ø¨ÙˆÙˆØŒ Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù¾Ø§Ø±Û•ÛŒ Ù…Ø§ÙˆÛ• Ø¨Ù‡ÛÙ†Û•
Â  Â  Â  Â  Â  Â  const remaining = getRemainingAmount(receipt);
Â  Â  Â  Â  Â  Â  amountInput.value = remaining.toFixed(receipt.currency === 'USD' ? 2 : 0);
Â  Â  Â  Â  Â  Â  paymentTitleEl.textContent = getTranslation('paymentModalTitle'); // Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø¦Ø§Ø³Ø§ÛŒÛŒ
Â  Â  Â  Â  }
Â  Â  Â  Â  updateConversionInfo();
Â  Â  Â  Â Â 
Â  Â  Â  Â  showModal('paymentModal');
Â  Â  }

    async function processPayment() {
        const id = document.getElementById('paymentReceiptId').value;
        const paidAmount = parseFloat(document.getElementById('paidAmountInput').value);
        const userInputNote = document.getElementById('paymentNoteInput').value.trim();
        const originalCurrency = document.getElementById('originalDebtCurrency').value;
        const paymentCurrency = document.querySelector('#paymentCurrencyToggle button.active').dataset.currency;
        const installmentIndex = document.getElementById('paymentInstallmentIndex').value; // â­ï¸ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ú˜Ù…Ø§Ø±Û•ÛŒ Ù‚ÛŒØ³Øª
        
        if (isNaN(paidAmount) || paidAmount <= 0) {
            showToast(getTranslation('formInvalidAmount'), 'danger');
            return;
        }

        const receipts = await getReceipts();
        const receipt = receipts.find(r => r.id === id);
        if (!receipt) return;
        
        let finalPaidAmount = paidAmount;
        let finalNote = userInputNote;

        if (paymentCurrency !== originalCurrency) {
            const exchangeRate = globalExchangeRate;
            let autoNote = '';
            
            if (originalCurrency === 'USD' && paymentCurrency === 'IQD') {
                finalPaidAmount = paidAmount / exchangeRate;
                autoNote = getTranslation('paymentNoteAuto', { amount: paidAmount.toLocaleString(), currency: 'Ø¯ÛŒÙ†Ø§Ø±', rate: exchangeRate });
            } else if (originalCurrency === 'IQD' && paymentCurrency === 'USD') {
                finalPaidAmount = paidAmount * exchangeRate;
                autoNote = getTranslation('paymentNoteAuto', { amount: paidAmount.toLocaleString(), currency: 'Ø¯Û†Ù„Ø§Ø±', rate: exchangeRate });
            }
            finalNote = userInputNote ? `${userInputNote} (${autoNote})` : autoNote;
        }

        if (!receipt.payments) receipt.payments = [];

Â  Â  Â  Â  // â­ï¸ --- Ù„Û†Ø¬ÛŒÚ©ÛŒ Ù†ÙˆÛÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù† --- â­ï¸
Â  Â  Â  Â  if (installmentIndex !== '' && installmentIndex !== null) {
Â  Â  Â  Â  Â  Â  // Ø­Ø§ÚµÛ•ØªÛŒ ÛŒÛ•Ú©Û•Ù…: Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ø¦Ø§Ú•Ø§Ø³ØªÛ•Ú©Ø±Ø§ÙˆÛ• Ø¨Û† Ù‚ÛŒØ³ØªÛÚ©ÛŒ Ø¯ÛŒØ§Ø±ÛŒÚ©Ø±Ø§Ùˆ
Â  Â  Â  Â  Â  Â  const index = parseInt(installmentIndex);
Â  Â  Â  Â  Â  Â  const inst = receipt.installments[index];

Â  Â  Â  Â  Â  Â  if (!inst || inst.status === 'paid') {
Â  Â  Â  Â  Â  Â  Â  Â  Â showToast('Error: This installment is already paid or invalid.', 'danger'); // Ø¦Û•Ù…Û• Ø¯Û•ØªÙˆØ§Ù†ÛŒØª ÙˆÛ•Ø±ÛŒØ¨Ú¯ÛÚ•ÛŒØª
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const needed = inst.amount - (inst.paidAmount || 0);
Â  Â  Â  Â  Â  Â  if (finalPaidAmount > needed + 0.01) {
Â  Â  Â  Â  Â  Â  Â  Â  // Ù¾Ø§Ø±Û•Ø¯Ø§Ù†Û•Ú©Û• Ø²ÛŒØ§ØªØ±Û• Ù„Û• Ø¨Ú•ÛŒ Ù…Ø§ÙˆÛ•ÛŒ Ø¦Û•Ù… Ù‚ÛŒØ³ØªÛ•
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getTranslation('paymentExceedsError', {amount: needed.toLocaleString()}), 'danger');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Ù¾Ø§Ø±Û•Ø¯Ø§Ù†Û•Ú©Û• Ø²ÛŒØ§Ø¯Ø¨Ú©Û• Ø¨Û† Ù„ÛŒØ³ØªÛŒ Ú¯Ø´ØªÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù†Û•Ú©Ø§Ù†
Â  Â  Â  Â  Â  Â  const noteForPayment = finalNote || (currentLang === 'ku' ? `Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ø¨Û† Ù‚ÛŒØ³ØªÛŒ ${index + 1}` : `Ø¯ÙØ¹Ø© Ù„Ù„Ù‚Ø³Ø· ${index + 1}`);
Â  Â  Â  Â  Â  Â  receipt.payments.push({ amount: finalPaidAmount, date: new Date().toISOString().split('T')[0], note: noteForPayment });

Â  Â  Â  Â  Â  Â  // Ù‚ÛŒØ³ØªÛ• Ø¯ÛŒØ§Ø±ÛŒÚ©Ø±Ø§ÙˆÛ•Ú©Û• Ù†ÙˆÛ Ø¨Ú©Û•Ø±Û•ÙˆÛ•
Â  Â  Â  Â  Â  Â  inst.paidAmount = (inst.paidAmount || 0) + finalPaidAmount;
Â  Â  Â  Â  Â  Â  if (inst.paidAmount >= inst.amount - 0.01) {
Â  Â  Â  Â  Â  Â  Â  Â  inst.status = 'paid';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Ø­Ø§ÚµÛ•ØªÛŒ Ø¯ÙˆÙˆÛ•Ù…: Ù¾Ø§Ø±Û•Ø¯Ø§Ù†ÛŒ Ú¯Ø´ØªÛŒ (Ù„Û†Ø¬ÛŒÚ©ÛŒ Ù¾ÛØ´ÙˆÙˆÛŒ ØªØ§Ú¤Ú¯Û•)
Â  Â  Â  Â  Â  Â  const remainingAmount = getRemainingAmount(receipt);
Â  Â  Â  Â  Â  Â  if (finalPaidAmount > remainingAmount + 0.01) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getTranslation('paymentExceedsError', {amount: remainingAmount.toLocaleString()}), 'danger');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  receipt.payments.push({ amount: finalPaidAmount, date: new Date().toISOString().split('T')[0], note: finalNote });

Â  Â  Â  Â  Â  Â  if(receipt.isInstallment && receipt.installments) {
Â  Â  Â  Â  Â  Â  Â  Â  let amountToDistribute = finalPaidAmount;
Â  Â  Â  Â  Â  Â  Â  Â  for(const inst of receipt.installments) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (amountToDistribute <= 0) break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(inst.status === 'paid') continue;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const needed = inst.amount - (inst.paidAmount || 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const paymentForThisInstallment = Math.min(amountToDistribute, needed);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inst.paidAmount = (inst.paidAmount || 0) + paymentForThisInstallment;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (inst.paidAmount >= inst.amount - 0.01) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inst.status = 'paid';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amountToDistribute -= paymentForThisInstallment;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  // â­ï¸ --- Ú©Û†ØªØ§ÛŒÛŒ Ù„Û†Ø¬ÛŒÚ©ÛŒ Ù†ÙˆÛÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù† --- â­ï¸

        await updateReceiptDB(receipt);
        await updateDashboardStats();
        await updateBadges();
        await updateHeaderForecast();  
        await checkAndUnlockAchievements();
        await loadReceipts();
        closeModal('paymentModal');
        showToast(getTranslation('paymentRecordedToast'), 'success');
    }

    async function showAddLoanModal(id) {
        const receipts = await getReceipts();
        const receipt = receipts.find(r => r.id === id);
        if (!receipt) return;
        const currency = receipt.currency || 'IQD';
        const labelKey = currency === 'USD' ? 'formNewLoanAmountUSD' : 'formNewLoanAmountIQD';
        document.getElementById('addLoanReceiptId').value = id;
        document.getElementById('addLoanForm').reset();
        const label = document.querySelector('#addLoanModal label[for="newLoanAmountInput"]');
        label.setAttribute('data-translate-key', labelKey);
        label.textContent = getTranslation(labelKey);
        showModal('addLoanModal');
    }

    async function processNewLoan() {
        const id = document.getElementById('addLoanReceiptId').value;
        const newLoanAmount = parseFloat(document.getElementById('newLoanAmountInput').value);
        const note = document.getElementById('newLoanNoteInput').value.trim();
        if (isNaN(newLoanAmount) || newLoanAmount <= 0) {
            showToast(getTranslation('formInvalidAmount'), 'danger');
            return;
        }
        
        const receipts = await getReceipts();
        const receipt = receipts.find(r => r.id === id);
        if (receipt) {
            if (!receipt.loanHistory) receipt.loanHistory = [];
            const finalNote = note || getTranslation('historyAddedLoan');
            receipt.loanHistory.push({ amount: newLoanAmount, date: new Date().toISOString().split('T')[0], note: finalNote });
            
            if (receipt.isInstallment && receipt.installments) {
                const unpaidInstallments = receipt.installments.filter(i => i.status !== 'paid');
                if (unpaidInstallments.length > 0) {
                    const amountPerInstallment = Math.ceil(newLoanAmount / unpaidInstallments.length);
                    unpaidInstallments.forEach((inst, index) => {
                        if (index === unpaidInstallments.length - 1) {
                            inst.amount += newLoanAmount - (amountPerInstallment * (unpaidInstallments.length -1));
                        } else {
                            inst.amount += amountPerInstallment;
                        }
                    });
                }
            }

            await updateReceiptDB(receipt);
            await updateDashboardStats();
            await updateBadges();
            await updateHeaderForecast(); 
            await checkAndUnlockAchievements();
            if (!document.getElementById('viewPage').classList.contains('hidden')) await loadReceipts();
            closeModal('addLoanModal');
            showToast(getTranslation('newLoanAddedToast'), 'success');
        }
    }

    async function generateAnalytics() {
        const container = document.getElementById('analyticsContainer');
        container.innerHTML = ''; 
        const charts = {};

        const receipts = await getReceipts();
        if (receipts.length === 0) {
            container.innerHTML = `<div class="empty-state"><i class="fas fa-chart-bar"></i><p>${getTranslation('analyticsEmpty')}</p></div>`;
            return;
        }

        container.innerHTML = `
            <div class="analytics-tabs">
                <button data-tab="general" class="analytics-tab-btn active">${getTranslation('analyticsTabGeneral')}</button>
                <button data-tab="deeper" class="analytics-tab-btn">${getTranslation('analyticsTabDeeper')}</button>
                <button data-tab="profiles" class="analytics-tab-btn">${getTranslation('analyticsTabProfiles')}</button>
            </div>
            <div id="analyticsContent" class="mt-4 space-y-6"></div>
        `;

        const contentArea = document.getElementById('analyticsContent');

        const renderTabContent = (tabId) => {
            contentArea.innerHTML = ''; 
            Object.values(charts).forEach(chart => {
                if(chart) chart.destroy();
            });

            if (tabId === 'general') {
                renderGeneralReports(receipts, contentArea, charts);
            } else if (tabId === 'deeper') {
                renderDeeperAnalytics(receipts, contentArea);
            } else if (tabId === 'profiles') {
                renderDebtorProfiles(receipts, contentArea);
            }
        };

        container.querySelectorAll('.analytics-tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                container.querySelectorAll('.analytics-tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderTabContent(btn.dataset.tab);
            });
        });

        renderTabContent('general');
    }

    function renderGeneralReports(receipts, container, charts) {
        const iqdReceipts = receipts.filter(r => (r.currency || 'IQD') === 'IQD');
        const usdReceipts = receipts.filter(r => r.currency === 'USD');

        if (iqdReceipts.length === 0 && usdReceipts.length === 0) {
            container.innerHTML = `<div class="empty-state"><i class="fas fa-info-circle"></i><p>${getTranslation('analyticsEmpty')}</p></div>`;
            return;
        }

        container.innerHTML = `
            <div class="currency-switcher">
                ${iqdReceipts.length > 0 ? `<button class="currency-btn" data-currency="IQD">IQD</button>` : ''}
                ${usdReceipts.length > 0 ? `<button class="currency-btn" data-currency="USD">USD</button>` : ''}
            </div>
            <div id="chartContainer" class="space-y-6"></div>
        `;

        const chartContainer = document.getElementById('chartContainer');
        
        const renderChartsForCurrency = (currency) => {
            const data = currency === 'IQD' ? iqdReceipts : usdReceipts;
            chartContainer.innerHTML = `
                <div class="analytics-card"><h3 class="text-lg font-semibold mb-4 text-center">${getTranslation('reportRatioTitle')}</h3><canvas id="ratioChart"></canvas></div>
                <div class="analytics-card"><h3 class="text-lg font-semibold mb-4 text-center">${getTranslation('reportByCategoryTitle')}</h3><canvas id="categoryChart"></canvas></div>
                <div class="analytics-card"><h3 class="text-lg font-semibold mb-4 text-center">${getTranslation('reportByMonthTitle')}</h3><canvas id="monthlyChart"></canvas></div>
            `;

            if (charts.ratio) charts.ratio.destroy();
            if (charts.category) charts.category.destroy();
            if (charts.monthly) charts.monthly.destroy();

            let totalPaid = 0, totalLoan = 0;
            data.forEach(r => { totalPaid += getTotalPaid(r); totalLoan += getTotalLoan(r); });
            const totalRemaining = Math.max(0, totalLoan - totalPaid);
            charts.ratio = new Chart(document.getElementById('ratioChart'), {
                type: 'doughnut',
                data: {
                    labels: [getTranslation('reportPaid'), getTranslation('reportRemaining')],
                    datasets: [{ data: [totalPaid, totalRemaining], backgroundColor: ['#10B981', '#EF4444'], hoverOffset: 4 }]
                },
                options: { responsive: true, maintainAspectRatio: true, animation: { animateScale: true } }
            });

            const categoryData = data.reduce((acc, r) => {
                const categoryName = r.category;
                acc[categoryName] = (acc[categoryName] || 0) + getTotalLoan(r);
                return acc;
            }, {});
            charts.category = new Chart(document.getElementById('categoryChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{ data: Object.values(categoryData), backgroundColor: ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#3B82F6', '#6D28D9'], hoverOffset: 4 }]
                },
                options: { responsive: true, maintainAspectRatio: true, animation: { animateScale: true } }
            });
            
            const monthlyData = data.reduce((acc, r) => {
                const monthYear = r.date.substring(0, 7);
                acc[monthYear] = (acc[monthYear] || 0) + r.initialAmount;
                return acc;
            }, {});
            const sortedMonths = Object.keys(monthlyData).sort();
            charts.monthly = new Chart(document.getElementById('monthlyChart'), {
                type: 'bar',
                data: {
                    labels: sortedMonths,
                    datasets: [{
                        label: getTranslation('reportTotalDebtsLabel'),
                        data: sortedMonths.map(m => monthlyData[m]),
                        backgroundColor: 'rgba(79, 70, 229, 0.8)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true, scales: { y: { beginAtZero: true } } }
            });
        };

        const currencyBtns = container.querySelectorAll('.currency-btn');
        currencyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                currencyBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderChartsForCurrency(btn.dataset.currency);
            });
        });

        const preferredCurrency = (defaultCurrency === 'USD' && usdReceipts.length > 0) ? 'USD' : (iqdReceipts.length > 0 ? 'IQD' : 'USD');
        const initialBtn = container.querySelector(`.currency-btn[data-currency="${preferredCurrency}"]`) || currencyBtns[0];
        if (initialBtn) {
            initialBtn.click();
        }
    }

    function renderDeeperAnalytics(receipts, container) {
        let cashFlowHtml = `
            <div class="analytics-card">
                <h3 class="text-lg font-semibold mb-4 text-center">${getTranslation('analyticsCashFlowTitle')}</h3>
                <canvas id="cashFlowChart"></canvas>
            </div>
        `;

        const unpaidReceipts = receipts.filter(r => getRemainingAmount(r) > 0);
        let topDebtorsHtml = '';
        
        const debtors = {};
        unpaidReceipts.forEach(r => {
            const key = r.phone || `unique_${r.id}`;
            if (!debtors[key]) {
                debtors[key] = { name: r.name, iqd: 0, usd: 0 };
            }
            const remaining = getRemainingAmount(r);
            if (r.currency === 'USD') debtors[key].usd += remaining;
            else debtors[key].iqd += remaining;
        });

        const sortedDebtors = Object.values(debtors).sort((a, b) => (b.iqd + b.usd * globalExchangeRate) - (a.iqd + a.usd * globalExchangeRate)).slice(0, 5);
        
        topDebtorsHtml += `<div class="analytics-card"><h3 class="text-lg font-semibold mb-4">${getTranslation('deeperAnalyticsTopDebtors')}</h3><ul class="space-y-3">`;
        if(sortedDebtors.length > 0) {
            sortedDebtors.forEach(debtor => {
                const amountStrings = [];
                if (debtor.iqd > 0) amountStrings.push(`${debtor.iqd.toLocaleString()} Ø¯.Ø¹`);
                if (debtor.usd > 0) amountStrings.push(`$${debtor.usd.toLocaleString()}`);
                topDebtorsHtml += `<li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"><strong>${debtor.name}</strong><span class="font-bold text-danger">${amountStrings.join(' + ')}</span></li>`;
            });
        } else {
            topDebtorsHtml += `<li class="text-center text-gray-500 p-4">${getTranslation('analyticsEmpty')}</li>`;
        }
        topDebtorsHtml += `</ul></div>`;
        
        const sortedOldest = unpaidReceipts.sort((a, b) => new Date(a.date) - new Date(b.date)).slice(0, 5);
        let oldestDebtsHtml = `<div class="analytics-card"><h3 class="text-lg font-semibold mb-4">${getTranslation('deeperAnalyticsOldestDebts')}</h3><ul class="space-y-3">`;
        if (sortedOldest.length > 0) {
            sortedOldest.forEach(r => {
                const currencySymbol = r.currency === 'USD' ? '$' : 'Ø¯.Ø¹';
                oldestDebtsHtml += `<li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"><div><strong>${r.name}</strong><br><small class="text-gray-500">${getTranslation('detailsModalStartDate')}: ${formatLocaleDate(r.date)}</small></div><span class="font-bold text-danger">${getRemainingAmount(r).toLocaleString()} ${currencySymbol}</span></li>`;
            });
        } else {
            oldestDebtsHtml += `<li class="text-center text-gray-500 p-4">${getTranslation('analyticsEmpty')}</li>`;
        }
        oldestDebtsHtml += `</ul></div>`;
        
        container.innerHTML = cashFlowHtml + topDebtorsHtml + oldestDebtsHtml;
        renderCashFlowForecast();
    }

    async function renderCashFlowForecast() {
        const receipts = await getReceipts();
        const forecastDays = 30;
        const forecastDataIQD = new Array(forecastDays).fill(0);
        const forecastDataUSD = new Array(forecastDays).fill(0);
        const labels = [];
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let i = 0; i < forecastDays; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);
            labels.push(`${date.getDate()}/${date.getMonth() + 1}`);
        }

        receipts.forEach(r => {
            if (getRemainingAmount(r) <= 0.001) return;

            const currency = r.currency || 'IQD';
            const dataArray = currency === 'USD' ? forecastDataUSD : forecastDataIQD;

            if (r.isInstallment && r.installments) {
                r.installments.forEach(inst => {
                    if (inst.status !== 'paid') {
                        const dueDate = new Date(inst.dueDate);
                        const diffTime = dueDate - today;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                        if (diffDays >= 0 && diffDays < forecastDays) {
                            dataArray[diffDays] += (inst.amount - (inst.paidAmount || 0));
                        }
                    }
                });
            } else {
                const dueDate = new Date(r.dueDate);
                const diffTime = dueDate - today;
                const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays >= 0 && diffDays < forecastDays) {
                    dataArray[diffDays] += getRemainingAmount(r);
                }
            }
        });

        const ctx = document.getElementById('cashFlowChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: getTranslation('cashFlowExpected') + ' (IQD)',
                        data: forecastDataIQD,
                        backgroundColor: 'rgba(79, 70, 229, 0.8)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1
                    },
                    {
                        label: getTranslation('cashFlowExpected') + ' (USD)',
                        data: forecastDataUSD,
                        backgroundColor: 'rgba(22, 163, 74, 0.8)',
                        borderColor: 'rgba(22, 163, 74, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: { stacked: true },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) { return value.toLocaleString(); }
                        }
                    }
                }
            }
        });
    }

    function renderDebtorProfiles(receipts, container) {
        const debtors = {};
        receipts.forEach(r => {
            const key = r.phone || `unique_${r.id}`;
            if (!debtors[key]) {
                debtors[key] = { name: r.name, totalLoanIQD: 0, totalPaidIQD: 0, totalLoanUSD: 0, totalPaidUSD: 0, count: 0 };
            }
            const totalLoan = getTotalLoan(r);
            const totalPaid = getTotalPaid(r);

            if ((r.currency || 'IQD') === 'USD') {
                debtors[key].totalLoanUSD += totalLoan;
                debtors[key].totalPaidUSD += totalPaid;
            } else {
                debtors[key].totalLoanIQD += totalLoan;
                debtors[key].totalPaidIQD += totalPaid;
            }
            debtors[key].count++;
        });

        const sortedDebtors = Object.values(debtors).sort((a, b) => a.name.localeCompare(b.name));
        
        let profilesHtml = '<div class="space-y-4">';
        sortedDebtors.forEach(data => {
            const remainingIQD = data.totalLoanIQD - data.totalPaidIQD;
            const remainingUSD = data.totalLoanUSD - data.totalPaidUSD;

            profilesHtml += `
                <div class="analytics-card p-4">
                    <h4 class="text-lg font-bold mb-3">${data.name} (${data.count})</h4>
                    ${data.totalLoanIQD > 0 ? `
                    <div class="mb-2">
                        <p class="text-sm text-gray-600">${getTranslation('currencyIQDTitle')}</p>
                        <div class="grid grid-cols-2 gap-2 text-center text-sm">
                            <div class="bg-blue-50 p-2 rounded"><strong>${data.totalLoanIQD.toLocaleString()}</strong><br><small>${getTranslation('totalLoans')}</small></div>
                            <div class="bg-red-50 p-2 rounded"><strong>${remainingIQD.toLocaleString()}</strong><br><small>${getTranslation('remaining')}</small></div>
                        </div>
                    </div>` : ''}
                    ${data.totalLoanUSD > 0 ? `
                    <div>
                        <p class="text-sm text-gray-600">${getTranslation('currencyUSDTitle')}</p>
                        <div class="grid grid-cols-2 gap-2 text-center text-sm">
                            <div class="bg-blue-50 p-2 rounded"><strong>$${data.totalLoanUSD.toLocaleString()}</strong><br><small>${getTranslation('totalLoans')}</small></div>
                            <div class="bg-red-50 p-2 rounded"><strong>$${remainingUSD.toLocaleString()}</strong><br><small>${getTranslation('remaining')}</small></div>
                        </div>
                    </div>` : ''}
                </div>
            `;
        });
        profilesHtml += '</div>';
        container.innerHTML = profilesHtml;
    }

    async function clearAllReceipts() {
Â  Â  Â  Â  const firstConfirm = await showConfirm({
Â  Â  Â  Â  Â  Â  title: getTranslation('confirmClearAllTitle'),
Â  Â  Â  Â  Â  Â  message: getTranslation('confirmClearAllMsg'),
Â  Â  Â  Â  Â  Â  okText: getTranslation('yesBtn'),
Â  Â  Â  Â  Â  Â  cancelText: getTranslation('noBtn')
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (firstConfirm) {
Â  Â  Â  Â  Â  Â  const secondConfirm = await showConfirm({
Â  Â  Â  Â  Â  Â  Â  Â  title: getTranslation('confirmSure'),
Â  Â  Â  Â  Â  Â  Â  Â  message: "",
Â  Â  Â  Â  Â  Â  Â  Â  okText: getTranslation('yesBtn'),
Â  Â  Â  Â  Â  Â  Â  Â  cancelText: getTranslation('noBtn')
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (secondConfirm) {
Â  Â  Â  Â  Â  Â  Â  Â  const requiredWord = (currentLang === 'ar') ? 'Ù…ÙˆØ§ÙÙ‚' : 'Ú•Ø§Ø²ÛŒÙ…';
Â  Â  Â  Â  Â  Â  Â  Â  const thirdConfirm = await showPromptConfirm({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: getTranslation('confirmClearAllPromptTitle'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message: getTranslation('confirmClearAllPromptMsg'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder: requiredWord,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  okText: getTranslation('confirmBtn'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelText: getTranslation('cancelBtn'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  requiredWord: requiredWord
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (thirdConfirm) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await clearAllReceiptsDB();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('unlockedAchievements');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('lastReportTimestamp');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDashboardStats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateBadges();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateHeaderForecast();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await loadReceipts();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(getTranslation('allDataDeleted'), 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showPage('homePage', document.querySelector('button[data-page="homePage"]'));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

    async function updateWelcomeSection() {
Â  Â  Â  Â  const welcomeTitle = document.getElementById('welcomeTitle');
Â  Â  Â  Â  const welcomeBody = document.getElementById('welcomeBody');
Â  Â  Â  Â  const receipts = await getReceipts();

Â  Â  Â  Â  // --- START OF FIX ---
Â  Â  Â  Â  // Ø¦Û•Ù… ÙÛ•Ù†Ú©Ø´Ù†Û• Ù†ÙˆÛÛŒÛ• Ø¯ÚµÙ†ÛŒØ§Ø¯Û•Ø¨ÛØªÛ•ÙˆÛ• Ú©Û• Ø¨Û•Ø±ÙˆØ§Ø±Û•Ú©Ø§Ù† ÙˆÛ•Ú© Ú©Ø§ØªÛŒ Ù†Ø§ÙˆØ®Û†ÛŒÛŒ Ø¯Û•Ø®ÙˆÛÙ†Ø±ÛÙ†Û•ÙˆÛ•
Â  Â  Â  Â  const parseLocalDate = (dateString) => {
Â  Â  Â  Â  Â  Â  if (!dateString) return null;
Â  Â  Â  Â  Â  Â  const parts = dateString.split('-');
Â  Â  Â  Â  Â  Â  if (parts.length !== 3) return new Date(dateString); // Fallback
Â  Â  Â  Â  Â  Â  // (Year, MonthIndex (0-11), Day)
Â  Â  Â  Â  Â  Â  return new Date(parts[0], parts[1] - 1, parts[2]);
Â  Â  Â  Â  };
Â  Â  Â  Â  // --- END OF FIX ---

Â  Â  Â  Â  if (receipts.length === 0) {
Â  Â  Â  Â  Â  Â  welcomeTitle.textContent = getTranslation('welcomeFirstTimeTitle');
Â  Â  Â  Â  Â  Â  welcomeBody.textContent = getTranslation('welcomeFirstTimeBody');
Â  Â  Â  Â  	const aiSummaryCard = document.getElementById('aiSummaryCard');
Â  Â  Â  Â  	const smartNotificationsWrapper = document.querySelector('.smart-notifications-wrapper');
Â  Â  Â  Â  	if (aiSummaryCard) aiSummaryCard.classList.add('hidden');
Â  Â  Â  Â  	if (smartNotificationsWrapper) smartNotificationsWrapper.style.display = 'none';

Â  Â  Â  Â  } else {
Â  Â  Â  Â  	const aiSummaryCard = document.getElementById('aiSummaryCard');
Â  Â  Â  Â  	const smartNotificationsWrapper = document.querySelector('.smart-notifications-wrapper');
Â  Â  Â  Â  	// Logic inside generateAiSummary will handle showing/hiding aiSummaryCard
Â  Â  Â  Â  	if (smartNotificationsWrapper) smartNotificationsWrapper.style.display = 'block';

Â  Â  Â  Â  Â  Â  const currentHour = new Date().getHours();
Â  Â  Â  Â  Â  Â  let greetingKey = 'welcomeGreetingEvening';
Â  Â  Â  Â  Â  Â  if (currentHour >= 5 && currentHour < 12) greetingKey = 'welcomeGreetingMorning';
Â  Â  Â  Â  Â  Â  else if (currentHour >= 12 && currentHour < 18) greetingKey = 'welcomeGreetingAfternoon';
Â  Â  Â  Â  Â  Â  const timeBasedGreeting = getTranslation(greetingKey);

Â  Â  Â  Â  Â  Â  const overdueDebts = receipts.filter(r => getDebtStatus(r) === 'overdue');

Â  Â  Â  Â  Â  Â  // --- START: Enhanced Due Soon Logic ---
Â  Â  Â  Â  Â  Â  const today = new Date(); today.setHours(0, 0, 0, 0);
Â  Â  Â  Â  Â  Â  const threeDaysLater = new Date(today); threeDaysLater.setDate(today.getDate() + 3);
Â  Â  Â  Â  Â  Â  let earliestDueDateDiff = Infinity; // Find the minimum days difference
Â  Â  Â  Â  Â  Â  const debtsDueSoonDetails = []; // Store details { diffDays, remainingIQD, remainingUSD }

Â  Â  Â  Â  Â  Â  receipts.forEach(r => {
Â  Â  Â  Â  Â  Â  	const status = getDebtStatus(r);
Â  Â  Â  Â  Â  Â  	if (status === 'paid' || status === 'overdue') return; // Skip paid or already overdue

Â  Â  Â  Â  Â  Â  	let nextDueDate = null;
Â  Â  Â  Â  Â  Â  	let amountDueOnDate = 0; // Amount specifically due on the next date

Â  Â  Â  Â  Â  Â  	if (r.isInstallment && r.installments) {
Â  Â  Â  Â  Â  Â  		const nextInstallment = r.installments.find(i => i.status !== 'paid');
Â  Â  Â  Â  Â  Â  		if (nextInstallment) {
Â  Â  Â  Â  Â  Â  			nextDueDate = parseLocalDate(nextInstallment.dueDate); // FIXED
Â  Â  Â  Â  Â  Â  			amountDueOnDate = nextInstallment.amount - (nextInstallment.paidAmount || 0);
Â  Â  Â  Â  Â  Â  		}
Â  Â  Â  Â  Â  Â  	} else { // Not installment
Â  Â  Â  Â  Â  Â  		nextDueDate = parseLocalDate(r.dueDate); // FIXED
Â  Â  Â  Â  Â  Â  		amountDueOnDate = getRemainingAmount(r); // For non-installments, the full remaining is due
Â  Â  Â  Â  Â  Â  	}

Â  Â  Â  Â  Â  Â  	if (nextDueDate && amountDueOnDate > 0) {
Â  Â  Â  Â  Â  Â  		// nextDueDate.setHours(0, 0, 0, 0); // No longer needed, parseLocalDate does this.
Â  Â  Â  Â  Â  Â  		if (nextDueDate >= today && nextDueDate <= threeDaysLater) {
Â  Â  Â  Â  Â  Â  			const diffTime = nextDueDate - today;
                        // We also change Math.round() to Math.ceil() just to be safer with DST
Â  Â  Â  Â  Â  Â  			const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); // FIXED (round to ceil)

Â  Â  Â  Â  Â  Â  			earliestDueDateDiff = Math.min(earliestDueDateDiff, diffDays);

Â  Â  Â  Â  Â  Â  			// Store details for calculation later
Â  Â  Â  Â  Â  Â  			debtsDueSoonDetails.push({
Â  Â  Â  Â  Â  Â  				diffDays: diffDays,
Â  Â  Â  Â  Â  Â  				remainingIQD: (r.currency || 'IQD') === 'IQD' ? amountDueOnDate : 0,
Â  Â  Â  Â  Â  Â  				remainingUSD: r.currency === 'USD' ? amountDueOnDate : 0
Â  Â  Â  Â  Â  Â  			});
Â  Â  Â  Â  Â  Â  		}
Â  Â  Â  Â  Â  Â  	}
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  // --- END: Enhanced Due Soon Logic ---


Â  Â  Â  Â  Â  Â  if (overdueDebts.length > 0) {
Â  Â  Â  Â  Â  Â  	// Overdue message (same as before)
Â  Â  Â  Â  Â  Â  	const totalOverdueAmountIQD = overdueDebts.filter(r => (r.currency || 'IQD') === 'IQD').reduce((sum, r) => sum + getRemainingAmount(r), 0);
Â  Â  Â  Â  Â  Â  	const totalOverdueAmountUSD = overdueDebts.filter(r => r.currency === 'USD').reduce((sum, r) => sum + getRemainingAmount(r), 0);
Â  Â  Â  Â  Â  Â  	let amountStrings = [];
Â  Â  Â  Â  Â  Â  	if (totalOverdueAmountIQD > 0) amountStrings.push(`${totalOverdueAmountIQD.toLocaleString(undefined, { maximumFractionDigits: 0 })} Ø¯.Ø¹`);
Â  Â  Â  Â  Â  Â  	if (totalOverdueAmountUSD > 0) amountStrings.push(`$${totalOverdueAmountUSD.toLocaleString(undefined, { maximumFractionDigits: 2 })}`);
Â  Â  Â  Â  Â  Â  	const separator = currentLang === 'ku' ? ' Ùˆ ' : ' + ';
Â  Â  Â  Â  Â  Â  	const overdueAmountString = amountStrings.join(separator) || '0';
Â  Â  Â  Â  Â  Â  	welcomeTitle.textContent = `${timeBasedGreeting}ØŒ ${getTranslation("welcomeStatusOverdueTitle").split('ØŒ')[1] || getTranslation("welcomeStatusOverdueTitle")}`;
Â  Â  Â  Â  Â  Â  	welcomeBody.textContent = getTranslation("welcomeStatusOverdueBody", { count: overdueDebts.length, amount: overdueAmountString });

Â  Â  Â  Â  Â  Â  } else if (earliestDueDateDiff <= 3) {
Â  Â  Â  Â  Â  Â  	// Due Soon message - now more specific
Â  Â  Â  Â  Â  Â  	welcomeTitle.textContent = `${timeBasedGreeting}ØŒ ${getTranslation("welcomeStatusDueSoonTitle").split('ØŒ')[1] || getTranslation("welcomeStatusDueSoonTitle")}`;

Â  Â  Â  Â  Â  Â  	// Calculate count and amount ONLY for the EARLIEST due date found
Â  Â  Â  Â  Â  Â  	let countForEarliestDate = 0;
Â  Â  Â  Â  Â  Â  	let totalIQDForEarliestDate = 0;
Â  Â  Â  Â  Â  Â  	let totalUSDForEarliestDate = 0;

Â  Â  Â  Â  Â  Â  	debtsDueSoonDetails.forEach(detail => {
Â  Â  Â  Â  Â  Â  		if (detail.diffDays === earliestDueDateDiff) {
Â  Â  Â  Â  Â  Â  			countForEarliestDate++;
Â  Â  Â  Â  Â  Â  			totalIQDForEarliestDate += detail.remainingIQD;
Â  Â  Â  Â  Â  Â  			totalUSDForEarliestDate += detail.remainingUSD;
Â  Â  Â  Â  Â  Â  		}
Â  Â  Â  Â  Â  Â  	});

Â  Â  Â  Â  Â  Â  	let amountStrings = [];
Â  Â  Â  Â  Â  Â  	if (totalIQDForEarliestDate > 0) amountStrings.push(`${totalIQDForEarliestDate.toLocaleString(undefined, { maximumFractionDigits: 0 })} Ø¯.Ø¹`);
Â  Â  Â  Â  Â  Â  	if (totalUSDForEarliestDate > 0) amountStrings.push(`$${totalUSDForEarliestDate.toLocaleString(undefined, { maximumFractionDigits: 2 })}`);
			const separator = currentLang === 'ku' ? ' Ùˆ ' : ' + ';
			const amountStringForEarliestDate = amountStrings.join(separator) || '0';


Â  Â  Â  Â  Â  Â  	let bodyKey = 'welcomeDueInXDaysBody';
Â  Â  Â  Â  Â  Â  	let replacements = { count: countForEarliestDate, amount: amountStringForEarliestDate, days: earliestDueDateDiff };

Â  Â  Â  Â  Â  Â  	if (earliestDueDateDiff === 0) {
Â  Â  Â  Â  Â  Â  		bodyKey = 'welcomeDueTodayBody';
Â  Â  Â  Â  Â  Â  		replacements = { count: countForEarliestDate, amount: amountStringForEarliestDate };
Â  Â  Â  Â  Â  Â  	} else if (earliestDueDateDiff === 1) {
Â  Â  Â  Â  Â  Â  		bodyKey = 'welcomeDueTomorrowBody';
Â  Â  Â  Â  Â  Â  		replacements = { count: countForEarliestDate, amount: amountStringForEarliestDate };
Â  Â  Â  Â  Â  Â  	} // For diffDays 2 and 3, the default key and replacements work

Â  Â  Â  Â  Â  Â  	welcomeBody.innerHTML = getTranslation(bodyKey, replacements); // Changed to .innerHTML to support <strong>

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  	// OK message (no overdue or due soon)
Â  Â  Â  Â  Â  Â  	welcomeTitle.textContent = `${timeBasedGreeting}ØŒ ${getTranslation("welcomeStatusOkTitle").split('ØŒ')[1] || getTranslation("welcomeStatusOkTitle")}`;
Â  Â  Â  Â  Â  Â  	// Choose the preferred "OK" message
			// Using the more engaging one: "Ø´Ø§Ø²ÛŒ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†!"
			if (currentLang === 'ku') {
				welcomeBody.textContent = "ğŸ˜ Ù‡ÛŒÚ† Ù‚Û•Ø±Ø²ÛÚ©ÛŒ Ø¯ÙˆØ§Ú©Û•ÙˆØªÙˆÙˆ ÛŒØ§Ù† Ú©Ø§Øª Ù†Ø²ÛŒÚ©Øª Ù†ÛŒÛŒÛ•. Ø¨Û•Ø±Ø¯Û•ÙˆØ§Ù… Ø¨Û•!";
			} else { // Fallback for Arabic or default
				welcomeBody.textContent = getTranslation("welcomeStatusOkBody"); // You might want to update the Arabic translation too later
			}
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

    async function updateHeaderForecast() {
        const headerTitleEl = document.getElementById('headerTitle');
        if (!headerTitleEl) return;

        try {
            const receipts = await getReceipts();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const forecastEndDate = new Date();
            forecastEndDate.setDate(today.getDate() + 7);

            let forecastIQD = 0;
            let forecastUSD = 0;

            receipts.forEach(r => {
                if (getDebtStatus(r) === 'paid') return;
                
                if (r.isInstallment && r.installments) {
                    r.installments.forEach(inst => {
                        if (inst.status !== 'paid') {
                            const dueDate = new Date(inst.dueDate);
                            if (dueDate >= today && dueDate <= forecastEndDate) {
                                const dueAmount = inst.amount - (inst.paidAmount || 0);
                                if (r.currency === 'USD') forecastUSD += dueAmount;
                                else forecastIQD += dueAmount;
                            }
                        }
                    });
                } else {
                    const dueDate = new Date(r.dueDate);
                    if (dueDate >= today && dueDate <= forecastEndDate) {
                        const remaining = getRemainingAmount(r);
                        if (r.currency === 'USD') forecastUSD += remaining;
                        else forecastIQD += remaining;
                    }
                }
            });

            if (forecastIQD === 0 && forecastUSD === 0) {
                headerTitleEl.textContent = getTranslation('appTitle');
                return;
            }
            
            let forecastText = 'ğŸ“ˆ Ù¾ÛØ´Ø¨ÛŒÙ†ÛŒ Ù§ Ú•Û†Ú˜: ';
            if(currentLang === 'ar') forecastText = 'ğŸ“ˆ ØªÙˆÙ‚Ø¹Ø§Øª 7 Ø£ÙŠØ§Ù…: ';

            let amounts = [];
            if (forecastIQD > 0) {
                amounts.push(`${Math.ceil(forecastIQD).toLocaleString()} Ø¯.Ø¹`);
            }
            if (forecastUSD > 0) {
                amounts.push(`$${Math.ceil(forecastUSD).toLocaleString()}`);
            }
            
            forecastText += amounts.join(' + ');
            headerTitleEl.textContent = forecastText;

        } catch (error) {
            console.error("Error updating header forecast:", error);
            headerTitleEl.textContent = getTranslation('appTitle');
        }
    }


    function updateAmountLabel(currency) {
        const label = document.querySelector('#receiptForm label[for="amount"] span');
        if (label) {
            const key = currency === 'USD' ? 'formInitialAmountUSD' : 'formInitialAmountIQD';
            label.setAttribute('data-translate-key', key);
            label.textContent = getTranslation(key);
        }
    }

    function buildFilterButtons() {
        const container = document.getElementById('filterContainer');
        container.className = 'filter-pills-container mb-4';
        container.innerHTML = ''; 

        const filters = ['unpaid', 'paid', 'alerts'];
        const iconMap = { unpaid: 'fa-hourglass-half', paid: 'fa-check-circle', alerts: 'fa-bell' };

        filters.forEach(key => {
            const button = document.createElement('button');
            button.className = `filter-pill-btn ${key === currentFilter ? 'active' : ''}`;
            button.dataset.filter = key;

            const badgeHtml = (key === 'alerts') ? '<span class="filter-badge hidden"></span>' : '';

            button.innerHTML = `<i class="fas ${iconMap[key]}"></i><span>${getTranslation('filter' + key.charAt(0).toUpperCase() + key.slice(1))}</span>${badgeHtml}`;
            
            button.addEventListener('click', () => {
                if (currentFilter === key) return;
                currentFilter = key;
                container.querySelector('.filter-pill-btn.active').classList.remove('active');
                button.classList.add('active');
                filterAndSortReceipts();
            });
            container.appendChild(button);
        });
    }

    async function getAlertCount() {
        const receipts = await getReceipts();
        let alertCount = 0;
        const uniqueAlerts = new Set();

        receipts.forEach(r => {
            const status = getDebtStatus(r);
            if (status === 'overdue' && !uniqueAlerts.has(r.id)) {
                alertCount++;
                uniqueAlerts.add(r.id);
            }

            let isDueSoon = false;
            if (r.isInstallment && r.installments) {
                const firstUnpaid = r.installments.find(i => i.status !== 'paid');
                if (firstUnpaid) {
                    const today = new Date(); today.setHours(0, 0, 0, 0);
                    const dueDate = new Date(firstUnpaid.dueDate);
                    const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                    isDueSoon = daysDiff >= 0 && daysDiff <= 3;
                }
            } else if (status === 'pending') {
                const today = new Date(); today.setHours(0, 0, 0, 0);
                const dueDate = new Date(r.dueDate);
                const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                isDueSoon = daysDiff >= 0 && daysDiff <= 3;
            }

            if(isDueSoon && !uniqueAlerts.has(r.id)){
                alertCount++;
                uniqueAlerts.add(r.id);
            }
        });
        return alertCount;
    }


    async function updateBadges() {
        const alertCount = await getAlertCount();

        const bellBadge = document.getElementById('notificationBadge');
        const bellIcon = document.querySelector('#notificationBellBtn i');
        if (bellBadge && bellIcon) {
            if (alertCount > 0) {
                bellBadge.textContent = alertCount;
                bellBadge.classList.remove('hidden');
                if (!bellIcon.classList.contains('no-ring')) {
                    bellIcon.classList.add('bell-ringing');
                }
            } else {
                bellBadge.textContent = '';
                bellBadge.classList.add('hidden');
                bellIcon.classList.remove('bell-ringing');
                bellIcon.classList.remove('no-ring');
            }
        }

        const filterBadge = document.querySelector('button[data-filter="alerts"] .filter-badge');
        if (filterBadge) {
            if (alertCount > 0) {
                filterBadge.textContent = alertCount;
                filterBadge.classList.remove('hidden');
            } else {
                filterBadge.classList.add('hidden');
            }
        }
    }

    async function checkSmartNotifications() {
        const receipts = await getReceipts();
        const today = new Date(); today.setHours(0, 0, 0, 0);
        const notifications = [];
        receipts.forEach(receipt => {
            const status = getDebtStatus(receipt);
            if (status === 'overdue') {
                notifications.push({ type: 'danger', receipt: receipt });
            } else {
                let dueSoon = false;
                if(receipt.isInstallment && receipt.installments){
                    const nextInstallment = receipt.installments.find(i => i.status !== 'paid');
                    if (nextInstallment) {
                        const dueDate = new Date(nextInstallment.dueDate);
                        const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                        if(daysDiff >=0 && daysDiff <= 3) {
                            notifications.push({ type: 'warning', receipt: receipt, days: daysDiff });
                        }
                    }
                } else if(status === 'pending') {
                    const dueDate = new Date(receipt.dueDate);
                    const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                    if (daysDiff >=0 && daysDiff <= 3) {
                        notifications.push({ type: 'warning', receipt: receipt, days: daysDiff });
                    }
                }
            }
        });
        showSmartNotifications([...new Map(notifications.map(item => [item.receipt.id, item])).values()].sort((a,b) => a.type === 'danger' ? -1 : 1).slice(0, 5));
    }
    
    function showSmartNotifications(notifications) {
        const container = document.getElementById('smartNotifications');
        container.innerHTML = '';
        if (notifications.length === 0) {
            container.parentElement.style.display = 'none';
            return;
        }

        container.parentElement.style.display = 'block';

        notifications.forEach(n => {
            const card = document.createElement('div');
            card.className = `smart-alert-card alert-${n.type}`;
            card.addEventListener('click', (e) => {
                if (!e.target.closest('a')) {
                    showReceiptDetails(n.receipt.id);
                }
            });

            let title, message, iconClass;
            if (n.type === 'danger') {
                title = getTranslation('smartAlertsTitleOverdue');
                message = getTranslation('notificationOverdue', { name: n.receipt.name });
                iconClass = 'fas fa-exclamation-triangle';
            } else {
                title = getTranslation('smartAlertsTitleDueSoon');
                message = getTranslation('notificationDueSoon', { days: n.days, name: n.receipt.name });
                iconClass = 'fas fa-hourglass-half';
            }

            let actionsHtml = '';
            if (n.receipt.phone) {
                const msg = encodeURIComponent(generateContactMessage(n.receipt));
                actionsHtml = `
                    <div class="action-area">
                        <a href="tel:${n.receipt.phone}" onclick="event.stopPropagation()" class="smart-alert-action-btn call" title="${getTranslation('detailsModalContact')}" aria-label="${getTranslation('detailsModalContact')}"><i class="fas fa-phone-alt"></i></a>
                        <a href="https://wa.me/964${n.receipt.phone.substring(1)}?text=${msg}" onclick="event.stopPropagation()" target="_blank" class="smart-alert-action-btn whatsapp" title="${getTranslation('detailsModalWhatsapp')}" aria-label="${getTranslation('detailsModalWhatsapp')}"><i class="fab fa-whatsapp"></i></a>
                        <a href="https://t.me/share/url?url= &text=${msg}" onclick="event.stopPropagation()" target="_blank" class="smart-alert-action-btn telegram" title="${getTranslation('detailsModalTelegram')}" aria-label="${getTranslation('detailsModalTelegram')}"><i class="fab fa-telegram-plane"></i></a>
                    </div>
                `;
            }

            card.innerHTML = `
                <div class="header">
                       <div class="icon-area"><i class="${iconClass}"></i></div>
                    <div class="content-area">
                        <h4>${title}</h4>
                        <p>${message}</p>
                    </div>
                </div>
                ${actionsHtml}
            `;
            container.appendChild(card);
        });
    }

    function updateConversionInfo() {
        const conversionInfoEl = document.getElementById('conversionInfo');
        const paidAmount = parseFloat(document.getElementById('paidAmountInput').value);
        const originalCurrency = document.getElementById('originalDebtCurrency').value;
        const paymentCurrency = document.querySelector('#paymentCurrencyToggle button.active')?.dataset.currency;

        if (isNaN(paidAmount) || paidAmount <= 0 || !paymentCurrency || paymentCurrency === originalCurrency) {
            conversionInfoEl.classList.add('hidden');
            return;
        }

        let convertedAmount;
        let convertedCurrency;

        if (originalCurrency === 'USD' && paymentCurrency === 'IQD') {
            convertedAmount = paidAmount / globalExchangeRate;
            convertedCurrency = 'USD';
        } else if (originalCurrency === 'IQD' && paymentCurrency === 'USD') {
            convertedAmount = paidAmount * globalExchangeRate;
            convertedCurrency = 'IQD';
        }

        if (convertedAmount) {
Â  Â  Â  Â  Â  Â  conversionInfoEl.innerHTML = `â‰ˆ <strong>${convertedAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong> ${convertedCurrency}`;
Â  Â  Â  Â  Â  Â  conversionInfoEl.classList.remove('hidden');
Â  Â  Â  Â  } else {
            conversionInfoEl.classList.add('hidden');
        }
    }

    function setDefaultCurrency(currency) {
        defaultCurrency = currency;
        localStorage.setItem('defaultCurrency', currency);
        updateDefaultCurrencyUI();
        updateCurrencyDisplayOrder(); 
        showToast(getTranslation('settingsSavedToast'), 'success');
    }

    function updateDefaultCurrencyUI() {
        document.getElementById('defaultIqdBtn').classList.toggle('active', defaultCurrency === 'IQD');
        document.getElementById('defaultUsdBtn').classList.toggle('active', defaultCurrency === 'USD');
    }
    
    function updateCurrencyDisplayOrder() {
        const container = document.getElementById('statsMainContainer');
        const iqdSection = document.getElementById('iqdStatsContainer');
        const usdSection = document.getElementById('usdStatsContainer');
        if (!container || !iqdSection || !usdSection) return;

        if (defaultCurrency === 'USD') {
            container.prepend(usdSection);
        } else { 
            container.prepend(iqdSection);
        }
    }

    function getCustomCategories() {
        const stored = localStorage.getItem('debtCategories');
        if (stored) {
            return JSON.parse(stored);
        } else {
            const defaults = (currentLang === 'ar')
                ? ['Ø´Ø®ØµÙŠ', 'Ø¨Ù†Ùƒ', 'Ù…Ø®Ø²Ù†', 'Ø³ÙˆÙ‚', 'Ù…Ø­Ù„']
                : ['Ø´Û•Ø®Ø³ÛŒ', 'Ø¨Ø§Ù†Ù‚', 'Ú©Û†Ú¯Ø§', 'Ù…Ø§Ø±Ú©ÛØª', 'Ø¯ÙˆÚ©Ø§Ù†'];
            localStorage.setItem('debtCategories', JSON.stringify(defaults));
            return defaults;
        }
    }

    function saveCustomCategories(categories) {
        localStorage.setItem('debtCategories', JSON.stringify(categories));
    }

    function renderCategoryManager() {
        const container = document.getElementById('categoryListContainer');
        container.innerHTML = '';
        const categories = getCustomCategories();

        categories.forEach(category => {
            const item = document.createElement('div');
            item.className = 'category-item';
            item.innerHTML = `
                <span class="font-medium">${category}</span>
                <button class="category-item-delete-btn" data-category="${category}" title="Ø³Ú•ÛŒÙ†Û•ÙˆÛ•">&times;</button>
            `;
            container.appendChild(item);
        });

        container.querySelectorAll('.category-item-delete-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const categoryToDelete = btn.dataset.category;
                let currentCategories = getCustomCategories();
                currentCategories = currentCategories.filter(c => c !== categoryToDelete);
                saveCustomCategories(currentCategories);
                renderCategoryManager();
                populateCategoryOptions();
                showToast(getTranslation('categoryDeletedToast'), 'info');
            });
        });
    }

    function populateCategoryOptions() {
        const select = document.getElementById('category');
        select.innerHTML = '';
        const categories = getCustomCategories();
        
        categories.forEach(category => {
            const optionEl = document.createElement('option');
            optionEl.value = category;
            optionEl.textContent = category;
            select.appendChild(optionEl);
        });
    }

    const achievementsList = {
        first_debt: {
            icon: 'fas fa-flag-checkered',
            check: (data) => data.receipts.length >= 1
        },
        first_paid: {
            icon: 'fas fa-hand-holding-usd',
            check: (data) => data.receipts.some(r => getRemainingAmount(r) <= 0.001)
        },
        ten_debtors: {
            icon: 'fas fa-users',
            check: (data) => data.uniqueDebtors.size >= 10
        },
        milestone_1m_iqd: {
            icon: 'fas fa-university',
            check: (data) => data.stats.IQD.initial >= 1000000
        },
        collector_1m_iqd: {
            icon: 'fas fa-coins',
            check: (data) => data.stats.IQD.paid >= 1000000
        },
        on_time_champ: {
            icon: 'fas fa-trophy',
            check: (data) => {
                const paidOnTime = data.receipts.filter(r => {
                    if (getRemainingAmount(r) > 0.001) return false;
                    const lastPaymentDate = r.payments.length > 0 ? new Date(r.payments[r.payments.length - 1].date) : new Date();
                    return lastPaymentDate <= new Date(r.dueDate);
                });
                return paidOnTime.length >= 5;
            }
        }
    };

    function getUnlockedAchievements() {
        return JSON.parse(localStorage.getItem('unlockedAchievements')) || [];
    }

    function showAchievementUnlockedModal(achievementId) {
        const achievement = achievementsList[achievementId];
        if (!achievement) return;

        document.getElementById('achievementIcon').innerHTML = `<i class="${achievement.icon}"></i>`;
        document.getElementById('achievementTitle').textContent = getTranslation('achievementUnlocked');
        document.getElementById('achievementDesc').innerHTML = `
            <strong class="block mb-1">${getTranslation(`ach_${achievementId}_title`)}</strong>
            ${getTranslation(`ach_${achievementId}_desc`)}
        `;
        showModal('achievementModal');
    }

    async function checkAndUnlockAchievements() {
        const unlocked = getUnlockedAchievements();
        const data = await updateDashboardStats();

        for (const id in achievementsList) {
            if (!unlocked.includes(id)) {
                const achievement = achievementsList[id];
                if (achievement.check(data)) {
                    unlocked.push(id);
                    localStorage.setItem('unlockedAchievements', JSON.stringify(unlocked));
                    showAchievementUnlockedModal(id);
                }
            }
        }
    }

    function renderAchievementsPage() {
        const container = document.getElementById('achievementsContainer');
        const unlocked = getUnlockedAchievements();
        container.innerHTML = '';

        for (const id in achievementsList) {
            const achievement = achievementsList[id];
            const isUnlocked = unlocked.includes(id);
            const badge = document.createElement('div');
            badge.className = `achievement-badge ${isUnlocked ? 'unlocked' : ''}`;
            badge.innerHTML = `
                <div class="icon"><i class="${achievement.icon}"></i></div>
                <div class="title">${getTranslation(`ach_${id}_title`)}</div>
            `;
            badge.title = getTranslation(`ach_${id}_desc`);
            container.appendChild(badge);
        }
    }

    async function checkAndShowPeriodicReport() {
        const lastReportTimestamp = parseInt(localStorage.getItem('lastReportTimestamp')) || 0;
        const now = new Date();
        const oneWeek = 7 * 24 * 60 * 60 * 1000;

        if (!db || (now.getTime() - lastReportTimestamp < oneWeek)) {
            return;
        }
        
        try { 
            const receipts = await getReceipts();
            const lastWeekStart = new Date(now.getTime() - oneWeek);
            
            let collectedIQD = 0, collectedUSD = 0, newLoansIQD = 0, newLoansUSD = 0;
            const payerAmountsNormalized = {}; 

            receipts.forEach(r => {
                const receiptDate = new Date(r.date);
                const receiptCurrency = r.currency || 'IQD'; 

                if (receiptDate >= lastWeekStart && receiptDate <= now) {
                    if(receiptCurrency === 'USD') newLoansUSD += (r.initialAmount || 0); 
                    else newLoansIQD += (r.initialAmount || 0); 
                }

                (r.payments || []).forEach(p => {
                    if (!p.date || typeof p.amount !== 'number' || isNaN(new Date(p.date))) return; 
                    
                    const paymentDate = new Date(p.date);
                    if (paymentDate >= lastWeekStart && paymentDate <= now) {
                        if(receiptCurrency === 'USD') collectedUSD += p.amount;
                        else collectedIQD += p.amount;

                        let normalizedAmount = p.amount;
                        if (receiptCurrency === 'USD') {
                            const rate = typeof globalExchangeRate === 'number' && globalExchangeRate > 0 ? globalExchangeRate : 1450; 
                            normalizedAmount = p.amount * rate; 
                        }
                        payerAmountsNormalized[r.name] = (payerAmountsNormalized[r.name] || 0) + normalizedAmount; 
                    }
                });
            });

            if (collectedIQD + collectedUSD + newLoansIQD + newLoansUSD === 0) {
                localStorage.setItem('lastReportTimestamp', now.getTime().toString());
                return;
            }

            let collectedText = [];
            if(collectedIQD > 0) collectedText.push(`${collectedIQD.toLocaleString()} Ø¯.Ø¹`);
            if(collectedUSD > 0) collectedText.push(`$${collectedUSD.toLocaleString()}`);

            let newLoansText = [];
            if(newLoansIQD > 0) newLoansText.push(`${newLoansIQD.toLocaleString()} Ø¯.Ø¹`);
            if(newLoansUSD > 0) newLoansText.push(`$${newLoansUSD.toLocaleString()}`);
            
            let topPayer = getTranslation('noActivity');
            if (Object.keys(payerAmountsNormalized).length > 0) { 
                topPayer = Object.keys(payerAmountsNormalized).reduce((a, b) => payerAmountsNormalized[a] > payerAmountsNormalized[b] ? a : b); 
            }

            document.getElementById('reportCollected').textContent = collectedText.join(' + ') || '0';
            document.getElementById('reportNewLoans').textContent = newLoansText.join(' + ') || '0';
            document.getElementById('reportTopPayer').textContent = topPayer;
            showModal('weeklyReportModal');

            localStorage.setItem('lastReportTimestamp', now.getTime().toString());

        } catch (error) {
            console.error("Error generating weekly report:", error);
        }
    }

    async function updateLoanAdvisor() {
        const phoneInput = document.getElementById('phone');
        const nameInput = document.getElementById('name'); 
        const advisorBox = document.getElementById('loanAdvisorBox');
        const advisorIcon = document.getElementById('advisorIcon');
        const advisorTitle = document.getElementById('advisorTitle');
        const advisorDetails = document.getElementById('advisorDetails');

        const phone = phoneInput.value.trim();
        const name = nameInput.value.trim(); 
        
        if (phone.length < 4 && name.length < 2) { 
            advisorBox.classList.add('hidden');
            return;
        }

        const allReceipts = await getReceipts();
        let matchingReceipts = [];
        let searchMethod = null; 

        if (phone.length >= 4) { 
            matchingReceipts = allReceipts.filter(r => r.phone && r.phone === phone);
            searchMethod = 'phone';
        } 
        else if (name.length >= 2) { 
            matchingReceipts = allReceipts.filter(r => r.name.trim().toLowerCase() === name.toLowerCase());
            searchMethod = 'name';
        }

        advisorDetails.innerHTML = ''; 

        if (matchingReceipts.length === 0) {
            if(searchMethod) {
                advisorBox.className = 'p-3 mt-2 rounded-lg border text-sm transition-all duration-300 border-gray-300 bg-gray-50';
                advisorIcon.className = 'fas fa-user-plus text-xl text-gray-500';
                advisorTitle.textContent = getTranslation('advisorNewDebtor');
                const li = document.createElement('li');
                
                if (searchMethod === 'phone') {
                    li.textContent = getTranslation('advisorNewDebtorDesc'); 
                } else if (searchMethod === 'name') {
                    li.textContent = getTranslation('advisorNewDebtorNameDesc'); 
                }

                advisorDetails.appendChild(li);
                advisorBox.classList.remove('hidden');
            } else {
                advisorBox.classList.add('hidden'); 
            }
            return;
        }

        let totalUnpaidIQD = 0, totalUnpaidUSD = 0, overdueCount = 0, paidCount = 0;

        matchingReceipts.forEach(r => {
            const remaining = getRemainingAmount(r);
            const status = getDebtStatus(r);

            if (remaining > 0.001) {
                if ((r.currency || 'IQD') === 'IQD') totalUnpaidIQD += remaining;
                else totalUnpaidUSD += remaining;
            }
            if (status === 'overdue') overdueCount++;
            if (status === 'paid') paidCount++;
        });

        let detailsHtml = '';
        if (totalUnpaidIQD > 0) detailsHtml += `<li>${getTranslation('advisorTotalRemaining')} <strong>${totalUnpaidIQD.toLocaleString()} Ø¯.Ø¹</strong></li>`;
        if (totalUnpaidUSD > 0) detailsHtml += `<li>${getTranslation('advisorTotalRemaining')} <strong>$${totalUnpaidUSD.toLocaleString()}</strong></li>`;
        if (overdueCount > 0) detailsHtml += `<li>${getTranslation('advisorOverdueCount')} <strong>${overdueCount}</strong></li>`;
        detailsHtml += `<li>${getTranslation('advisorPaidCount')} <strong>${paidCount}</strong></li>`;
        detailsHtml += `<li>${getTranslation('advisorTotalLoans')} <strong>${matchingReceipts.length}</strong></li>`;

        advisorDetails.innerHTML = detailsHtml;

        if (overdueCount > 0) {
            advisorBox.className = 'p-3 mt-2 rounded-lg border text-sm transition-all duration-300 border-red-400 bg-red-50 text-red-800';
            advisorIcon.className = 'fas fa-exclamation-triangle text-xl text-red-600';
            advisorTitle.textContent = getTranslation('advisorRiskyDebtor');
        } else if (totalUnpaidIQD > 0 || totalUnpaidUSD > 0) {
            advisorBox.className = 'p-3 mt-2 rounded-lg border text-sm transition-all duration-300 border-yellow-400 bg-yellow-50 text-yellow-800';
            advisorIcon.className = 'fas fa-info-circle text-xl text-yellow-600';
            advisorTitle.textContent = getTranslation('advisorActiveDebts');
        } else {
            advisorBox.className = 'p-3 mt-2 rounded-lg border text-sm transition-all duration-300 border-green-400 bg-green-50 text-green-800';
            advisorIcon.className = 'fas fa-check-circle text-xl text-green-600';
            advisorTitle.textContent = getTranslation('advisorGoodDebtor');
        }

        advisorBox.classList.remove('hidden');
    }
    
    async function generateAiSummary() {
Â  Â  Â  Â  const container = document.getElementById('aiSummaryCard');
Â  Â  Â  Â  container.innerHTML = '';Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!db) {
Â  Â  Â  Â  Â  Â  console.warn("DB not ready, skipping AI Summary generation.");
Â  Â  Â  Â  Â  Â  container.classList.add('hidden');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  const receipts = await getReceipts();
Â  Â  Â  Â  Â  Â  if (receipts.length < 2) {
Â  Â  Â  Â  Â  Â  Â  Â  container.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  today.setHours(0,0,0,0);
Â  Â  Â  Â  Â  Â  const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
Â  Â  Â  Â  Â  Â  const last7DaysStart = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
Â  Â  Â  Â  Â  Â  const last14DaysStart = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);
Â  Â  Â  Â  Â  Â  const rate = typeof globalExchangeRate === 'number' && globalExchangeRate > 0 ? globalExchangeRate : 1450;Â 

Â  Â  Â  Â  Â  Â  let collectionsThisWeekIQD = 0;Â 
Â  Â  Â  Â  Â  Â  let collectionsLastWeekIQD = 0;Â 
Â  Â  Â  Â  Â  Â  let overdueCategoryAmountIQD = {};
Â  Â  Â  Â  Â  Â  let atRiskMoneyIQD = 0;
Â  Â  Â  Â  Â  Â  let totalGlobalDelayDays = 0;
Â  Â  Â  Â  Â  Â  let paidReceiptsCount = 0;

Â  Â  Â  Â  Â  Â  receipts.forEach(r => {
Â  Â  Â  Â  Â  Â  Â  Â  const receiptCurrency = r.currency || 'IQD';
Â  Â  Â  Â  Â  Â  Â  Â  const status = getDebtStatus(r);
Â  Â  Â  Â  Â  Â  Â  Â  const remaining = getRemainingAmount(r);
Â  Â  Â  Â  Â  Â  Â  Â  let normalizedRemaining = remaining;
Â  Â  Â  Â  Â  Â  Â  Â  if (receiptCurrency === 'USD') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  normalizedRemaining = remaining * rate;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Metric 1: Riskiest Category (Overdue)
Â  Â  Â  Â  Â  Â  Â  Â  if (status === 'overdue') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overdueCategoryAmountIQD[r.category] = (overdueCategoryAmountIQD[r.category] || 0) + normalizedRemaining;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Metric 2: At-Risk Money (> 30 days overdue)
Â  Â  Â  Â  Â  Â  Â  Â  let firstUnpaidDueDate = null;
Â  Â  Â  Â  Â  Â  Â  Â  if (r.isInstallment && r.installments) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const firstUnpaid = r.installments.find(i => i.status !== 'paid');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (firstUnpaid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  firstUnpaidDueDate = new Date(firstUnpaid.dueDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  firstUnpaidDueDate = new Date(r.dueDate);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (status !== 'paid' && firstUnpaidDueDate && firstUnpaidDueDate < thirtyDaysAgo) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â atRiskMoneyIQD += normalizedRemaining;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Metric 3: Average Global Delay (for paid debts)
Â  Â  Â  Â  Â  Â  Â  Â  if (status === 'paid' && r.payments && r.payments.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paidReceiptsCount++; // We found a paid receipt with history
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sortedPayments = [...r.payments].sort((a, b) => new Date(a.date) - new Date(b.date));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let cumulativePaid = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let finalPaymentDate = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const totalLoanForReceipt = getTotalLoan(r);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const payment of sortedPayments) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cumulativePaid += payment.amount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (cumulativePaid >= totalLoanForReceipt - 0.01) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  finalPaymentDate = new Date(payment.date);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  finalPaymentDate.setHours(0, 0, 0, 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (finalPaymentDate && r.dueDate) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dueDate = new Date(r.dueDate); // Use the final due date of the receipt
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dueDate.setHours(0, 0, 0, 0);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (finalPaymentDate > dueDate) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const delay = Math.ceil((finalPaymentDate - dueDate) / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalGlobalDelayDays += delay;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Existing Collections Logic
Â  Â  Â  Â  Â  Â  Â  Â  (r.payments || []).forEach(p => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!p.date || typeof p.amount !== 'number' || isNaN(new Date(p.date))) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const paymentDate = new Date(p.date);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let normalizedAmount = p.amount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (receiptCurrency === 'USD') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  normalizedAmount = p.amount * rate;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (paymentDate >= last7DaysStart && paymentDate <= now) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collectionsThisWeekIQD += normalizedAmount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (paymentDate >= last14DaysStart && paymentDate < last7DaysStart) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collectionsLastWeekIQD += normalizedAmount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Calculate final metrics
Â  Â  Â  Â  Â  Â  const avgGlobalDelay = paidReceiptsCount > 0 ? Math.round(totalGlobalDelayDays / paidReceiptsCount) : 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let topOverdueCategory = null;
Â  Â  Â  Â  Â  Â  if (Object.keys(overdueCategoryAmountIQD).length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  topOverdueCategory = Object.keys(overdueCategoryAmountIQD).reduce((a, b) => overdueCategoryAmountIQD[a] > overdueCategoryAmountIQD[b] ? a : b);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Build summary points
Â  Â  Â  Â  Â  Â  const summaryPoints = [];

Â  Â  Â  Â  Â  Â  // Point 1: Collections Trend
Â  Â  Â  Â  Â  Â  if (collectionsLastWeekIQD > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const percentChange = Math.round(((collectionsThisWeekIQD - collectionsLastWeekIQD) / collectionsLastWeekIQD) * 100);
Â  Â  Â  Â  Â  Â  Â  Â  if (percentChange > 5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.push({ type: 'success', text: getTranslation('collectionsUp', { percent: Math.abs(percentChange) }), icon: 'fa-arrow-trend-up' });
Â  Â  Â  Â  Â  Â  Â  Â  } else if (percentChange < -5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.push({ type: 'danger', text: getTranslation('collectionsDown', { percent: Math.abs(percentChange) }), icon: 'fa-arrow-trend-down' });
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.push({ type: 'info', text: getTranslation('collectionsSame'), icon: 'fa-arrows-left-right' });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (collectionsThisWeekIQD > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.push({ type: 'success', text: getTranslation('collectionsUp', { percent: 100 }), icon: 'fa-arrow-trend-up' });Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Point 2: NEW Riskiest Category
Â  Â  Â  Â  Â  Â  if (topOverdueCategory) {
Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.push({ type: 'danger', text: getTranslation('riskiestCategoryWarning', { category: topOverdueCategory }), icon: 'fa-triangle-exclamation' });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Point 3: NEW Average Global Delay
Â  Â  Â  Â  Â  Â  if (paidReceiptsCount > 0 && avgGlobalDelay > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.push({ type: 'info', text: getTranslation('avgGlobalDelayInfo', { days: avgGlobalDelay }), icon: 'fa-clock-rotate-left' });
AÂ  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Point 4: NEW At-Risk Money
Â  Â  Â  Â  Â  Â  if (atRiskMoneyIQD > 1000) { // Only show if significant
Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.push({ type: 'danger', text: getTranslation('atRiskMoneyWarning', { amount: atRiskMoneyIQD.toLocaleString(undefined, {maximumFractionDigits: 0}) }), icon: 'fa-sack-xmark' });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Fallback if no other points
Â  Â  Â  Â  Â  Â  const unpaid = receipts.filter(r => getRemainingAmount(r) > 0.001);
Â  Â  Â  Â  Â  Â  if (summaryPoints.length === 0 && unpaid.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const oldestDebt = unpaid.sort((a, b) => new Date(a.date) - new Date(b.date))[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (oldestDebt && oldestDebt.date) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.push({ type: 'danger', text: getTranslation('oldestDebtWarning', { name: oldestDebt.name, date: formatLocaleDate(oldestDebt.date) }), icon: 'fa-triangle-exclamation' });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Render HTML
Â  Â  Â  Â  Â  Â  if (summaryPoints.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<p class="text-center text-gray-500">${getTranslation('notEnoughData')}</p>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  let html = `<h3 class="text-lg font-bold mb-2">${getTranslation('aiSummaryTitle')}</h3><ul>`;
Â  Â  Â  Â  Â  Â  Â  Â  summaryPoints.forEach(point => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<li><span class="icon text-${point.type}"><i class="fas ${point.icon}"></i></span> <span>${point.text}</span></li>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  html += '</ul>';
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = html;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  container.classList.remove('hidden');Â 

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Error generating AI Summary:", error);
Â  Â  Â  Â  Â  Â  container.innerHTML = `<p class="text-center text-red-500">Error generating summary.</p>`;Â 
Â  Â  Â  Â  Â  Â  container.classList.remove('hidden');Â 
Â  Â  Â  Â  }
Â  Â  }

    async function generateDebtorAnalysis(receiptId, container) {
Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  container.classList.add('hidden'); // Hide by default

Â  Â  Â  Â  const allReceipts = await getReceipts();
Â  Â  Â  Â  const currentReceipt = allReceipts.find(r => r.id === receiptId);
Â  Â  Â  Â  if (!currentReceipt) return;

Â  Â  Â  Â  const debtorReceipts = currentReceipt.phone
Â  Â  Â  Â  Â  Â  ? allReceipts.filter(r => r.phone === currentReceipt.phone)
Â  Â  Â  Â  Â  Â  : [currentReceipt];

Â  Â  Â  Â  if (debtorReceipts.length === 0) return;

Â  Â  Â  Â  let totalDelayDays = 0;
Â  Â  Â  Â  let paidReceiptsWithHistory = 0;
Â  Â  Â  Â  let paidOnTimeCount = 0;
Â  Â  Â  Â  let currentlyOverdueCount = 0;
Â  Â  Â  Â  let hasPaymentHistory = false;

Â  Â  Â  Â  debtorReceipts.forEach(r => {
Â  Â  Â  Â  Â  Â  const status = getDebtStatus(r);

Â  Â  Â  Â  Â  Â  if (status === 'overdue') {
Â  Â  Â  Â  Â  Â  Â  Â  currentlyOverdueCount++;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (status === 'paid' && r.payments && r.payments.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  hasPaymentHistory = true;
Â  Â  Â  Â  Â  Â  Â  Â  paidReceiptsWithHistory++;
Â  Â  Â  Â  Â  Â  Â  Â  // Find the date of the last payment that made it fully paid
Â  Â  Â  Â  Â  Â  Â  Â  const sortedPayments = [...r.payments].sort((a, b) => new Date(a.date) - new Date(b.date));
Â  Â  Â  Â  Â  Â  Â  Â  let cumulativePaid = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let finalPaymentDate = null;
Â  Â  Â  Â  Â  Â  Â  Â  const totalLoanForReceipt = getTotalLoan(r);

Â  Â  Â  Â  Â  Â  Â  Â  for (const payment of sortedPayments) {
Â  Â  Â  Â  Â  Â  Â  Â  	cumulativePaid += payment.amount;
Â  Â  Â  Â  Â  Â  Â  Â  	if (cumulativePaid >= totalLoanForReceipt - 0.01) {
Â  Â  Â  Â  Â  Â  Â  Â  		finalPaymentDate = new Date(payment.date);
Â  Â  Â  Â  Â  Â  Â  Â  		break;
Â  Â  Â  Â  Â  Â  Â  Â  	}
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (finalPaymentDate && r.dueDate) {
Â  Â  Â  Â  Â  Â  Â  Â  	const dueDate = new Date(r.dueDate);
Â  Â  Â  Â  Â  Â  Â  Â  	// Set time to 0 to compare dates only
Â  Â  Â  Â  Â  Â  Â  Â  	finalPaymentDate.setHours(0, 0, 0, 0);
Â  Â  Â  Â  Â  Â  Â  Â  	dueDate.setHours(0, 0, 0, 0);

Â  Â  Â  Â  Â  Â  Â  Â  	if (finalPaymentDate <= dueDate) {
Â  Â  Â  Â  Â  Â  Â  Â  		paidOnTimeCount++;
Â  Â  Â  Â  Â  Â  Â  Â  	} else {
Â  Â  Â  Â  Â  Â  Â  Â  		// Calculate delay only if paid late
Â  Â  Â  Â  Â  Â  Â  Â  		const delay = Math.ceil((finalPaymentDate - dueDate) / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  Â  Â  		totalDelayDays += delay;
Â  Â  Â  Â  Â  Â  Â  Â  	}
Â  Â  Â  Â  Â  Â  	}
Â  Â  Â  Â  	}
Â  Â  	});

Â  Â  	let analysisResult = '';
Â  Â  	let styleClass = 'bg-gray-50 border-gray-200 text-gray-800'; // Default style
Â  Â  	let icon = 'fa-lightbulb';
Â  Â  	let statusMessage = getTranslation('analysisNotEnoughData');

Â  Â  	if (hasPaymentHistory && paidReceiptsWithHistory > 0) {
Â  Â  Â  Â  	const avgDelay = Math.round(totalDelayDays / paidReceiptsWithHistory);
Â  Â  Â  Â  	const onTimeRate = Math.round((paidOnTimeCount / paidReceiptsWithHistory) * 100);

Â  Â  Â  Â  	analysisResult = `
Â  Â  Â  Â  		<ul class="space-y-1 list-disc list-inside mb-3">
Â  Â  Â  Â  			<li>${getTranslation('analysisAvgDelay')} <strong>${avgDelay} ${getTranslation('daysUnit')}</strong></li>
Â  Â  Â  Â  			<li>${getTranslation('analysisOnTimeRate')} <strong>${onTimeRate}%</strong></li>
Â  Â  Â  Â  			${currentlyOverdueCount > 0 ? `<li>${getTranslation('analysisOverdueCount')} <strong>${currentlyOverdueCount}</strong></li>` : ''}
Â  Â  Â  Â  		</ul>
Â  Â  Â  Â  	`;

Â  Â  Â  Â  	// Determine status message and style based on metrics
Â  Â  Â  Â  	if (currentlyOverdueCount >= 2 && avgDelay > 10) {
Â  Â  Â  Â  		statusMessage = getTranslation('analysisStatusVeryRisky');
Â  Â  Â  Â  		styleClass = 'bg-red-50 border-red-200 text-red-800';
Â  Â  Â  Â  		icon = 'fa-skull-crossbones';
Â  Â  Â  Â  	} else if (currentlyOverdueCount > 0 || avgDelay > 7) {
Â  Â  Â  Â  		statusMessage = getTranslation('analysisStatusRisky');
Â  Â  Â  Â  		styleClass = 'bg-yellow-50 border-yellow-200 text-yellow-800';
Â  Â  Â  Â  		icon = 'fa-exclamation-triangle';
Â  Â  Â  Â  	} else if (avgDelay > 2 || onTimeRate < 75) {
Â  Â  Â  Â  		statusMessage = getTranslation('analysisStatusAverage');
Â  Â  Â  Â  		styleClass = 'bg-blue-50 border-blue-200 text-blue-800';
Â  Â  Â  Â  		icon = 'fa-info-circle';
Â  Â  Â  Â  	} else {
Â  Â  Â  Â  		statusMessage = getTranslation('analysisStatusGood');
Â  Â  Â  Â  		styleClass = 'bg-green-50 border-green-200 text-green-800';
Â  Â  Â  Â  		icon = 'fa-check-circle';
Â  Â  Â  Â  	}

Â  Â  	} else if (currentlyOverdueCount > 0) {
        // Has overdue debts but no payment history to analyze
        statusMessage = getTranslation('analysisStatusRisky'); // Or a specific message
		styleClass = 'bg-yellow-50 border-yellow-200 text-yellow-800';
		icon = 'fa-exclamation-triangle';
         analysisResult = `
Â  Â  Â  Â  		<ul class="space-y-1 list-disc list-inside mb-3">
Â  Â  Â  Â  			<li>${getTranslation('analysisOverdueCount')} <strong>${currentlyOverdueCount}</strong></li>
            </ul>
        `;
    } else {
         // No payment history and no overdue debts
         statusMessage = getTranslation('analysisNotEnoughData');
         styleClass = 'bg-gray-50 border-gray-200 text-gray-800';
         icon = 'fa-lightbulb';
    }


Â  Â  	container.className = `p-3 mt-4 rounded-lg border text-sm ${styleClass}`;
Â  Â  	container.innerHTML = `
Â  Â  		<h4 class="font-bold mb-2 flex items-center gap-2"><i class="fas ${icon}"></i> ${getTranslation('debtorAnalysisTitle')}</h4>
Â  Â  		${analysisResult}
Â  Â  		<p class="font-semibold">${statusMessage}</p>
Â  Â  	`;
Â  Â  	container.classList.remove('hidden');
Â  Â  }

    function setupEventListeners() {
        document.getElementById("receiptForm").addEventListener("submit", (e) => { e.preventDefault(); saveReceipt(); });
        document.getElementById("paymentForm").addEventListener("submit", (e) => { e.preventDefault(); processPayment(); });
        document.getElementById("addLoanForm").addEventListener("submit", (e) => { e.preventDefault(); processNewLoan(); });
        document.getElementById("searchInput").addEventListener("input", () => filterAndSortReceipts());
        document.getElementById("cancelAddBtn").addEventListener("click", () => showPage('viewPage', document.querySelector('button[data-page="viewPage"]')));
        document.getElementById("clearAllBtn").addEventListener("click", clearAllReceipts);
        document.getElementById("centralAddBtn").addEventListener("click", prepareAddPage);
        document.getElementById("phone").addEventListener("input", updateLoanAdvisor);
        document.getElementById("name").addEventListener("blur", updateLoanAdvisor);
        document.getElementById("amount").addEventListener("paste", (e) => {
            e.preventDefault();
            showToast(getTranslation('pasteNotAllowed'), 'danger');
        });
        
        document.getElementById("paidAmountInput").addEventListener("paste", (e) => {
            e.preventDefault();
            showToast(getTranslation('pasteNotAllowed'), 'danger');
        }); 

        document.getElementById('saveBusinessNameBtn').addEventListener('click', () => {
            const businessName = document.getElementById('businessNameInput').value.trim();
            localStorage.setItem('businessName', businessName);
            showToast(getTranslation('businessNameSavedToast'), 'success');
        });

        document.getElementById('saveExchangeRateBtn').addEventListener('click', () => {
            const newRate = parseFloat(document.getElementById('exchangeRateSettingInput').value);
            if (isNaN(newRate) || newRate <= 0) {
                showToast(getTranslation('formInvalidAmount'), 'danger');
                return;
            }
            globalExchangeRate = newRate;
            localStorage.setItem('exchangeRate', newRate.toString());
            showToast(getTranslation('settingsSavedToast'), 'success');
        });

        document.getElementById('paidAmountInput').addEventListener('input', updateConversionInfo);

        document.getElementById("notificationBellBtn").addEventListener("click", () => {
            const bellIcon = document.querySelector('#notificationBellBtn i');
            bellIcon.classList.remove('bell-ringing');
            bellIcon.classList.add('no-ring');
            currentFilter = 'alerts';
            const viewPageBtn = document.querySelector('button[data-page="viewPage"]');
            showPage('viewPage', viewPageBtn);
        });

        document.getElementById('langKuBtn').addEventListener('click', () => setLanguage('ku'));
        document.getElementById('langArBtn').addEventListener('click', () => setLanguage('ar'));
        
        document.getElementById('defaultIqdBtn').addEventListener('click', () => setDefaultCurrency('IQD'));
        document.getElementById('defaultUsdBtn').addEventListener('click', () => setDefaultCurrency('USD'));

        document.querySelectorAll(".nav-btn").forEach(btn => {
            btn.addEventListener("click", () => showPage(btn.dataset.page, btn));
        });
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (event) => {
                if (event.target === modal) closeModal(modal.id);
                if(event.target.closest('[data-modal-close]')) closeModal(event.target.closest('[data-modal-close]').dataset.modalClose);
            });
        });
        document.querySelectorAll('#receiptForm .lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#receiptForm .lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const currency = btn.dataset.currency;
                document.getElementById('currency').value = currency;
                updateAmountLabel(currency);
            });
        });

        // â­ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§: ÙÛ•Ù†Ú©Ø´Ù†ÛŒ ÛŒØ§Ø±ÛŒØ¯Û•Ø¯Û•Ø± Ø¨Û† Ø¯Ø§Ù†Ø§Ù†ÛŒ Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ù¾ÛØ´Ù†ÛŒØ§Ø±Ú©Ø±Ø§ÙˆÛŒ ÛŒÛ•Ú©Û•Ù… Ù‚ÛŒØ³Øª
Â  Â  Â  Â  function setDefaultFirstInstallmentDate() {
Â  Â  Â  Â  Â  Â  const transactionDateStr = document.getElementById('date').value;
Â  Â  Â  Â  Â  Â  const freq = document.getElementById('installmentFrequency').value;
Â  Â  Â  Â  Â  Â  const firstInstallmentInput = document.getElementById('firstInstallmentDate');

Â  Â  Â  Â  Â  Â  if (transactionDateStr) {
Â  Â  Â  Â  Â  Â  Â  Â  const transactionDate = new Date(transactionDateStr);
Â  Â  Â  Â  Â  Â  Â  Â  transactionDate.setMinutes(transactionDate.getMinutes() + transactionDate.getTimezoneOffset()); // UTC fix

Â  Â  Â  Â  Â  Â  Â  Â  if (freq === 'monthly') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  transactionDate.setMonth(transactionDate.getMonth() + 1);
Â  Â  Â  Â  Â  Â  Â  Â  } else { // weekly
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  transactionDate.setDate(transactionDate.getDate() + 7);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  firstInstallmentInput.value = transactionDate.toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const isInstallmentToggle = document.getElementById('isInstallmentToggle');
Â  Â  Â  Â  isInstallmentToggle.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const isActive = isInstallmentToggle.classList.toggle('active');
Â  Â  Â  Â  Â  Â  document.getElementById('installmentFields').classList.toggle('hidden', !isActive);
Â  Â  Â  Â  Â  Â  document.getElementById('dueDateContainer').classList.toggle('hidden', isActive);
Â  Â  Â  Â  Â  Â  // â­ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§: Ø¯Ø§Ù†Ø§Ù†ÛŒ Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ù¾ÛØ´Ù†ÛŒØ§Ø±Ú©Ø±Ø§Ùˆ Ú©Ø§ØªÛÚ© Ø³ÙˆÛŒÚ†Û•Ú©Û• Ù„ÛØ¯Û•Ø¯Ø±ÛØª
Â  Â  Â  Â  Â  Â  if (isActive) {
Â  Â  Â  Â  Â  Â  Â  Â  setDefaultFirstInstallmentDate();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // â­ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§: Ø¦Û•Ú¯Û•Ø± Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ ÛŒØ§Ù† Ø¬Û†Ø±ÛŒ Ù‚ÛŒØ³Øª Ú¯Û†Ú•Ø¯Ø±Ø§ØŒ Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ ÛŒÛ•Ú©Û•Ù… Ù‚ÛŒØ³Øª Ù†ÙˆÛ Ø¨Ú©Û•Ø±Û•ÙˆÛ•
Â  Â  Â  Â  document.getElementById('date').addEventListener('input', setDefaultFirstInstallmentDate);
Â  Â  Â  Â  document.getElementById('installmentFrequency').addEventListener('input', setDefaultFirstInstallmentDate);

        ['amount', 'installmentAmount', 'installmentFrequency'].forEach(id => {
Â  Â  Â  Â  Â  Â  document.getElementById(id).addEventListener('input', () => {
Â  Â  Â  Â  Â  Â  Â  Â  const amount = parseFloat(document.getElementById('amount').value);
Â  Â  Â  Â  Â  Â  Â  Â  const installmentAmount = parseFloat(document.getElementById('installmentAmount').value);
Â  Â  Â  Â  Â  Â  Â  Â  const freq = document.getElementById('installmentFrequency').value;
Â  Â  Â  Â  Â  Â  Â  Â  const preview = document.getElementById('installmentPreview');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (amount > 0 && installmentAmount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (installmentAmount >= amount) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preview.textContent = getTranslation('formErrorInstallmentAmount');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preview.style.color = 'red';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preview.style.color = ''; // Back to default
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const count = Math.ceil(amount / installmentAmount);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastAmount = amount - (installmentAmount * (count - 1));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Check if last payment is very close to the fixed amount
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Math.abs(lastAmount - installmentAmount) < 0.01 || lastAmount.toFixed(0) === installmentAmount.toFixed(0)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preview.textContent = getTranslation('installmentPreviewCalculated', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  count: count,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  freq: getTranslation(freq)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preview.textContent = getTranslation('installmentPreviewCalculatedLast', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  count: count,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  freq: getTranslation(freq),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastAmount: lastAmount.toLocaleString()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preview.textContent = '';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
        const addForm = document.getElementById('receiptForm');
if (addForm) {
    addForm.addEventListener('focusin', (event) => {
        if (event.target.matches('input, textarea, select')) {
            setTimeout(() => {
                event.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 250); 
        }
    });
}
        document.getElementById('addCategoryBtn').addEventListener('click', () => {
            const input = document.getElementById('newCategoryInput');
            const newCategory = input.value.trim();
            if (!newCategory) return;

            let categories = getCustomCategories();
            if (categories.includes(newCategory)) {
                showToast(getTranslation('categoryExistsError'), 'danger');
                return;
            }

            categories.push(newCategory);
            saveCustomCategories(categories);
            renderCategoryManager();
            populateCategoryOptions();
            input.value = '';
            showToast(getTranslation('categoryAddedToast'), 'success');
        });
    }

    async function initApp() {
        try {
            await openDB();
            loadAndApplySettings();
            setupEventListeners();
            updateCurrencyDisplayOrder();
            await updateBadges(); 
            await updateHeaderForecast();
            await showPage('homePage', document.querySelector('.nav-btn.active'));
            await checkAndUnlockAchievements();
            await checkAndShowPeriodicReport();
        } catch (error) {
            console.error("Failed to initialize app:", error);
            document.body.innerHTML = `<p>Error initializing app database.</p>`;
            hideLoader();
        }
    }

    document.addEventListener("DOMContentLoaded", initApp);
    // Register Service Worker for PWA
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then((reg) => console.log('Service Worker Registered', reg.scope))
                .catch((err) => console.log('Service Worker Failed', err));
        });
    }
</script>
</body>
</html>
